Ember.Application.initializer({name:"ApplicationController",after:["PartialslotAbleController","UserprofilestatusmenuMixin","RequirejsmocksmanagerMixin","ScreentoolstatusmenuMixin","DocumentationMixin","SchemamanagerMixin","ConsolemanagerMixin","LoadingindicatorMixin","PromisemanagerMixin","NotificationsMixin","FormsUtils","DataUtils","DebugUtils","HashUtils","NotificationUtils","WidgetsRegistry","ActionsRegistry","MixinsRegistry","InflectionsRegistry"],initialize:function(container,application){var PartialslotAbleController=container.lookupFactory("controller:partialslot-able");var UserprofilestatusmenuMixin=container.lookupFactory("mixin:userprofilestatusmenu");var RequirejsmocksmanagerMixin=container.lookupFactory("mixin:requirejsmocksmanager");var ScreentoolstatusmenuMixin=container.lookupFactory("mixin:screentoolstatusmenu");var DocumentationMixin=container.lookupFactory("mixin:documentation");var SchemamanagerMixin=container.lookupFactory("mixin:schemamanager");var ConsolemanagerMixin=container.lookupFactory("mixin:consolemanager");var LoadingindicatorMixin=container.lookupFactory("mixin:loadingindicator");var PromisemanagerMixin=container.lookupFactory("mixin:promisemanager");var NotificationsMixin=container.lookupFactory("mixin:notifications");var widgetsRegistry=container.lookupFactory("registry:widgets");var actionsRegistry=container.lookupFactory("registry:actions");var mixinsRegistry=container.lookupFactory("registry:mixins");var inflectionsRegistry=container.lookupFactory("registry:inflections");var formsUtils=container.lookupFactory("utility:forms");var dataUtils=container.lookupFactory("utility:data");var debugUtils=container.lookupFactory("utility:debug");var hashUtils=container.lookupFactory("utility:hash");var notificationUtils=container.lookupFactory("utility:notification");var get=Ember.get,set=Ember.set,isNone=Ember.isNone,__=Ember.String.loc;var indexController=Ember.Controller.extend(Ember.Evented,{});loader.register("controller:index",indexController);var ApplicationControllerDict={needs:["login","recordinfopopup"],partials:{statusbar:[]},editMode:false,runtimeConfiguration:window.canopsisConfiguration,debug:Ember.computed.alias("runtimeConfiguration.DEBUG"),widgetsRegistry:widgetsRegistry,actionsRegistry:actionsRegistry,mixinsRegistry:mixinsRegistry,inflectionsRegistry:inflectionsRegistry,enginesviews:[{label:__("Context"),value:"view.context"},{label:__("Selectors"),value:"view.selectors"},{label:__("Event Filter"),value:"view.filters"},{label:__("Performance Data"),value:"view.series"},{label:__("Scheduled Jobs"),value:"view.jobs"},{label:__("Link list"),value:"view.linklist"},{label:__("Snmp rules"),value:"view.snmprule"}],init:function(){console.group("app init");notificationUtils.setController(this);var title=get(window.canopsisConfiguration,"TITLE");if(!isNone(title)){$("title").html(title)}console.groupEnd();this.refreshPartialsList();this._super.apply(this,arguments);console.groupEnd();console.tags.remove("init")},editAuthConfig:function(authType){console.log("edit "+authType);var conf=get(this,authType);if(isNone(conf)){this.send("prompt","Unable to load "+authType+" configuration. No edition possible.")}else{set(conf,"crecord_type",authType);var editForm=formsUtils.showNew("modelform",conf,{title:__("Edit "+authType+" configuration")});editForm.submit.done(function(){conf.save()})}},didSaveView:function(userview){this.transitionToRoute("/userview/"+get(userview,"id"))},actions:{inspect:function(object){debugUtils.inspectObject(object)},editConfig:function(){var frontendConfig=get(this,"frontendConfig");console.log("editConfig",formsUtils,frontendConfig);var editForm=formsUtils.showNew("modelform",frontendConfig,{title:__("Edit settings"),inspectedItemType:"frontend"});editForm.submit.done(function(){frontendConfig.save()})},editAuthConfiguration:function(authType){console.log("edit "+authType);this.editAuthConfig(authType)},prompt:function(message){formsUtils.showNew("confirmform",{},{title:__(message)})},promptReloadApplication:function(title,location){setTimeout(function(){var recordWizard=formsUtils.showNew("confirmform",{},{title:__(title)});recordWizard.submit.then(function(form){void form;if(isNone(location)){window.location="/index.html"}else{window.location=location}})},1500)},editEventSettings:function(){formsUtils.editSchemaRecord("statusmanagement",get(this,"container"))},editDataclean:function(){formsUtils.editSchemaRecord("datacleaner",get(this,"container"))},editEnabledPlugins:function(){formsUtils.editSchemaRecord("enabledmodules",get(this,"container"))},editTicketJob:function(){console.group("editTicketJob");var ticketConfig=get(this,"ticketConfig");set(ticketConfig,"crecord_type","ticket");console.log("ticketConfig:",ticketConfig);var job=get(ticketConfig,"job");var params=get(job,"params");console.log("job:",job,params);if(params){console.log("param subject",get(params,"subject"))}var editForm=formsUtils.showNew("jobform",job,{scheduled:false});editForm.submit.done(function(form){var job=get(form,"formContext");var params=get(job,"params");set(ticketConfig,"job",job);set(ticketConfig,"job.params",params);ticketConfig.save()});console.groupEnd()},addNewView:function(){var type="userview";var applicationController=this;console.log("add",type);var containerwidgetId=hashUtils.generateId("container");var viewId=hashUtils.generateId("userview");dataUtils.getStore().createRecord("widgetcontainer",{xtype:"widgetcontainer",mixins:[{name:"verticallayout"}],id:containerwidgetId});var userId=get(this,"controllers.login.record._id");var userview=dataUtils.getStore().push(type,{id:viewId,crecord_type:"view",author:userId,containerwidget:containerwidgetId,containerwidgetType:"widgetcontainer"});var formattedViewId=viewId.replace(".","_");console.log("temp record",userview);var recordWizard=formsUtils.showNew("modelform",userview,{title:__("Add ")+type});recordWizard.submit.done(function(){userview.save().then(function(){applicationController.didSaveView(userview)})})},openTab:function(url){this.transitionToRoute(url)},logout:function(){get(this,"controllers.login").setProperties({authkey:null,errors:[]});window.location="/logout"}}};var controller;if(canopsisConfiguration.DEBUG){controller=PartialslotAbleController.extend(UserprofilestatusmenuMixin,SchemamanagerMixin,PromisemanagerMixin,ConsolemanagerMixin,NotificationsMixin,LoadingindicatorMixin,RequirejsmocksmanagerMixin,ScreentoolstatusmenuMixin,DocumentationMixin,ApplicationControllerDict)}else{controller=PartialslotAbleController.extend(UserprofilestatusmenuMixin,NotificationsMixin,LoadingindicatorMixin,DocumentationMixin,ApplicationControllerDict)}application.register("controller:application",controller)}});Ember.Application.initializer({name:"FormController",after:["DebugUtils","FormsUtils"],initialize:function(container,application){formUtils=container.lookupFactory("utility:forms");debugUtils=container.lookupFactory("utility:debug");var get=Ember.get,set=Ember.set;var eventedController=Ember.Controller.extend(Ember.Evented,{mergedProperties:["partials"],_partials:{},refreshPartialsList:function(){console.log("refreshPartialsList",get(this,"partials"));var partials=get(this,"partials"),mixins=get(this,"content.mixins");set(this,"_partials",partials);if(Ember.isArray(mixins)){for(var i=0,l=mixins.length;i<l;i++){partials=this.mergeMixinPartials(mixins[i],partials)}}console.log("set partials for ",this," --> ",partials);set(this,"_partials",partials)},mergeMixinPartials:function(Mixin,partials){var me=this;console.log("mergeMixinPartials mixin:",Mixin);if(mixinsRegistry.getByName(Mixin.decamelize())){var partialsToAdd=mixinsRegistry.getByName(Mixin.decamelize()).EmberClass.mixins[0].properties.partials;for(var k in partialsToAdd){if(partialsToAdd.hasOwnProperty(k)){var partialsArray=partialsToAdd[k];var partialKey="_partials."+k;set(this,partialKey,union_arrays(get(this,partialKey),partialsArray))}}return partials}}});var controller=eventedController.extend({needs:["application"],init:function(){var formParent=get(this,"formParent");set(this,"previousForm",formParent);this._super.apply(this,arguments)},confirmation:false,submit:$.Deferred(),actions:{previousForm:function(){var previousForm=get(this,"previousForm");console.log("previousForm",previousForm,this);formUtils.showInstance(previousForm)},show:function(){this.submit=$.Deferred()},submit:function(){console.log("onsubmit",this.formParent);if(this.formParent!==undefined){this.formParent.send("submit",arguments)}else{console.log("resolve modelform submit");if(this.confirmation){var record=this.formContext;formUtils.showNew("confirmform",record,{title:" confirmation ",newRecord:arguments[0]})}else{this.submit.resolve(this,arguments);get(this,"formwrapper").trigger("hide")}}},abort:function(){if(this.formParent!==undefined){this.formParent.send("abort",arguments)}else{console.log("rejecting submit promise");this.submit.reject()}},inspectForm:function(){console.group("inspectForm");console.log("form:",this);debugUtils.inspectObject(get(this,"categorized_attributes"));console.log("categorized_attributes available in $E");console.groupEnd()}},partials:{buttons:["formbutton-cancel"],debugButtons:["formbutton-inspectform"]},title:function(){console.warn('Property "title" must be defined on the concrete class.');return"<Untitled form>"}.property()});application.register("controller:form",controller)}});Ember.Application.initializer({name:"FormwrapperController",initialize:function(container,application){var get=Ember.get;var eventedController=Ember.Controller.extend(Ember.Evented);var controller=eventedController.extend({config:window.canopsisConfiguration,debug:Ember.computed.alias("config.DEBUG"),actions:{show:function(){console.log("FormwrapperController show",this,get(this,"widgetwrapperView"));get(this,"widgetwrapperView").showPopup()}}});application.register("controller:formwrapper",controller)}});Ember.Application.initializer({name:"LoginController",initialize:function(container,application){var set=Ember.set,get=Ember.get,isNone=Ember.isNone;var controller=Ember.ObjectController.extend({content:{},init:function(){this._super.apply(this,arguments);var store=DS.Store.create({container:get(this,"container")});set(this,"store",store)},authkey:function(){var authkey=localStorage.cps_authkey;if(authkey==="undefined"){authkey=undefined}return authkey}.property("authkey"),authkeyChanged:function(){localStorage.cps_authkey=get(this,"authkey")}.observes("authkey")});application.register("controller:login",controller)}});Ember.Application.initializer({name:"PartialslotAbleController",after:["MixinsRegistry","WidgetsUtils"],initialize:function(container,application){var widgetUtils=container.lookupFactory("utility:widgets");var mixinsRegistry=container.lookupFactory("registry:mixins");var get=Ember.get,set=Ember.set;function removeMixinsPartials(widget,mixinName){console.log("removing mixin partials",arguments);var partials=get(widget,"_partials");var partialsToRemove=mixinsRegistry.getByName(mixinName.decamelize()).get("EmberClass.mixins")[0].properties.partials;for(var k in partialsToRemove){if(partialsToRemove.hasOwnProperty(k)){for(var i=0,l=partialsToRemove[k].length;i<l;i++){get(widget,"_partials")[k].removeObject(partialsToRemove[k][i])}}}set(widget,"_partials",partials)}function union_arrays(x,y){if(x===undefined){x=[]}if(y===undefined){y=[]}var obj={};for(var i=x.length-1;i>=0;--i)obj[x[i]]=x[i];for(var j=y.length-1;j>=0;--j)obj[y[j]]=y[j];var res=[];for(var k in obj){if(obj.hasOwnProperty(k))res.push(obj[k])}return res}var controller=Ember.ObjectController.extend({mergedProperties:["partials"],_partials:{},mixinOptions:{},refreshPartialsList:function(){console.log("refreshPartialsList",get(this,"partials"));var partials=get(this,"partials");set(this,"_partials",partials);var mixins=get(this,"content.mixins");if(Ember.isArray(mixins)){for(var i=0,l=mixins.length;i<l;i++){var currentMixin=mixins[i];if(typeof currentMixin==="string"){Ember.deprecate("Defining mixins as strings is deprecated. The new format is : '{ name: \"mixinName\" }'. This is required by the mixin options system.")}else{currentMixin=currentMixin.name.camelize()}partials=this.mergeMixinPartials(currentMixin,partials)}}console.log("set partials for ",this," --> ",partials);set(this,"_partials",partials)},mergeMixinPartials:function(Mixin,partials){var me=this;var mixinName=Mixin.decamelize();var mixinRegistryEntry=mixinsRegistry.getByName(mixinName);console.log("mergeMixinPartials mixin:",Mixin);if(mixinRegistryEntry){var partialsToAdd=mixinRegistryEntry.EmberClass.mixins[0].properties.partials;for(var k in partialsToAdd){if(partialsToAdd.hasOwnProperty(k)){var partialsArray=partialsToAdd[k];var partialKey="_partials."+k;set(this,partialKey,union_arrays(get(this,partialKey),partialsArray))}}return partials}}});application.register("controller:partialslot-able",controller)}});Ember.Application.initializer({name:"PerfdataController",after:"DataUtils",initialize:function(container,application){var dataUtils=container.lookupFactory("utility:data");var get=Ember.get,set=Ember.set;var controller=Ember.ObjectController.extend({needs:["application"],fetch:function(metric_id,tstart,tend){var applicationController=get(this,"controllers.application");applicationController.addConcurrentLoading("perfdata");var pojoAdapter=dataUtils.getEmberApplicationSingleton().__container__.lookup("adapter:pojo");var requestOptions={metric_id:metric_id,timewindow:JSON.stringify({start:tstart/1e3,stop:tend/1e3,timezone:(new Date).getTimezoneOffset()}),timeserie:JSON.stringify({aggregation:"NONE"})};var promise=pojoAdapter.createRecord("perfdata",undefined,requestOptions);promise.then(function(){applicationController.removeConcurrentLoading("perfdata")},function(){applicationController.removeConcurrentLoading("perfdata")});return promise},fetchMany:function(metrics,tstart,tend){return this.fetch(JSON.stringify(metrics),tstart,tend)},aggregate:function(metric_id,tstart,tend,method,interval){var applicationController=get(this,"controllers.application");applicationController.addConcurrentLoading("perfdata");var pojoAdapter=getCanopsis().Application.__container__.lookup("adapter:pojo");var requestOptions={metric_id:metric_id,timewindow:JSON.stringify({start:tstart/1e3,stop:tend/1e3,timezone:(new Date).getTimezoneOffset()}),timeserie:JSON.stringify({aggregation:method,period:{second:interval}})};var promise=pojoAdapter.createRecord("perfdata",undefined,requestOptions);promise.then(function(){applicationController.removeConcurrentLoading("perfdata")},function(){applicationController.removeConcurrentLoading("perfdata")});return promise},aggregateMany:function(metrics,tstart,tend,method,interval){return this.aggregate(JSON.stringify(metrics),tstart,tend,method,interval)}});application.register("controller:perfdata",controller)}});Ember.Application.initializer({name:"RecordinfopopupController",initialize:function(container,application){var get=Ember.get,set=Ember.set,__=Ember.String.loc;var eventedController=Ember.Controller.extend(Ember.Evented);var controller=eventedController.extend({init:function(){set(this,"title",__("Information"));console.log("initializing recordinfopopup controller")},actions:{show:function(crecord,template){console.log("Show recordinfopopup",crecord,template);var html;try{html=Handlebars.compile(template)(crecord[0]._data)}catch(err){html="<i>An error occured while compiling the template with the record. please if check the template is correct</i>"}set(this,"content",new Ember.Handlebars.SafeString(html));var left=($(window).width()-$("#recordinfopopup").outerWidth())/2;$("#recordinfopopup").css("left",left);$("#recordinfopopup").fadeIn(500)},hide:function(){console.log("hiding recordinfopopup");$("#recordinfopopup").fadeOut(500)}}});application.register("controller:recordinfopopup",controller)}});Ember.Application.initializer({name:"SerieController",after:"HashUtils",initialize:function(container,application){var hash=container.lookupFactory("utility:hash");var get=Ember.get,set=Ember.set;var controller=Ember.ObjectController.extend({needs:["perfdata"],perfdata:Ember.computed.alias("controllers.perfdata"),fetch:function(serie,from,to){if(get(serie,"metrics.length")>1&&get(serie,"aggregate_method")==="none"){console.group("More than one metric in serie, performing an aggregation");console.log("serie:",serie);console.log("aggregation: average - 60s");set(serie,"aggregate_method","average");set(serie,"aggregate_interval",60);console.groupEnd()}if(get(serie,"aggregate_method")==="none"){var promise=get(this,"perfdata").fetchMany(get(serie,"metrics"),from,to)}else{var promise=get(this,"perfdata").aggregateMany(get(serie,"metrics"),from,to,get(serie,"aggregate_method"),get(serie,"aggregate_interval"))}var formula=get(serie,"formula");return promise.then(function(result){console.group("Computing serie:",formula);var nmetric=result.total;var metrics=result.data;var points={};var length=false;var i;for(i=0;i<nmetric;i++){var metric=metrics[i];var id=metric.meta.data_id;var mid="metric_"+hash.md5(id);var mname="/"+id.split("/").slice(4).join("/");formula=formula.replaceAll(mname,mid);console.log("metric:",mname,mid);points[mid]=metric.points;if(!length||metric.points.length<length){length=metric.points.length}}console.log("formula:",formula);console.log("points:",points);var mids=Object.keys(points);var finalSerie=[];for(i=0;i<length;i++){var data={};var ts=0;var j,l;for(j=0,l=mids.length;j<l;j++){var mid=mids[j];data[mid]=points[mid][i][1];ts=points[mid][i][0]}math.import(data);var pointval=math.eval(formula);for(j=0,l=mids.length;j<l;j++){var mid=mids[j];delete math[mid]}finalSerie.push([ts*1e3,pointval])}console.log("finalserie:",finalSerie);console.groupEnd();return finalSerie})}});application.register("controller:serie",controller)}});Ember.Application.initializer({name:"UserviewController",after:["InspectableItemMixin","FormsUtils","HashUtils","SchemasRegistry"],initialize:function(container,application){var InspectableItem=container.lookupFactory("mixin:inspectable-item");var schemasregistry=container.lookupFactory("registry:schemas");var formUtils=container.lookupFactory("utility:forms");var hashUtils=container.lookupFactory("utility:hash");var get=Ember.get,set=Ember.set,isNone=Ember.isNone,__=Ember.String.loc;var controller=Ember.ObjectController.extend(InspectableItem,Ember.Evented,{needs:["application"],actions:{insertWidget:function(containerController){console.log("insertWidget",containerController);var widgetChooserForm=formUtils.showNew("widgetform",this);var userviewController=this;widgetChooserForm.submit.done(function(form,newWidgetWrappers){void form;var newWidgetWrapper=newWidgetWrappers[0];console.log("onsubmit, adding widgetwrapper to containerwidget",newWidgetWrapper,containerController);console.log("containerwidget items",get(containerController,"model.items.content"));get(containerController,"model.items.content").pushObject(newWidgetWrapper);console.log("saving view");get(userviewController,"model").save()});widgetChooserForm.submit.fail(function(){console.info("Widget insertion canceled")})},duplicateWidgetAndContent:function(widgetwrapperModel,containerModel){copyWidget(this,widgetwrapperModel,containerModel);this.get("model").save()},refreshView:function(){console.log("refresh view");this.trigger("refreshView")}}});copyWidget=function(self,widgetwrapperModel,containerModel){var widgetwrapperJson=cleanRecord(widgetwrapperModel.toJSON());widgetwrapperJson.widget=null;var duplicatedWrapper=self.store.createRecord("widgetwrapper",widgetwrapperJson);var widgetJson=cleanRecord(widgetwrapperModel.get("widget").toJSON());var duplicatedWidget=self.store.createRecord(widgetJson.xtype,widgetJson);if(!isNone(widgetwrapperModel.get("widget.items"))){var items=widgetwrapperModel.get("widget.items.content");for(var i=0;i<items.length;i++){var subWrapperModel=items[i];copyWidget(self,subWrapperModel,duplicatedWidget)}}duplicatedWrapper.set("widget",duplicatedWidget);containerModel.get("items.content").pushObject(duplicatedWrapper)};function cleanRecord(recordJSON){for(var key in recordJSON){var item=recordJSON[key];if(key==="id"||key==="_id"||key==="widgetId"||key==="preference_id"){delete recordJSON[key]}if(typeof item==="object"){cleanRecord(item)}}if(recordJSON!==null&&recordJSON!==undefined){recordJSON["id"]=hashUtils.generateId(recordJSON.xtype||recordJSON.crecord_type||"item");recordJSON["_id"]=recordJSON["id"]}return recordJSON}application.register("controller:userview",controller)}});Ember.Application.initializer({name:"WidgetController",after:["PartialslotAbleController","WidgetsUtils","RoutesUtils","FormsUtils","DebugUtils","DataUtils","RoutesUtils","SchemasRegistry"],initialize:function(container,application){var PartialslotAbleController=container.lookupFactory("controller:partialslot-able");var widgetUtils=container.lookupFactory("utility:widgets");var formsUtils=container.lookupFactory("utility:forms");var dataUtils=container.lookupFactory("utility:data");var debugUtils=container.lookupFactory("utility:debug");var routesUtils=container.lookupFactory("utility:routes");var schemasregistry=container.lookupFactory("registry:schemas");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var controller=PartialslotAbleController.extend({needs:["application","login"],abstractType:"widget",canopsisConfiguration:window.canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),editMode:Ember.computed.alias("controllers.application.editMode"),config:Ember.computed.alias("content"),init:function(){set(this,"userParams",{});console.log("widget init");var viewId=get(widgetUtils.getParentViewForWidget(this),"content.id");var container=routesUtils.getCurrentRouteController().container;var store=DS.Store.create({container:container});console.debug("View id for current widget is ",viewId);this.setProperties({"model.controllerInstance":this,viewId:viewId,viewController:widgetUtils.getParentViewForWidget(this),isOnMainView:get(widgetUtils.getParentViewForWidget(this),"isMainView"),container:container,widgetDataStore:store});if(!isNone(this.loadUserConfiguration)){this.loadUserConfiguration()}this._super();console.debug("user configuration loaded for widget "+get(this,"title"));this.refreshContent()},mixinsOptionsReady:function(){},addMixinView:function(viewMixin){var viewMixins=get(this,"viewMixins");if(isNone(viewMixins)){viewMixins=[];set(this,"viewMixins",viewMixins)}viewMixins.push(viewMixin)},updateInterval:function(interval){console.warn("This method should be overriden for current widget",get(this,"id"),interval)},stopRefresh:function(){set(this,"isRefreshable",false)},startRefresh:function(){this.setProperties({isRefreshable:true,lastRefresh:null})},isRollbackable:function(){if(get(this,"isDirty")&&get(this,"dirtyType")==="updated"&&get(this,"rollbackable")===true){return true}return false}.property("isDirty","dirtyType","rollbackable"),actions:{inspect:function(object){debugUtils.inspectObject(object)},"do":function(action){var params=[];for(var i=1,l=arguments.length;i<l;i++){params.push(arguments[i])}this.send(action,params)},creationForm:function(itemType){formsUtils.addRecord(itemType)},rollback:function(widget){console.log("rollback changes",arguments);set(widget,"volatile",{});widget.rollback();set(widget,"rollbackable",false)},editWidget:function(widget){console.info("edit widget",widget);var widgetWizard=formsUtils.showNew("modelform",widget,{title:__("Edit widget")});console.log("widgetWizard",widgetWizard);var widgetController=this;widgetWizard.submit.done(function(){console.log("record going to be saved",widget);if(!get(widget,"widgetId")){set(widget,"widgetId",get(widget,"id"))}var userview=get(widgetController,"viewController").get("content");userview.save().then(function(){get(widgetController,"viewController").send("refresh");console.log("triggering refresh",userview)})})},editMixin:function(widget,mixinName){console.info("edit mixin",widget,mixinName);var mixinDict=get(widget,"mixins").findBy("name",mixinName),mixinModelInstance=dataUtils.getStore().createRecord(mixinName,mixinDict);var mixinForm=formsUtils.showNew("modelform",mixinModelInstance,{title:__("Edit mixin"),inspectedItemType:mixinName});var mixinObject=get(widget,"mixins").findBy("name",mixinName);console.log("mixinObject",mixinObject);var widgetController=this;mixinForm.submit.done(function(){var referenceModel=schemasregistry.getByName(mixinName).EmberModel;var modelAttributes=get(referenceModel,"attributes");console.log("attributes",modelAttributes);modelAttributes.forEach(function(property){console.log("each",arguments);var propertyValue=get(mixinModelInstance,property.name);console.log("mixinObject",mixinObject);set(mixinObject,property.name,propertyValue);console.log(widget.get("mixins"));var userview=get(widgetController,"viewController").get("content");userview.save().then(function(){get(widgetController,"viewController").send("refresh");console.log("triggering refresh",userview)})})})},removeWidget:function(widget){var widgetController=this;var confirmform=formsUtils.showNew("confirmform",{},{title:__("Delete this widget ?")});confirmform.submit.then(function(form){console.group("remove widget",widget);console.log("parent container",widgetController);var itemsContent=get(widgetController,"content.items.content");for(var i=0,l=itemsContent.length;i<l;i++){console.log(get(widgetController,"content.items.content")[i]);if(get(itemsContent[i],"widget")===widget){itemsContent.removeAt(i);console.log("deleteRecord ok");break}}var userview=get(widgetController,"viewController.content");userview.save();console.groupEnd()})},movedown:function(widgetwrapper){console.group("movedown",widgetwrapper);try{console.log("context",this);var foundElementIndex,nextElementIndex,itemsContent=get(this,"content.items.content");for(var i=0,l=itemsContent.length;i<l;i++){if(foundElementIndex!==undefined&&nextElementIndex===undefined){nextElementIndex=i;console.log("next element found")}if(itemsContent[i]===widgetwrapper){foundElementIndex=i;console.log("searched element found")}}if(foundElementIndex!==undefined&&nextElementIndex!==undefined){var array=itemsContent;console.log("swap objects",array);var tempObject=array.objectAt(foundElementIndex);array.insertAt(foundElementIndex,array.objectAt(nextElementIndex));array.insertAt(nextElementIndex,tempObject);array.replace(foundElementIndex+2,2);console.log("new array",array);set(this,"content.items.content",array);var widgetController=this,userview=get(this,"viewController.content");userview.save()}}catch(e){console.error(e.stack,e.message)}console.groupEnd()},moveup:function(widgetwrapper){console.group("moveup",widgetwrapper);try{console.log("context",this);var foundElementIndex,nextElementIndex,itemsContent=get(this,"content.items.content");for(var i=itemsContent.length;i>=0;i--){if(foundElementIndex!==undefined&&nextElementIndex===undefined){nextElementIndex=i;console.log("next element found")}if(itemsContent[i]===widgetwrapper){foundElementIndex=i;console.log("searched element found")}}console.log("indexes to swap",foundElementIndex,nextElementIndex);if(foundElementIndex!==undefined&&nextElementIndex!==undefined){var array=get(this,"content.items.content");console.log("swap objects",array);var tempObject=array.objectAt(foundElementIndex);array.insertAt(foundElementIndex,array.objectAt(nextElementIndex));array.insertAt(nextElementIndex,tempObject);array.replace(nextElementIndex+2,2);console.log("new array",array);set(this,"content.items.content",array);var widgetController=this,userview=get(widgetUtils.getParentViewForWidget(this),"content");userview.save()}}catch(e){console.error(e.stack,e.message)}console.groupEnd()}},itemController:function(){if(get(this,"itemType")){return get(this,"itemType").capitalize()}}.property("itemType"),refreshContent:function(){console.log("refreshContent",get(this,"xtype"));this._super();this.findItems();this.setProperties({lastRefresh:(new Date).getTime(),lastRefreshControlDelay:true})},findItems:function(){console.warn("findItems not implemented",this)},extractItems:function(queryResult){console.log("extractItems",queryResult);this._super(queryResult);set(this,"widgetData",queryResult)},availableTitlebarButtons:function(){var buttons=get(this,"_partials.titlebarsbuttons");if(buttons===undefined){return Ember.A()}var res=Ember.A();for(var i=0,l=buttons.length;i<l;i++){var currentButton=buttons[i];if(Ember.TEMPLATES[currentButton]!==undefined){res.pushObject(currentButton)}else{console.warn("template not found",currentButton)}}return res}.property()});application.register("controller:widget",controller)}});(function(){window.registries={};var get=Ember.get,set=Ember.set,isNone=Ember.isNone;isArray=Ember.isArray;var AbstractClassRegistry=Ember.Object.extend({init:function(){this._super.apply(this,arguments);var name=get(this,"name");window.registries[name]=this},name:"unnamed registry",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}],add:function(item,name,classes){if(isNone(name)){name=get(item,"name")}else{set(item,"name",name)}if(isNone(classes)){classes=get(item,"classes")}else{set(item,"classes",classes)}console.log("registering item",get(item,"name"),"into registry",name,"with classes",classes);this.all.pushObject(item);if(isArray(classes)){for(var i=0,l=classes.length;i<l;i++){if(isNone(this.byClass[classes[i]])){this.byClass[classes[i]]=Ember.A()}this.byClass[classes[i]].pushObject(item)}}},getByName:function(name){for(var i=0,l=this.all.length;i<l;i++){if(get(this.all[i],"name")===name){return this.all[i]}}},getByClassName:function(name){return get(this.byClass,name)}});Ember.Application.initializer({name:"AbstractClassRegistry",initialize:function(container,application){application.register("registry:abstractclass",AbstractClassRegistry)}});return AbstractClassRegistry})();Ember.Application.initializer({name:"ContextsRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var contexts=[{name:"component",modelName:"ctxcomponent"},{name:"resource",modelName:"ctxresource"},{name:"selector",modelName:"ctxselector"},{name:"topology",modelName:"ctxtopology"}];var registry=Abstractclassregistry.create({name:"contexts",all:[],byClass:{},tableColumns:[{title:"name",name:"name"},{title:"modelName",name:"modelName"}]});for(var i=0,l=contexts.length;i<l;i++){registry.all.pushObject({name:contexts[i].name,modelName:contexts[i].modelName})}application.register("registry:contexts",registry)}});var _baseConsole=console;if(Array.prototype.contains===undefined){Array.prototype.contains=function(obj){var i=this.length;while(i--){if(this[i]===obj){return true}}return false}}console={_filter:undefined,internal:{generateMessageAdditions:function(consoleObject,argumentsArray,forceDisplay){var args=[];var i;var file_split;try{file_split=(new Error).stack.split("\n")[3].split("/")}catch(e){return null}var file_location=file_split[file_split.length-1];for(i=1,l=consoleObject.tags._authorFoldersDisplay;i<l;i++){file_location=file_split[file_split.length-i-1]+"/"+file_location}file_location=file_location.replace(")","");var file_location_split=file_location.split(":");var filename=file_location_split[0];var line_number=file_location_split[1]+":"+file_location_split[2];var selectedTags=console.tags._selectedTags;var selectedTagsContainsFilename=selectedTags.contains(filename);if(selectedTags!==undefined&&selectedTags!==null&&selectedTagsContainsFilename){return null}var args_tags="["+filename+"]["+line_number+"]";var tagMatchSelectedTag=false;if(consoleObject.tags._tags!==undefined){for(i=0,l=consoleObject.tags._tags.length-1;i<=l;i++){if(selectedTags.contains(consoleObject.tags._tags[i])){tagMatchSelectedTag=true}args_tags+="["+consoleObject.tags._tags[i]+"]"}}if(!forceDisplay){if(consoleObject.tags._muteAllByDefault===true){
if(selectedTags!==undefined&&selectedTags!==null&&!selectedTagsContainsFilename){return null}if(tagMatchSelectedTag===false){return null}}else{if(selectedTags!==undefined&&selectedTags!==null&&selectedTagsContainsFilename){return null}if(tagMatchSelectedTag===true){return null}}}if(!!consoleObject.style._colors){args_tags="%c"+args_tags;args.push(args_tags);args.push("background: #444; color: #eee; border-radius:4px;padding:2px")}else{args.push(args_tags)}if(consoleObject._filter!==""&&consoleObject._filter!==undefined&&consoleObject._filter!==null){for(i=0,l=args.length;i<l;i++){if(typeof args[i]==="string"){var regex=new RegExp(consoleObject._filter);if(regex.test(args[i])){if(!forceDisplay)return null}}}}if(!!consoleObject.stacks.display){var err=new Error;consoleObject.stacks._stacks.push(err.stack);args.push("[>"+consoleObject.stacks._stacks.length+"]")}for(i=0,l=argumentsArray.length;i<l;i++){args.push(argumentsArray[i])}return args}},init:function(){console.log("load settings from localStorage, if possible");this.settings.load();if(this.tags._selectedTags===undefined||this.tags._selectedTags===null){this.tags._selectedTags=[]}this.tags.flush()},log:function(){var args=this.internal.generateMessageAdditions(this,arguments);if(args!==null){_baseConsole.log.apply(_baseConsole,args);this.backends.send("log",args)}},debug:function(){var args=this.internal.generateMessageAdditions(this,arguments);if(args!==null){_baseConsole.log.apply(_baseConsole,args);this.backends.send("log",args)}},time:function(){_baseConsole.time.apply(_baseConsole,arguments)},timeEnd:function(){_baseConsole.time.apply(_baseConsole,arguments)},group:function(){var args=console.internal.generateMessageAdditions(this,arguments,true);if(args!==null){_baseConsole.group.apply(_baseConsole,args);this.backends.send("group",args)}},groupEnd:function(){var args=this.internal.generateMessageAdditions(this,arguments,true);if(args!==null){_baseConsole.groupEnd.apply(_baseConsole,args);this.backends.send("groupEnd",args)}},groupCollapsed:function(){var args=this.internal.generateMessageAdditions(this,arguments,true);if(args!==null){_baseConsole.groupCollapsed.apply(_baseConsole,args);this.backends.send("groupCollapsed",args)}},info:function(){var args=this.internal.generateMessageAdditions(this,arguments);if(args!==null){_baseConsole.info.apply(_baseConsole,args);this.backends.send("info",args)}},warn:function(){var args=this.internal.generateMessageAdditions(this,arguments,true);if(args!==null){_baseConsole.warn.apply(_baseConsole,args);this.backends.send("warn",args)}},error:function(){var args=this.internal.generateMessageAdditions(this,arguments,true);if(args!==null){_baseConsole.error.apply(_baseConsole,args);this.backends.send("error",args)}},backends:{_backends:{},add:function(name,backendObject){this._backends[name]=backendObject},remove:function(name){delete this._backends[name]},send:function(function_name,args){for(backend in this._backends){this._backends[backend].send(function_name,args)}}},stacks:{_stacks:[],display:false,get:function(index){return this._stacks[index]}},tags:{_tags:[],_selectedTags:[],_muteAllByDefault:true,_author:undefined,_authorFoldersDisplay:2,add:function(tag){this._tags.push(tag)},remove:function(tag){for(var i=0,l=this._tags.length;i<l;i++){if(this._tags[i]===tag){this._tags.splice(i,1);return}}},select:function(tag){this._selectedTags.push(tag)},unselect:function(tag){for(var i=0,l=this._selectedTags.length;i<l;i++){if(this._selectedTags[i]===tag){this._selectedTags.splice(i,1);return}}},flush:function(){this._tags=[]}},filterMessages:function(regex){this._filter=regex},settings:{_savedProperties:["tags._selectedTags","style._colors","stacks.display","tags._authorFoldersDisplay","tags._muteAllByDefault"],save:function(){for(var i=0,l=this._savedProperties.length;i<l;i++){var currentPropStr="console."+this._savedProperties[i];var val=eval(currentPropStr);if(typeof val==="string"){val="'"+val+"'"}else if(typeof val==="object"){val=JSON.stringify(val)}localStorage.setItem(currentPropStr,val)}},load:function(){for(var i=0,l=this._savedProperties.length;i<l;i++){var currentPropStr="console."+this._savedProperties[i];eval(currentPropStr+"= "+localStorage.getItem(currentPropStr))}},reset:function(){for(var i=0,l=this._savedProperties.length;i<l;i++){var currentPropStr="console."+this._savedProperties[i];eval(currentPropStr+"= "+undefined)}}},style:{_colors:false}};console.init();(function($,document,window,navigator){"use strict";var plugin_count=0,current;var is_old_ie=function(){var n=navigator.userAgent,r=/msie\s\d+/i,v;if(n.search(r)>0){v=r.exec(n).toString();v=v.split(" ")[1];if(v<9){return true}}return false}();var is_touch="ontouchstart"in window||navigator.msMaxTouchPoints>0;var testNumber=function(num){if(typeof num==="number"){if(isNaN(num)){return null}else{return num}}else{num=parseFloat(num);if(isNaN(num)){return null}else{return num}}};var methods={init:function(options){var baseHTML='<span class="irs">'+'<span class="irs-line"><span class="irs-line-left"></span><span class="irs-line-mid"></span><span class="irs-line-right"></span></span>'+'<span class="irs-min">0</span><span class="irs-max">1</span>'+'<span class="irs-from">0</span><span class="irs-to">0</span><span class="irs-single">0</span>'+"</span>"+'<span class="irs-grid"></span>';var singleHTML='<span class="irs-slider single"></span>';var doubleHTML='<span class="irs-diapason"></span>'+'<span class="irs-slider from"></span>'+'<span class="irs-slider to"></span>';var disableHTML='<span class="irs-disable-mask"></span>';return this.each(function(){var settings=$.extend({min:null,max:null,from:null,to:null,type:"single",step:null,prefix:"",postfix:"",maxPostfix:"",hasGrid:false,gridMargin:0,hideMinMax:false,hideFromTo:false,prettify:true,disable:false,values:null,onLoad:null,onChange:null,onFinish:null},options);var slider=$(this),self=this,allow_values=false,value_array=null;if(slider.data("isActive")){return}slider.data("isActive",true);plugin_count+=1;this.plugin_count=plugin_count;if(slider.prop("value")){value_array=slider.prop("value").split(";")}if(settings.type==="single"){if(value_array&&value_array.length>1){if(typeof settings.min!=="number"){settings.min=parseFloat(value_array[0])}else{if(typeof settings.from!=="number"){settings.from=parseFloat(value_array[0])}}if(typeof settings.max!=="number"){settings.max=parseFloat(value_array[1])}}else if(value_array&&value_array.length===1){if(typeof settings.from!=="number"){settings.from=parseFloat(value_array[0])}}}else if(settings.type==="double"){if(value_array&&value_array.length>1){if(typeof settings.min!=="number"){settings.min=parseFloat(value_array[0])}else{if(typeof settings.from!=="number"){settings.from=parseFloat(value_array[0])}}if(typeof settings.max!=="number"){settings.max=parseFloat(value_array[1])}else{if(typeof settings.to!=="number"){settings.to=parseFloat(value_array[1])}}}else if(value_array&&value_array.length===1){if(typeof settings.min!=="number"){settings.min=parseFloat(value_array[0])}else{if(typeof settings.from!=="number"){settings.from=parseFloat(value_array[0])}}}}if(typeof slider.data("min")==="number"){settings.min=parseFloat(slider.data("min"))}if(typeof slider.data("max")==="number"){settings.max=parseFloat(slider.data("max"))}if(typeof slider.data("from")==="number"){settings.from=parseFloat(slider.data("from"))}if(typeof slider.data("to")==="number"){settings.to=parseFloat(slider.data("to"))}if(slider.data("step")){settings.step=parseFloat(slider.data("step"))}if(slider.data("type")){settings.type=slider.data("type")}if(slider.data("prefix")){settings.prefix=slider.data("prefix")}if(slider.data("postfix")){settings.postfix=slider.data("postfix")}if(slider.data("maxpostfix")){settings.maxPostfix=slider.data("maxpostfix")}if(slider.data("hasgrid")){settings.hasGrid=slider.data("hasgrid")}if(slider.data("gridmargin")){settings.gridMargin=+slider.data("gridmargin")}if(slider.data("hideminmax")){settings.hideMinMax=slider.data("hideminmax")}if(slider.data("hidefromto")){settings.hideFromTo=slider.data("hidefromto")}if(slider.data("prettify")){settings.prettify=slider.data("prettify")}if(slider.data("disable")){settings.disable=slider.data("disable")}if(slider.data("values")){settings.values=slider.data("values").split(",")}settings.min=testNumber(settings.min);if(!settings.min&&settings.min!==0){settings.min=10}settings.max=testNumber(settings.max);if(!settings.max&&settings.max!==0){settings.max=100}if(Object.prototype.toString.call(settings.values)!=="[object Array]"){settings.values=null}if(settings.values&&settings.values.length>0){settings.min=0;settings.max=settings.values.length-1;settings.step=1;allow_values=true}settings.from=testNumber(settings.from);if(!settings.from&&settings.from!==0){settings.from=settings.min}settings.to=testNumber(settings.to);if(!settings.to&&settings.to!==0){settings.to=settings.max}settings.step=testNumber(settings.step);if(!settings.step){settings.step=1}if(settings.from<settings.min){settings.from=settings.min}if(settings.from>settings.max){settings.from=settings.min}if(settings.to<settings.min){settings.to=settings.max}if(settings.to>settings.max){settings.to=settings.max}if(settings.type==="double"){if(settings.from>settings.to){settings.from=settings.to}if(settings.to<settings.from){settings.to=settings.from}}var prettify=function(num){var n=num.toString();if(settings.prettify){n=n.replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g,"$1 ")}return n};var containerHTML='<span class="irs" id="irs-'+this.plugin_count+'"></span>';slider[0].style.display="none";slider.before(containerHTML);var $container=slider.prev(),$body=$(document.body),$window=$(window),$rangeSlider,$fieldMin,$fieldMax,$fieldFrom,$fieldTo,$fieldSingle,$singleSlider,$fromSlider,$toSlider,$activeSlider,$diapason,$grid;var allowDrag=false,is_slider_active=false,is_first_start=true,numbers={};var mouseX=0,fieldMinWidth=0,fieldMaxWidth=0,normalWidth=0,fullWidth=0,sliderWidth=0,width=0,left=0,right=0,minusX=0,stepFloat=0;if(parseInt(settings.step,10)!==parseFloat(settings.step)){stepFloat=settings.step.toString().split(".")[1];stepFloat=Math.pow(10,stepFloat.length)}this.updateData=function(options){$.extend(settings,options);removeHTML()};this.removeSlider=function(){$container.find("*").off();$window.off("mouseup.irs"+self.plugin_count);$body.off("mouseup.irs"+self.plugin_count);$body.off("mouseleave.irs"+self.plugin_count);$body.off("mousemove.irs"+self.plugin_count);$container.html("").remove();slider.data("isActive",false);slider.show()};var removeHTML=function(){$container.find("*").off();$window.off("mouseup.irs"+self.plugin_count);$body.off("mouseup.irs"+self.plugin_count);$body.off("mouseleave.irs"+self.plugin_count);$body.off("mousemove.irs"+self.plugin_count);$container.html("");placeHTML()};var placeHTML=function(){$container.html(baseHTML);$rangeSlider=$container.find(".irs");$fieldMin=$rangeSlider.find(".irs-min");$fieldMax=$rangeSlider.find(".irs-max");$fieldFrom=$rangeSlider.find(".irs-from");$fieldTo=$rangeSlider.find(".irs-to");$fieldSingle=$rangeSlider.find(".irs-single");$grid=$container.find(".irs-grid");if(settings.hideFromTo){$fieldFrom[0].style.visibility="hidden";$fieldTo[0].style.visibility="hidden";$fieldSingle[0].style.visibility="hidden"}if(!settings.hideFromTo){$fieldFrom[0].style.visibility="visible";$fieldTo[0].style.visibility="visible";$fieldSingle[0].style.visibility="visible"}if(settings.hideMinMax){$fieldMin[0].style.visibility="hidden";$fieldMax[0].style.visibility="hidden";fieldMinWidth=0;fieldMaxWidth=0}if(!settings.hideMinMax){$fieldMin[0].style.visibility="visible";$fieldMax[0].style.visibility="visible";if(settings.values){$fieldMin.html(settings.prefix+settings.values[0]+settings.postfix);$fieldMax.html(settings.prefix+settings.values[settings.values.length-1]+settings.maxPostfix+settings.postfix)}else{$fieldMin.html(settings.prefix+prettify(settings.min)+settings.postfix);$fieldMax.html(settings.prefix+prettify(settings.max)+settings.maxPostfix+settings.postfix)}fieldMinWidth=$fieldMin.outerWidth(false);fieldMaxWidth=$fieldMax.outerWidth(false)}bindEvents()};var bindEvents=function(){if(settings.type==="single"){$rangeSlider.append(singleHTML);$singleSlider=$rangeSlider.find(".single");$singleSlider.on("mousedown",function(e){e.preventDefault();e.stopPropagation();calcDimensions(e,$(this),null);allowDrag=true;is_slider_active=true;current=self.plugin_count;if(is_old_ie){$("*").prop("unselectable",true)}});if(is_touch){$singleSlider.on("touchstart",function(e){e.preventDefault();e.stopPropagation();calcDimensions(e.originalEvent.touches[0],$(this),null);allowDrag=true;is_slider_active=true;current=self.plugin_count})}}else if(settings.type==="double"){$rangeSlider.append(doubleHTML);$fromSlider=$rangeSlider.find(".from");$toSlider=$rangeSlider.find(".to");$diapason=$rangeSlider.find(".irs-diapason");setDiapason();$fromSlider.on("mousedown",function(e){e.preventDefault();e.stopPropagation();$(this).addClass("last");$toSlider.removeClass("last");calcDimensions(e,$(this),"from");allowDrag=true;is_slider_active=true;current=self.plugin_count;if(is_old_ie){$("*").prop("unselectable",true)}});$toSlider.on("mousedown",function(e){e.preventDefault();e.stopPropagation();$(this).addClass("last");$fromSlider.removeClass("last");calcDimensions(e,$(this),"to");allowDrag=true;is_slider_active=true;current=self.plugin_count;if(is_old_ie){$("*").prop("unselectable",true)}});if(is_touch){$fromSlider.on("touchstart",function(e){e.preventDefault();e.stopPropagation();$(this).addClass("last");$toSlider.removeClass("last");calcDimensions(e.originalEvent.touches[0],$(this),"from");allowDrag=true;is_slider_active=true;current=self.plugin_count});$toSlider.on("touchstart",function(e){e.preventDefault();e.stopPropagation();$(this).addClass("last");$fromSlider.removeClass("last");calcDimensions(e.originalEvent.touches[0],$(this),"to");allowDrag=true;is_slider_active=true;current=self.plugin_count})}if(settings.to===settings.max){$fromSlider.addClass("last")}}var mouseup=function(){if(current!==self.plugin_count){return}if(allowDrag){is_slider_active=false;allowDrag=false;$activeSlider.removeAttr("id");$activeSlider=null;if(settings.type==="double"){setDiapason()}getNumbers();if(is_old_ie){$("*").prop("unselectable",false)}}};$window.on("mouseup.irs"+self.plugin_count,function(){mouseup()});if(is_old_ie){$body.on("mouseleave.irs"+self.plugin_count,function(){mouseup()})}$body.on("mousemove.irs"+self.plugin_count,function(e){if(allowDrag){mouseX=e.pageX;dragSlider()}});$container.on("mousedown",function(){current=self.plugin_count});$container.on("mouseup",function(e){if(current!==self.plugin_count){return}if(allowDrag||settings.disable){return}moveByClick(e.pageX)});if(is_touch){$window.on("touchend",function(){if(allowDrag){is_slider_active=false;allowDrag=false;$activeSlider.removeAttr("id");$activeSlider=null;if(settings.type==="double"){setDiapason()}getNumbers()}});$window.on("touchmove",function(e){if(allowDrag){mouseX=e.originalEvent.touches[0].pageX;dragSlider()}})}getSize();setNumbers();if(settings.hasGrid){setGrid()}if(settings.disable){setMask()}else{removeMask()}};var getSize=function(){normalWidth=$rangeSlider.width();if($singleSlider){sliderWidth=$singleSlider.width()}else{sliderWidth=$fromSlider.width()}fullWidth=normalWidth-sliderWidth};var calcDimensions=function(e,currentSlider,whichSlider){getSize();is_first_start=false;$activeSlider=currentSlider;$activeSlider.prop("id","irs-active-slider");var _x1=$activeSlider.offset().left,_x2=e.pageX-_x1;minusX=_x1+_x2-$activeSlider.position().left;if(settings.type==="single"){width=$rangeSlider.width()-sliderWidth}else if(settings.type==="double"){if(whichSlider==="from"){left=0;right=parseInt($toSlider.css("left"),10)}else{left=parseInt($fromSlider.css("left"),10);right=$rangeSlider.width()-sliderWidth}}};var setDiapason=function(){var _w=$fromSlider.width(),_x=$.data($fromSlider[0],"x")||parseInt($fromSlider[0].style.left,10)||$fromSlider.position().left,_width=$.data($toSlider[0],"x")||parseInt($toSlider[0].style.left,10)||$toSlider.position().left,x=_x+_w/2,w=_width-_x;$diapason[0].style.left=x+"px";$diapason[0].style.width=w+"px"};var dragSlider=function(manual_x){var x_pure=mouseX-minusX,x;if(manual_x){x_pure=manual_x}else{x_pure=mouseX-minusX}if(settings.type==="single"){if(x_pure<0){x_pure=0}if(x_pure>width){x_pure=width}}else if(settings.type==="double"){if(x_pure<left){x_pure=left}if(x_pure>right){x_pure=right}setDiapason()}$.data($activeSlider[0],"x",x_pure);getNumbers();x=Math.round(x_pure);$activeSlider[0].style.left=x+"px"};var getNumbers=function(){var nums={input:slider,slider:$container,min:settings.min,max:settings.max,fromNumber:0,toNumber:0,fromPers:0,toPers:0,fromX:0,fromX_pure:0,toX:0,toX_pure:0};var diapason=settings.max-settings.min,_from,_to;if(settings.type==="single"){nums.fromX=$.data($singleSlider[0],"x")||parseInt($singleSlider[0].style.left,10)||$singleSlider.position().left;nums.fromPers=nums.fromX/fullWidth*100;_from=diapason/100*nums.fromPers+settings.min;nums.fromNumber=Math.round(_from/settings.step)*settings.step;if(nums.fromNumber<settings.min){nums.fromNumber=settings.min}if(nums.fromNumber>settings.max){nums.fromNumber=settings.max}if(stepFloat){nums.fromNumber=parseInt(nums.fromNumber*stepFloat,10)/stepFloat}if(allow_values){nums.fromValue=settings.values[nums.fromNumber]}}else if(settings.type==="double"){nums.fromX=$.data($fromSlider[0],"x")||parseInt($fromSlider[0].style.left,10)||$fromSlider.position().left;nums.fromPers=nums.fromX/fullWidth*100;_from=diapason/100*nums.fromPers+settings.min;nums.fromNumber=Math.round(_from/settings.step)*settings.step;if(nums.fromNumber<settings.min){nums.fromNumber=settings.min}nums.toX=$.data($toSlider[0],"x")||parseInt($toSlider[0].style.left,10)||$toSlider.position().left;nums.toPers=nums.toX/fullWidth*100;_to=diapason/100*nums.toPers+settings.min;nums.toNumber=Math.round(_to/settings.step)*settings.step;if(nums.toNumber>settings.max){nums.toNumber=settings.max}if(stepFloat){nums.fromNumber=parseInt(nums.fromNumber*stepFloat,10)/stepFloat;nums.toNumber=parseInt(nums.toNumber*stepFloat,10)/stepFloat}if(allow_values){nums.fromValue=settings.values[nums.fromNumber];nums.toValue=settings.values[nums.toNumber]}}numbers=nums;setFields()};var setNumbers=function(){var nums={input:slider,slider:$container,min:settings.min,max:settings.max,fromNumber:settings.from,toNumber:settings.to,fromPers:0,toPers:0,fromX:0,fromX_pure:0,toX:0,toX_pure:0};var diapason=settings.max-settings.min;if(settings.type==="single"){nums.fromPers=diapason!==0?(nums.fromNumber-settings.min)/diapason*100:0;nums.fromX_pure=fullWidth/100*nums.fromPers;nums.fromX=Math.round(nums.fromX_pure);$singleSlider[0].style.left=nums.fromX+"px";$.data($singleSlider[0],"x",nums.fromX_pure)}else if(settings.type==="double"){nums.fromPers=diapason!==0?(nums.fromNumber-settings.min)/diapason*100:0;nums.fromX_pure=fullWidth/100*nums.fromPers;nums.fromX=Math.round(nums.fromX_pure);$fromSlider[0].style.left=nums.fromX+"px";$.data($fromSlider[0],"x",nums.fromX_pure);nums.toPers=diapason!==0?(nums.toNumber-settings.min)/diapason*100:1;nums.toX_pure=fullWidth/100*nums.toPers;nums.toX=Math.round(nums.toX_pure);$toSlider[0].style.left=nums.toX+"px";$.data($toSlider[0],"x",nums.toX_pure);setDiapason()}numbers=nums;setFields()};var moveByClick=function(page_x){is_first_start=false;var x=page_x-$container.offset().left,d=numbers.toX-numbers.fromX,zero_point=numbers.fromX+d/2;left=0;width=$rangeSlider.width()-sliderWidth;right=$rangeSlider.width()-sliderWidth;if(settings.type==="single"){$activeSlider=$singleSlider;$activeSlider.prop("id","irs-active-slider");dragSlider(x)}else if(settings.type==="double"){if(x<=zero_point){$activeSlider=$fromSlider}else{$activeSlider=$toSlider}$activeSlider.prop("id","irs-active-slider");dragSlider(x);setDiapason()}$activeSlider.removeAttr("id");$activeSlider=null};var setFields=function(){var _from,_fromW,_fromX,_to,_toW,_toX,_single,_singleW,_singleX,_slW=sliderWidth/2,maxPostfix="";if(settings.type==="single"){if(numbers.fromNumber===settings.max){maxPostfix=settings.maxPostfix}else{maxPostfix=""}$fieldFrom[0].style.display="none";$fieldTo[0].style.display="none";if(allow_values){_single=settings.prefix+settings.values[numbers.fromNumber]+maxPostfix+settings.postfix}else{_single=settings.prefix+prettify(numbers.fromNumber)+maxPostfix+settings.postfix}$fieldSingle.html(_single);_singleW=$fieldSingle.outerWidth(false);_singleX=numbers.fromX-_singleW/2+_slW;if(_singleX<0){_singleX=0}if(_singleX>normalWidth-_singleW){_singleX=normalWidth-_singleW}$fieldSingle[0].style.left=_singleX+"px";if(!settings.hideMinMax&&!settings.hideFromTo){if(_singleX<fieldMinWidth){$fieldMin[0].style.display="none"}else{$fieldMin[0].style.display="block"}if(_singleX+_singleW>normalWidth-fieldMaxWidth){$fieldMax[0].style.display="none"}else{$fieldMax[0].style.display="block"}}slider.prop("value",parseFloat(numbers.fromNumber))}else if(settings.type==="double"){if(numbers.fromNumber===settings.max){maxPostfix=settings.maxPostfix}else{maxPostfix=""}if(numbers.toNumber===settings.max){maxPostfix=settings.maxPostfix}else{maxPostfix=""}if(allow_values){_from=settings.prefix+settings.values[numbers.fromNumber]+settings.postfix;_to=settings.prefix+settings.values[numbers.toNumber]+maxPostfix+settings.postfix;if(numbers.fromNumber!==numbers.toNumber){_single=settings.prefix+settings.values[numbers.fromNumber]+" — "+settings.prefix+settings.values[numbers.toNumber]+maxPostfix+settings.postfix}else{_single=settings.prefix+settings.values[numbers.fromNumber]+maxPostfix+settings.postfix}}else{_from=settings.prefix+prettify(numbers.fromNumber)+settings.postfix;_to=settings.prefix+prettify(numbers.toNumber)+maxPostfix+settings.postfix;if(numbers.fromNumber!==numbers.toNumber){_single=settings.prefix+prettify(numbers.fromNumber)+" — "+settings.prefix+prettify(numbers.toNumber)+maxPostfix+settings.postfix}else{_single=settings.prefix+prettify(numbers.fromNumber)+maxPostfix+settings.postfix}}$fieldFrom.html(_from);$fieldTo.html(_to);$fieldSingle.html(_single);_fromW=$fieldFrom.outerWidth(false);_fromX=numbers.fromX-_fromW/2+_slW;if(_fromX<0){_fromX=0}if(_fromX>normalWidth-_fromW){_fromX=normalWidth-_fromW}$fieldFrom[0].style.left=_fromX+"px";_toW=$fieldTo.outerWidth(false);_toX=numbers.toX-_toW/2+_slW;if(_toX<0){_toX=0}if(_toX>normalWidth-_toW){_toX=normalWidth-_toW}$fieldTo[0].style.left=_toX+"px";_singleW=$fieldSingle.outerWidth(false);_singleX=numbers.fromX+(numbers.toX-numbers.fromX)/2-_singleW/2+_slW;if(_singleX<0){_singleX=0}if(_singleX>normalWidth-_singleW){_singleX=normalWidth-_singleW}$fieldSingle[0].style.left=_singleX+"px";if(_fromX+_fromW<_toX){$fieldSingle[0].style.display="none";$fieldFrom[0].style.display="block";$fieldTo[0].style.display="block"}else{$fieldSingle[0].style.display="block";$fieldFrom[0].style.display="none";$fieldTo[0].style.display="none"}if(!settings.hideMinMax&&!settings.hideFromTo){if(_singleX<fieldMinWidth||_fromX<fieldMinWidth){$fieldMin[0].style.display="none"}else{$fieldMin[0].style.display="block"}if(_singleX+_singleW>normalWidth-fieldMaxWidth||_toX+_toW>normalWidth-fieldMaxWidth){$fieldMax[0].style.display="none"}else{$fieldMax[0].style.display="block"}}slider.prop("value",parseFloat(numbers.fromNumber)+";"+parseFloat(numbers.toNumber))}settings.from=numbers.fromNumber;settings.to=numbers.toNumber;callbacks()};var callbacks=function(){if(typeof settings.onFinish==="function"&&!is_slider_active&&!is_first_start){settings.onFinish.call(this,numbers)}if(typeof settings.onChange==="function"&&!is_first_start){settings.onChange.call(this,numbers)}if(typeof settings.onLoad==="function"&&!is_slider_active&&is_first_start){settings.onLoad.call(this,numbers);is_first_start=false}};var setGrid=function(){$container.addClass("irs-with-grid");var i,text="",step=0,tStep=0,gridHTML="",smNum=20,bigNum=4,cont_width=normalWidth-settings.gridMargin*2;for(i=0;i<=smNum;i+=1){step=Math.floor(cont_width/smNum*i);if(step>=cont_width){step=cont_width-1}gridHTML+='<span class="irs-grid-pol small" style="left: '+step+'px;"></span>'}for(i=0;i<=bigNum;i+=1){step=Math.floor(cont_width/bigNum*i);if(step>=cont_width){step=cont_width-1}gridHTML+='<span class="irs-grid-pol" style="left: '+step+'px;"></span>';if(stepFloat){text=settings.min+(settings.max-settings.min)/bigNum*i;text=text/settings.step*settings.step;text=parseInt(text*stepFloat,10)/stepFloat}else{text=Math.round(settings.min+(settings.max-settings.min)/bigNum*i);text=Math.round(text/settings.step)*settings.step;text=prettify(text)}if(allow_values){if(settings.hideMinMax){text=Math.round(settings.min+(settings.max-settings.min)/bigNum*i);text=Math.round(text/settings.step)*settings.step;if(i===0||i===bigNum){text=settings.values[text]}else{text=""}}else{text=""}}if(i===0){tStep=step;gridHTML+='<span class="irs-grid-text" style="left: '+tStep+'px; text-align: left;">'+text+"</span>"}else if(i===bigNum){tStep=step-100;gridHTML+='<span class="irs-grid-text" style="left: '+tStep+'px; text-align: right;">'+text+"</span>"}else{tStep=step-50;gridHTML+='<span class="irs-grid-text" style="left: '+tStep+'px;">'+text+"</span>"}}$grid.html(gridHTML);$grid[0].style.left=settings.gridMargin+"px"};var setMask=function(){$container.addClass("irs-disabled");$container.append(disableHTML)};var removeMask=function(){$container.removeClass("irs-disabled");$container.find(".irs-disable-mask").remove()};placeHTML()})},update:function(options){return this.each(function(){this.updateData(options)})},remove:function(){return this.each(function(){this.removeSlider()})}};$.fn.ionRangeSlider=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist for jQuery.ionRangeSlider")}}})(jQuery,document,window,navigator);(function($,h,c){var a=$([]),e=$.resize=$.extend($.resize,{}),i,k="setTimeout",j="resize",d=j+"-special-event",b="delay",f="throttleWindow";e[b]=250;e[f]=true;$.event.special[j]={setup:function(){if(!e[f]&&this[k]){return false}var l=$(this);a=a.add(l);$.data(this,d,{w:l.width(),h:l.height()});if(a.length===1){g()}},teardown:function(){if(!e[f]&&this[k]){return false}var l=$(this);a=a.not(l);l.removeData(d);if(!a.length){clearTimeout(i)}},add:function(l){if(!e[f]&&this[k]){return false}var n;function m(s,o,p){var q=$(this),r=$.data(this,d);r.w=o!==c?o:q.width();r.h=p!==c?p:q.height();n.apply(this,arguments)}if($.isFunction(l)){n=l;return m}else{n=l.handler;l.handler=m}}};function g(){i=h[k](function(){a.each(function(){var n=$(this),m=n.width(),l=n.height(),o=$.data(this,d);if(m!==o.w||l!==o.h){n.trigger(j,[o.w=m,o.h=l])}});g()},e[b])}})(jQuery,this);(function(exports){var toString=Object.prototype.toString;function jsonParse(str){try{if(JSON&&JSON.parse){return JSON.parse(str)}return new Function("return "+str)()}catch(e){te("ijs",e.message)}}var errorCodes={bop:"binary operator expected",ee:"expression expected",epex:"closing paren expected ')'",ijs:"invalid json string",mcp:"missing closing paren",mepf:"malformed expression in pseudo-function",mexp:"multiple expressions not allowed",mpc:"multiple pseudo classes (:xxx) not allowed",nmi:"multiple ids not allowed",pex:"opening paren expected '('",se:"selector expected",sex:"string expected",sra:"string required after '.'",uc:"unrecognized char",ucp:"unexpected closing paren",ujs:"unclosed json string",upc:"unrecognized pseudo class"};function te(ec,context){throw new Error(errorCodes[ec]+(context&&" in '"+context+"'"))}var toks={psc:1,psf:2,typ:3,str:4,ide:5};var pat=new RegExp("^(?:"+"([\\r\\n\\t\\ ]+)|"+"([~*,>\\)\\(])|"+"(string|boolean|null|array|object|number)|"+"(:(?:root|first-child|last-child|only-child))|"+"(:(?:nth-child|nth-last-child|has|expr|val|contains))|"+"(:\\w+)|"+'(?:(\\.)?(\\"(?:[^\\\\\\"]|\\\\[^\\"])*\\"))|'+'(\\")|'+"\\.((?:[_a-zA-Z]|[^\\0-\\0177]|\\\\[^\\r\\n\\f0-9a-fA-F])(?:[_a-zA-Z0-9\\-]|[^\\u0000-\\u0177]|(?:\\\\[^\\r\\n\\f0-9a-fA-F]))*)"+")");var nthPat=/^\s*\(\s*(?:([+\-]?)([0-9]*)n\s*(?:([+\-])\s*([0-9]))?|(odd|even)|([+\-]?[0-9]+))\s*\)/;function lex(str,off){if(!off)off=0;var m=pat.exec(str.substr(off));if(!m)return undefined;off+=m[0].length;var a;if(m[1])a=[off," "];else if(m[2])a=[off,m[0]];else if(m[3])a=[off,toks.typ,m[0]];else if(m[4])a=[off,toks.psc,m[0]];else if(m[5])a=[off,toks.psf,m[0]];else if(m[6])te("upc",str);else if(m[8])a=[off,m[7]?toks.ide:toks.str,jsonParse(m[8])];else if(m[9])te("ujs",str);else if(m[10])a=[off,toks.ide,m[10].replace(/\\([^\r\n\f0-9a-fA-F])/g,"$1")];return a}var exprPat=new RegExp("^\\s*(?:"+"(true|false|null)|"+"(-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)|"+'("(?:[^\\]|\\[^"])*")|'+"(x)|"+"(&&|\\|\\||[\\$\\^<>!\\*]=|[=+\\-*/%<>])|"+"([\\(\\)])"+")");function is(o,t){return typeof o===t}var operators={"*":[9,function(lhs,rhs){return lhs*rhs}],"/":[9,function(lhs,rhs){return lhs/rhs}],"%":[9,function(lhs,rhs){return lhs%rhs}],"+":[7,function(lhs,rhs){return lhs+rhs}],"-":[7,function(lhs,rhs){return lhs-rhs}],"<=":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&lhs<=rhs}],">=":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&lhs>=rhs}],"$=":[5,function(lhs,rhs){return is(lhs,"string")&&is(rhs,"string")&&lhs.lastIndexOf(rhs)===lhs.length-rhs.length}],"^=":[5,function(lhs,rhs){return is(lhs,"string")&&is(rhs,"string")&&lhs.indexOf(rhs)===0}],"*=":[5,function(lhs,rhs){return is(lhs,"string")&&is(rhs,"string")&&lhs.indexOf(rhs)!==-1}],">":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&lhs>rhs}],"<":[5,function(lhs,rhs){return is(lhs,"number")&&is(rhs,"number")&&lhs<rhs}],"=":[3,function(lhs,rhs){return lhs===rhs}],"!=":[3,function(lhs,rhs){return lhs!==rhs}],"&&":[2,function(lhs,rhs){return lhs&&rhs}],"||":[1,function(lhs,rhs){return lhs||rhs}]};function exprLex(str,off){var v,m=exprPat.exec(str.substr(off));if(m){off+=m[0].length;v=m[1]||m[2]||m[3]||m[5]||m[6];if(m[1]||m[2]||m[3])return[off,0,jsonParse(v)];else if(m[4])return[off,0,undefined];return[off,v]}}function exprParse2(str,off){if(!off)off=0;var l=exprLex(str,off),lhs;if(l&&l[1]==="("){lhs=exprParse2(str,l[0]);var p=exprLex(str,lhs[0]);if(!p||p[1]!==")")te("epex",str);off=p[0];lhs=["(",lhs[1]]}else if(!l||l[1]&&l[1]!="x"){te("ee",str+" - "+(l[1]&&l[1]))}else{lhs=l[1]==="x"?undefined:l[2];off=l[0]}var op=exprLex(str,off);if(!op||op[1]==")")return[off,lhs];else if(op[1]=="x"||!op[1]){te("bop",str+" - "+(op[1]&&op[1]))}var rhs=exprParse2(str,op[0]);off=rhs[0];rhs=rhs[1];var v;if(typeof rhs!=="object"||rhs[0]==="("||operators[op[1]][0]<operators[rhs[1]][0]){v=[lhs,op[1],rhs]}else{v=rhs;while(typeof rhs[0]==="object"&&rhs[0][0]!="("&&operators[op[1]][0]>=operators[rhs[0][1]][0]){rhs=rhs[0]}rhs[0]=[lhs,op[1],rhs[0]]}return[off,v]}function exprParse(str,off){function deparen(v){if(typeof v!=="object"||v===null)return v;else if(v[0]==="(")return deparen(v[1]);else return[deparen(v[0]),v[1],deparen(v[2])]}var e=exprParse2(str,off?off:0);return[e[0],deparen(e[1])]}function exprEval(expr,x){if(expr===undefined)return x;else if(expr===null||typeof expr!=="object"){return expr}var lhs=exprEval(expr[0],x),rhs=exprEval(expr[2],x);return operators[expr[1]][1](lhs,rhs)}function parse(str,off,nested,hints){if(!nested)hints={};var a=[],am,readParen;if(!off)off=0;while(true){var s=parse_selector(str,off,hints);a.push(s[1]);s=lex(str,off=s[0]);if(s&&s[1]===" ")s=lex(str,off=s[0]);if(!s)break;if(s[1]===">"||s[1]==="~"){if(s[1]==="~")hints.usesSiblingOp=true;a.push(s[1]);off=s[0]}else if(s[1]===","){if(am===undefined)am=[",",a];else am.push(a);a=[];off=s[0]}else if(s[1]===")"){if(!nested)te("ucp",s[1]);readParen=1;off=s[0];break}}if(nested&&!readParen)te("mcp",str);if(am)am.push(a);var rv;if(!nested&&hints.usesSiblingOp){rv=normalize(am?am:a);
}else{rv=am?am:a}return[off,rv]}function normalizeOne(sel){var sels=[],s;for(var i=0;i<sel.length;i++){if(sel[i]==="~"){if(i<2||sel[i-2]!=">"){s=sel.slice(0,i-1);s=s.concat([{has:[[{pc:":root"},">",sel[i-1]]]},">"]);s=s.concat(sel.slice(i+1));sels.push(s)}if(i>1){var at=sel[i-2]===">"?i-3:i-2;s=sel.slice(0,at);var z={};for(var k in sel[at])if(sel[at].hasOwnProperty(k))z[k]=sel[at][k];if(!z.has)z.has=[];z.has.push([{pc:":root"},">",sel[i-1]]);s=s.concat(z,">",sel.slice(i+1));sels.push(s)}break}}if(i==sel.length)return sel;return sels.length>1?[","].concat(sels):sels[0]}function normalize(sels){if(sels[0]===","){var r=[","];for(var i=i;i<sels.length;i++){var s=normalizeOne(s[i]);r=r.concat(s[0]===","?s.slice(1):s)}return r}else{return normalizeOne(sels)}}function parse_selector(str,off,hints){var soff=off;var s={};var l=lex(str,off);if(l&&l[1]===" "){soff=off=l[0];l=lex(str,off)}if(l&&l[1]===toks.typ){s.type=l[2];l=lex(str,off=l[0])}else if(l&&l[1]==="*"){l=lex(str,off=l[0])}while(true){if(l===undefined){break}else if(l[1]===toks.ide){if(s.id)te("nmi",l[1]);s.id=l[2]}else if(l[1]===toks.psc){if(s.pc||s.pf)te("mpc",l[1]);if(l[2]===":first-child"){s.pf=":nth-child";s.a=0;s.b=1}else if(l[2]===":last-child"){s.pf=":nth-last-child";s.a=0;s.b=1}else{s.pc=l[2]}}else if(l[1]===toks.psf){if(l[2]===":val"||l[2]===":contains"){s.expr=[undefined,l[2]===":val"?"=":"*=",undefined];l=lex(str,off=l[0]);if(l&&l[1]===" ")l=lex(str,off=l[0]);if(!l||l[1]!=="(")te("pex",str);l=lex(str,off=l[0]);if(l&&l[1]===" ")l=lex(str,off=l[0]);if(!l||l[1]!==toks.str)te("sex",str);s.expr[2]=l[2];l=lex(str,off=l[0]);if(l&&l[1]===" ")l=lex(str,off=l[0]);if(!l||l[1]!==")")te("epex",str)}else if(l[2]===":has"){l=lex(str,off=l[0]);if(l&&l[1]===" ")l=lex(str,off=l[0]);if(!l||l[1]!=="(")te("pex",str);var h=parse(str,l[0],true);l[0]=h[0];if(!s.has)s.has=[];s.has.push(h[1])}else if(l[2]===":expr"){if(s.expr)te("mexp",str);var e=exprParse(str,l[0]);l[0]=e[0];s.expr=e[1]}else{if(s.pc||s.pf)te("mpc",str);s.pf=l[2];var m=nthPat.exec(str.substr(l[0]));if(!m)te("mepf",str);if(m[5]){s.a=2;s.b=m[5]==="odd"?1:0}else if(m[6]){s.a=0;s.b=parseInt(m[6],10)}else{s.a=parseInt((m[1]?m[1]:"+")+(m[2]?m[2]:"1"),10);s.b=m[3]?parseInt(m[3]+m[4],10):0}l[0]+=m[0].length}}else{break}l=lex(str,off=l[0])}if(soff===off)te("se",str);return[off,s]}function isArray(o){return Array.isArray?Array.isArray(o):toString.call(o)==="[object Array]"}function mytypeof(o){if(o===null)return"null";var to=typeof o;if(to==="object"&&isArray(o))to="array";return to}function mn(node,sel,id,num,tot){var sels=[];var cs=sel[0]===">"?sel[1]:sel[0];var m=true,mod;if(cs.type)m=m&&cs.type===mytypeof(node);if(cs.id)m=m&&cs.id===id;if(m&&cs.pf){if(cs.pf===":nth-last-child")num=tot-num;else num++;if(cs.a===0){m=cs.b===num}else{mod=(num-cs.b)%cs.a;m=!mod&&num*cs.a+cs.b>=0}}if(m&&cs.has){var bail=function(){throw 42};for(var i=0;i<cs.has.length;i++){try{forEach(cs.has[i],node,bail)}catch(e){if(e===42)continue}m=false;break}}if(m&&cs.expr){m=exprEval(cs.expr,node)}if(sel[0]!==">"&&sel[0].pc!==":root")sels.push(sel);if(m){if(sel[0]===">"){if(sel.length>2){m=false;sels.push(sel.slice(2))}}else if(sel.length>1){m=false;sels.push(sel.slice(1))}}return[m,sels]}function forEach(sel,obj,fun,id,num,tot){var a=sel[0]===","?sel.slice(1):[sel],a0=[],call=false,i=0,j=0,k,x;for(i=0;i<a.length;i++){x=mn(obj,a[i],id,num,tot);if(x[0]){call=true}for(j=0;j<x[1].length;j++){a0.push(x[1][j])}}if(a0.length&&typeof obj==="object"){if(a0.length>=1){a0.unshift(",")}if(isArray(obj)){for(i=0;i<obj.length;i++){forEach(a0,obj[i],fun,undefined,i,obj.length)}}else{for(k in obj){if(obj.hasOwnProperty(k)){forEach(a0,obj[k],fun,k)}}}}if(call&&fun){fun(obj)}}function match(sel,obj){var a=[];forEach(sel,obj,function(x){a.push(x)});return a}function compile(sel){return{sel:parse(sel)[1],match:function(obj){return match(this.sel,obj)},forEach:function(obj,fun){return forEach(this.sel,obj,fun)}}}exports._lex=lex;exports._parse=parse;exports.match=function(sel,obj){return compile(sel).match(obj)};exports.forEach=function(sel,obj,fun){return compile(sel).forEach(obj,fun)};exports.compile=compile})(typeof exports==="undefined"?window.JSONSelect={}:exports);(function(J,r,f){function s(a,b,d){a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent("on"+b,d)}function A(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);a.shiftKey||(b=b.toLowerCase());return b}return h[a.which]?h[a.which]:B[a.which]?B[a.which]:String.fromCharCode(a.which).toLowerCase()}function t(a){a=a||{};var b=!1,d;for(d in n)a[d]?b=!0:n[d]=0;b||(u=!1)}function C(a,b,d,c,e,v){var g,k,f=[],h=d.type;if(!l[a])return[];"keyup"==h&&w(a)&&(b=[a]);for(g=0;g<l[a].length;++g)if(k=l[a][g],!(!c&&k.seq&&n[k.seq]!=k.level||h!=k.action||("keypress"!=h||d.metaKey||d.ctrlKey)&&b.sort().join(",")!==k.modifiers.sort().join(","))){var m=c&&k.seq==c&&k.level==v;(!c&&k.combo==e||m)&&l[a].splice(g,1);f.push(k)}return f}function K(a){var b=[];a.shiftKey&&b.push("shift");a.altKey&&b.push("alt");a.ctrlKey&&b.push("ctrl");a.metaKey&&b.push("meta");return b}function x(a,b,d,c){m.stopCallback(b,b.target||b.srcElement,d,c)||!1!==a(b,d)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function y(a){"number"!==typeof a.which&&(a.which=a.keyCode);var b=A(a);b&&("keyup"==a.type&&z===b?z=!1:m.handleKey(b,K(a),a))}function w(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function L(a,b,d,c){function e(b){return function(){u=b;++n[a];clearTimeout(D);D=setTimeout(t,1e3)}}function v(b){x(d,b,a);"keyup"!==c&&(z=A(b));setTimeout(t,10)}for(var g=n[a]=0;g<b.length;++g){var f=g+1===b.length?v:e(c||E(b[g+1]).action);F(b[g],f,c,a,g)}}function E(a,b){var d,c,e,f=[];d="+"===a?["+"]:a.split("+");for(e=0;e<d.length;++e)c=d[e],G[c]&&(c=G[c]),b&&"keypress"!=b&&H[c]&&(c=H[c],f.push("shift")),w(c)&&f.push(c);d=c;e=b;if(!e){if(!p){p={};for(var g in h)95<g&&112>g||h.hasOwnProperty(g)&&(p[h[g]]=g)}e=p[d]?"keydown":"keypress"}"keypress"==e&&f.length&&(e="keydown");return{key:c,modifiers:f,action:e}}function F(a,b,d,c,e){q[a+":"+d]=b;a=a.replace(/\s+/g," ");var f=a.split(" ");1<f.length?L(a,f,b,d):(d=E(a,d),l[d.key]=l[d.key]||[],C(d.key,d.modifiers,{type:d.action},c,a,e),l[d.key][c?"unshift":"push"]({callback:b,modifiers:d.modifiers,action:d.action,seq:c,level:e,combo:a}))}var h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},B={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},H={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},G={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},p,l={},q={},n={},D,z=!1,I=!1,u=!1;for(f=1;20>f;++f)h[111+f]="f"+f;for(f=0;9>=f;++f)h[f+96]=f;s(r,"keypress",y);s(r,"keydown",y);s(r,"keyup",y);var m={bind:function(a,b,d){a=a instanceof Array?a:[a];for(var c=0;c<a.length;++c)F(a[c],b,d);return this},unbind:function(a,b){return m.bind(a,function(){},b)},trigger:function(a,b){if(q[a+":"+b])q[a+":"+b]({},a);return this},reset:function(){l={};q={};return this},stopCallback:function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},handleKey:function(a,b,d){var c=C(a,b,d),e;b={};var f=0,g=!1;for(e=0;e<c.length;++e)c[e].seq&&(f=Math.max(f,c[e].level));for(e=0;e<c.length;++e)c[e].seq?c[e].level==f&&(g=!0,b[c[e].seq]=1,x(c[e].callback,d,c[e].combo,c[e].seq)):g||x(c[e].callback,d,c[e].combo);c="keypress"==d.type&&I;d.type!=u||w(a)||c||t(b);I=g&&"keydown"==d.type}};J.Mousetrap=m;"function"===typeof define&&define.amd&&define(m)})(window,document);Ember.Application.initializer({name:"MixinFactory",after:"MixinsRegistry",initialize:function(container,application){var mixinsRegistry=container.lookupFactory("registry:mixins");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;function Mixin(name,mixindict){console.tags.add("factory");console.group("mixin factory call",arguments);var mixinName=name.camelize().capitalize()+"Mixin";var mixin=Ember.Mixin.create(mixindict);var registryEntry=Ember.Object.create({name:name,EmberClass:mixin});mixinsRegistry.all.push(registryEntry);console.groupEnd();console.tags.remove("factory");return mixin}application.register("factory:mixin",Mixin)}});Ember.Application.initializer({name:"WidgetFactory",after:["WidgetController","WidgetsRegistry","SchemasRegistry","WidgetSerializer","ApplicationSerializer","EmbeddedRecordSerializerMixin","NotificationUtils","DataUtils"],initialize:function(container,application){var WidgetController=container.lookupFactory("controller:widget");var WidgetsRegistry=container.lookupFactory("registry:widgets");var schemasregistry=container.lookupFactory("registry:schemas");var WidgetSerializer=container.lookupFactory("serializer:widget");var ApplicationSerializer=container.lookupFactory("serializer:application");var EmbeddedRecordSerializerMixin=container.lookupFactory("mixin:embedded-record-serializer");var notificationUtils=container.lookupFactory("utility:notification");var dataUtils=container.lookupFactory("utility:data");var get=Ember.get,set=Ember.set,isNone=Ember.isNone,Application=dataUtils.getEmberApplicationSingleton();function Widget(widgetName,classdict,options){console.tags.add("factory");console.group("widget factory call",arguments);var extendArguments=[];if(options===undefined){options={}}if(options.subclass===undefined){options.subclass=WidgetController}if(options.mixins!==undefined){for(var i=0,l=options.mixins.length;i<l;i++){extendArguments.push(options.mixins[i])}}extendArguments.push(classdict);var widgetControllerName=widgetName.dasherize();var widgetSerializerName=widgetName.dasherize();var widgetModel=schemasregistry.getByName(widgetName).EmberModel;var controllerClass=options.subclass.extend.apply(options.subclass,extendArguments);if(isNone(widgetModel)){notificationUtils.error("No model found for the widget "+widgetName+". There might be no schema concerning this widget on the database")}else{console.log("extendArguments",extendArguments);console.log("subclass",options.subclass);loader.register("controller:"+widgetControllerName,controllerClass);var serializer=ApplicationSerializer.extend(EmbeddedRecordSerializerMixin,{});loader.register("serializer:"+widgetSerializerName,WidgetSerializer.extend());console.log("widget",widgetName.camelize().capitalize(),widgetModel);var capitalizedWidgetName=widgetName.camelize().capitalize();var metadataDict=widgetModel.proto().metadata;console.log("metadataDict",widgetName,metadataDict);var registryEntry=Ember.Object.create({name:widgetName,EmberClass:controllerClass});if(!isNone(metadataDict)){if(metadataDict.icon){registryEntry.set("icon",metadataDict.icon)}if(metadataDict.classes){var classes=metadataDict.classes;for(var j=0,lj=classes.length;j<lj;j++){var currentClass=classes[j];if(!Ember.isArray(get(WidgetsRegistry.byClass,currentClass))){set(WidgetsRegistry.byClass,currentClass,Ember.A())}get(WidgetsRegistry.byClass,currentClass).push(registryEntry)}}}WidgetsRegistry.all.push(registryEntry)}console.groupEnd();console.tags.remove("factory");return controllerClass}application.register("factory:widget",Widget)}});Ember.Application.initializer({name:"FormsRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var registry=Abstractclassregistry.create({name:"forms",formwrapper:undefined,tableColumns:[{title:"name",name:"name"}]});application.register("registry:forms",registry)}});Ember.Application.initializer({name:"InflectionsRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var inflexions=[["nagios","nagios"],["tcp2canopsis","tcp2canopsis"],["curve","curves"],["serie","serie"],["enabledmodules","enabledmodules"],["calendardata","calendardata"]];var registry=Abstractclassregistry.create({name:"inflections",all:[],byClass:{},tableColumns:[{title:"name",name:"name"},{title:"Singular",name:"singular"},{title:"Plural",name:"plural"}],loadInflections:function(){for(var i=0,l=inflexions.length;i<l;i++){registry.all.pushObject({name:inflexions[i][0]+" -> "+inflexions[i][1],singular:inflexions[i][0],plural:inflexions[i][1]});Ember.Inflector.inflector.irregular(inflexions[i][0],inflexions[i][1])}}});application.register("registry:inflections",registry)}});Ember.Application.initializer({name:"MixinsRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var registry=Abstractclassregistry.create({name:"mixins",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});application.register("registry:mixins",registry)}});Ember.Application.initializer({name:"PromisesRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var get=Ember.get,set=Ember.set;var registry=Abstractclassregistry.create({name:"promises",all:[],pending:Ember.A(),errors:Ember.A(),pendingCount:0,errorsCount:0,byClass:{},handlePromise:function(promise){var me=this;Ember.run.schedule("sync",this,function(){me.all.pushObject(promise);me.pending.pushObject(promise);set(me,"pendingCount",me.pendingCount+1)})},promiseSuccess:function(promise){console.info("promise success",promise)},promiseFail:function(promise){if(promise._detail!==undefined&&promise._detail.status===200){console.warn("promise failed with error code 200, assuming it's a success");this.promiseSuccess(promise)}else{console.error("promise failed",promise,(new Error).stack);var me=this;Ember.run.schedule("sync",this,function(){console.error("promise failed",promise);get(me,"errors").pushObject(promise);set(me,"errorsCount",me.errorsCount+1)})}},promiseFinally:function(promise){var me=this;Ember.run.schedule("sync",this,function(){console.log("finally");get(me,"pending").removeObject(promise);set(me,"pendingCount",me.pendingCount-1)})}});application.register("registry:promises",registry)}});Ember.Application.initializer({name:"SchemasRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var registry=Abstractclassregistry.create({name:"schemas",all:{},add:function(item,name){this.all[name]=item},getByName:function(name){return this.all[name]},tableColumns:[{title:"icon",name:"icon"},{title:"name",name:"name"}]});application.register("registry:schemas",registry)}});Ember.Application.initializer({name:"WidgetsRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var registry=Abstractclassregistry.create({name:"widgets",all:[],byClass:{},tableColumns:[{title:"icon",name:"icon"},{title:"name",name:"name"}]});application.register("registry:widgets",registry)}});Ember.Application.initializer({name:"ActionsRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var registry=Abstractclassregistry.create({name:"actions",all:[{name:"gotoEventView",actionData:["showView","view.event"]},{name:"toggleEditMode",actionData:["toggleEditMode"]},{name:"promptReloadApplication",actionData:["promptReloadApplication"]},{name:"showUserProfile",actionData:["showUserProfile"]},{name:"editConfig",actionData:["editConfig"]},{name:"addNewView",actionData:["addNewView"]},{name:"logout",actionData:["logout"]},{name:"refresh",actionData:["refresh"]},{name:"toggleFullscreen",actionData:["toggleFullscreen"]},{name:"toggleDevTools",actionData:["toggleDevTools"]}],byClass:{},tableColumns:[{title:"name",name:"name"}]});application.register("registry:actions",registry)}});Ember.Application.initializer({name:"IndexesRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var registry=Abstractclassregistry.create({name:"indexes"});registry.add(Ember.Object.create({name:"event",tree:{component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource","final":true}}},connector:{_metas:{name:"connector"},component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource","final":true}}}}}}));registry.add(Ember.Object.create({name:"crecord",tree:{crecord_type:{_metas:{name:"Crecord type"},crecord_name:{_metas:{name:"Crecord name","final":true}}}}}));application.register("registry:indexes",registry)}});Ember.Application.initializer({name:"MocksRegistry",after:["AbstractClassRegistry","FormsUtils"],initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var formsUtils=container.lookupFactory("utility:forms");var set=Ember.set;var MocksRegistryClass=Ember.Object.extend({init:function(){this._super();this.feedMocks()},feedMocks:function(){var mocks=localStorage.getItem("files_mocks");var mocksArray=Ember.A();try{mocks=JSON.parse(mocks);if(!!mocks){for(var key in mocks){mocks[key].modulePath=key;mocksArray.push(mocks[key])}}}catch(e){console.error("Impossible to parse mocks JSON.")}set(this,"mocks",mocksArray)},editMock:function(mock){var mocksManager=this;var recordWizard=formsUtils.showNew("modelform",mock,{title:__("Edit mock")+" "+mock.modulePath,inspectedItemType:"requirejsmock"});recordWizard.submit.then(function(form){var mocks=localStorage.getItem("files_mocks");try{mocks=JSON.parse(mocks);var mockModulePath=mock.modulePath;delete mock.modulePath;mock.module=mock.module;mocks[mockModulePath]=mock;localStorage.setItem("files_mocks",JSON.stringify(mocks))}catch(e){console.error("Impossible to parse mocks JSON.")}mocksManager.feedMocks()})},addMock:function(){var mocksManager=this;var mock={modulePath:"",module:"",requirements:[]};var recordWizard=formsUtils.showNew("modelform",mock,{title:__("Add mock"),inspectedItemType:"requirejsmock"});recordWizard.submit.then(function(form){var mocks=localStorage.getItem("files_mocks");try{mocks=JSON.parse(mocks);var mockModulePath=mock.modulePath;delete mock.modulePath;mock.module=mock.module;mocks[mockModulePath]=mock;localStorage.setItem("files_mocks",JSON.stringify(mocks))}catch(e){console.error("Impossible to parse mocks JSON.")}mocksManager.feedMocks()})},deleteMock:function(modulePath){var mocks=localStorage.getItem("files_mocks");try{mocks=JSON.parse(mocks);delete mocks[modulePath];localStorage.setItem("files_mocks",JSON.stringify(mocks))}catch(e){console.error("Impossible to parse mocks JSON.")}this.feedMocks()}});var registry=MocksRegistryClass.create();application.register("registry:mocks",registry)}});Ember.Application.initializer({name:"SearchmethodsRegistry",after:"AbstractClassRegistry",initialize:function(container,application){var Abstractclassregistry=container.lookupFactory("registry:abstractclass");var searchMethods=[{name:"simple",filter:function(array,options){var propertyToCheck=options.propertyToCheck;var searchCriterion=options.searchCriterion;var res=array.filter(function(loopItem,index,enumerable){void index;void enumerable;var doesItStartsWithSearchFilter=loopItem.name.slice(0,searchCriterion.length)==searchCriterion;return doesItStartsWithSearchFilter});console.log("##",res);return res}}];var registry=Abstractclassregistry.create({name:"searchMethods",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});for(var i=0,l=searchMethods.length;i<l;i++){registry.all.pushObject(searchMethods[i])}application.register("registry:searchmethods",registry)}});Ember.Application.initializer({name:"UtilityClass",initialize:function(container,application){var set=Ember.set,get=Ember.get;var Utility=Ember.Object.extend({init:function(){this._super();console.log("Registering utility object "+get(this,"name"))}});application.register("class:utility",Utility)}});Ember.Application.initializer({name:"ActionsUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var actionsDefaultTarget;var actionsUtils=Utility.create({name:"actions",setDefaultTarget:function(target){actionsDefaultTarget=target},doAction:function(actionName,actionParam){console.info("doAction",actionsDefaultTarget,actionName,actionParam);Ember.assert("The actionsDefaultTarget variable is none",!Ember.isNone(actionsDefaultTarget));actionsDefaultTarget.send.apply(actionsDefaultTarget,[actionName,actionParam])}});application.register("utility:actions",actionsUtils)}});Ember.Application.initializer({name:"DataUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var _loggedUserController,_applicationSingleton;var dataUtils=Utility.create({name:"data",getLoggedUserController:function(){return _loggedUserController},setLoggedUserController:function(loggedUserController){_loggedUserController=loggedUserController},getEmberApplicationSingleton:function(){return _applicationSingleton},setEmberApplicationSingleton:function(applicationInstance){_applicationSingleton=applicationInstance},getStore:function(){console.warn("this should not be used as there is not only one store in Canopsis. This might lead to unexpected behaviour");return this.getEmberApplicationSingleton().__container__.lookup("store:main")},addRecordToRelationship:function(record,parentElement,relationshipKey,cardinality){console.log("addRecordToRelationship",arguments);if(cardinality==="hasMany"){console.log("addRecordToRelationship hasMany",relationshipKey,arguments,parentElement);parentElement.get(relationshipKey).pushObject(record)}else if(cardinality==="belongsTo"){console.log("addRecordToRelationship belongsTo",relationshipKey,arguments,parentElement);parentElement.set(relationshipKey,record)}}});application.register("utility:data",dataUtils);window.dataUtils=dataUtils}});Ember.Application.initializer({name:"DatesUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var __=Ember.String.loc,isNone=Ember.isNone;var dates=Utility.create({name:"dates",getNow:function(){return parseInt((new Date).getTime()/1e3)},getStringNow:function(format,shortDate){return dates.timestamp2String(dates.getNow(),format,shortDate)},durationFromNow:function(timestamp){var delta=dates.getNow()-timestamp;return dates.second2Duration(delta)},second2Duration:function(totalSec){var days=parseInt(totalSec/(3600*24));var hours=parseInt(totalSec/3600)%24;var minutes=parseInt(totalSec/60)%60;var seconds=parseInt(totalSec%60);var displayHours="";if(hours){displayHours=(hours<10?"0"+hours:hours)+"h "}var displayMinutes="";if(minutes){displayMinutes=(minutes<10?"0"+minutes:minutes)+"m "}var result=displayHours+displayMinutes+(seconds<10?"0"+seconds:seconds)+"s";if(!isNaN(days)&&days!==0){result=days+"d "+result}return result},timestamp2String:function(value,format,shortDate){function addZero(i){return i<10?"0"+i:i.toString()}var a=new Date(value*1e3);var months=[__("January"),__("February"),__("March"),__("April"),__("May"),__("June"),__("July"),__("August"),__("September"),__("October"),__("November"),__("December")];if(shortDate===true){months=[__("Jan"),__("Feb"),__("Mar"),__("Apr"),__("May"),__("June"),__("July"),__("Aug"),__("Sep"),__("Oct"),__("Nov"),__("Dec")]}var year=a.getFullYear();var month=months[a.getMonth()];var date=addZero(a.getDate());var hour=addZero(a.getHours());var min=addZero(a.getMinutes());var sec=addZero(a.getSeconds());var time="";switch(format){case"f":time=[date,month,year].join(" ")+" "+[hour,min,sec].join(":");break;case"r":time=[date,addZero(a.getMonth()),year].join("/")+" <br>"+[hour,min,sec].join(":");break;case"timeOnly":time=[hour,min,sec].join(":");break;default:time=[date,month,year].join(" ")+" "+[hour,min,sec].join(":");break}return time},locale:"fr",months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Monday","Thuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],setLang:function(lang){dates.locale=lang;if(lang==="fr"){dates.month=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Octobre","Novembre","Décembre"];dates.days=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"]}},startOfTheDay:function(aTimestamp){if(isNone(aTimestamp)){aTimestamp=dates.getNow();console.log("got date from now as no param given",aTimestamp)}aTimestamp*=1e3;var startDateOfTheDay=new Date(aTimestamp);startDateOfTheDay.setHours(0,0,0,0);return parseInt(startDateOfTheDay.getTime()/1e3)},isToday:function(timestamp){var startOfTheDay=dates.startOfTheDay(timestamp);return dates.getNow()<startOfTheDay+3600*24},dateFormat:"YYYY/MM/DD",diffDate:function(d1,d2,u){div=1;switch(u){case"s":div=1e3;break;case"m":div=1e3*60;break;case"h":div=1e3*60*60;break;case"d":div=1e3*60*60*24;break;default:break}var Diff=d2-d1;return Math.ceil(Diff/div)}});application.register("utility:dates",dates)}});Ember.Application.initializer({name:"DebugUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var set=Ember.set;var debugUtils=Utility.create({name:"debug",inspectObject:function(object){window.$E=object;set(this,"inspectedObject",object);console.info("--- inspect object :",this.inspectedObject)},getViewFromJqueryElement:function($el,className){if(className){return Ember.View.views[$el.closest(".ember-view ."+className).attr("id")]}else{return Ember.View.views[$el.closest(".ember-view").attr("id")]}}});application.register("utility:debug",debugUtils)}});Ember.Application.initializer({name:"DragUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var __=Ember.String.loc,isNone=Ember.isNone;var drag=Utility.create({name:"drag",setDraggable:function(handle,dragElement){handle.on("mousedown",function(){console.log("mousedown",$(this));dragElement.addClass("draggable").parents().on("mousemove",function(e){$(".draggable").offset({top:e.pageY-50,left:e.pageX-$(".draggable").outerWidth()/2}).on("mouseup",function(){dragElement.removeClass("draggable")})})})}});application.register("utility:drag",drag)}});Ember.Application.initializer({name:"EventUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var get=Ember.get,set=Ember.set,__=Ember.String.loc,isNone=Ember.isNone;var eventUtil=Utility.create({name:"event",getFields:function(){return["connector","connector_name","component","resource","perimeter","domain","state","status","timestamp","output"]}});application.register("utility:event",eventUtil)}});Ember.Application.initializer({name:"FormsUtils",after:["UtilityClass","RoutesUtils","DataUtils","FormsRegistry"],initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var routesUtils=container.lookupFactory("utility:routes");var dataUtils=container.lookupFactory("utility:data");var formsregistry=container.lookupFactory("registry:forms");var get=Ember.get,set=Ember.set,__=Ember.String.loc;var formUtils=Utility.create({name:"forms",instantiateForm:function(formName,formContext,options){void formContext;if(this.formController){this.formController.destroy()}console.log("try to instantiate form",formName,options.formParent);var classDict=options;options.formName=formName;classDict.target=routesUtils.getCurrentRouteController();classDict.container=dataUtils.getEmberApplicationSingleton().__container__;var formClass=dataUtils.getEmberApplicationSingleton().__container__.lookupFactory("form:"+formName.dasherize().substring(0,formName.length-4));if(formClass===undefined){console.error("the form",formName,"was not found");debugger}var formController=formClass.create(classDict);formController.refreshPartialsList();this.formController=formController;return formController},showInstance:function(formInstance){formInstance.empty_validationFields();set(formsregistry.formwrapper,"form.validateOnInsert",false);set(formsregistry.formwrapper,"form",formInstance);set(formsregistry.formwrapper,"formName",formInstance.formName)},showNew:function(formName,formContext,options){if(options===undefined){options={}}if(Ember.isNone(formContext)||Ember.isNone(get(formContext,"crecord_type"))){console.warn("There is no crecord_type in the given record. Form may not display properly.")}console.log("Form generation",formName);var formController=this.instantiateForm(formName,formContext,options);console.log("formController",formController);routesUtils.getCurrentRouteController().send("showEditFormWithController",formController,formContext,options);return formController},editRecord:function(record){var widgetWizard=this.showNew("modelform",record);console.log("widgetWizard",widgetWizard);widgetWizard.submit.then(function(){console.log("record saved");record.save();widgetWizard.trigger("hidePopup");widgetWizard.destroy()});return widgetWizard},editSchemaRecord:function(schemaName,container){var forms=this;var dataStore=DS.Store.create({container:container});dataStore.findQuery(schemaName,{}).then(function(queryResults){console.log("queryResults",queryResults);var record=get(queryResults,"content")[0];var errorMessage=[schemaName," ",__("information not registered in database.")," ",__("Please contact your administrator.")].join("");if(record){forms.editRecord(record)}else{forms.error(errorMessage)}})},addRecord:function(record_type){routesUtils.getCurrentRouteController().send("show_add_crecord_form",record_type)}});application.register("utility:forms",formUtils)}});Ember.Application.initializer({name:"HashUtils",after:["UtilityClass"],initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var hash=Utility.create({generate_GUID:function(){var s4=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};var token=s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4();return token},generateId:function(prefix){var token=hash.generate_GUID();if(!Ember.isNone(prefix)){token=prefix+"_"+token}return token},md5:function(data){var md5=new window.Hashes.MD5;return md5.hex(data)},sha1:function(data){var sha1=new window.Hashes.SHA1;return sha1.hex(data)}});application.register("utility:hash",hash)}});Ember.Application.initializer({name:"IndexesUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var indexes=Utility.create({name:"indexes",cache:{},load:function(collection){$.ajax({url:"/rest/indexes/"+collection,success:function(data){indexes.cache[collection]=data.indexes},async:false});return this.cache[collection]},parse:function(indexes){},get:function(collection){console.log(this);if(Ember.isNone(this.cache[collection])){this.load(collection)}return this.cache[collection]},getAsList:function(collection){var indexes=this.get(collection);indexesList=[];for(var key in indexes){indexesList.push(indexes[key].key)}return indexesList},getIndexWithField:function(collection,fields){var indexes=this.getAsList(collection);var indexSelection=[];for(var x=0,l=indexes.length;x<l;x++){console.log("searching "+indexes[x][0][0]+" in",fields);if($.inArray(indexes[x][0][0],fields)!==-1){indexSelection.push(indexes[x])}}return indexSelection}});application.register("utility:indexes",indexes)}});Ember.Application.initializer({name:"ModelsolveUtils",after:"UtilityClass",
initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var modelsolve=Utility.create({name:"modelsolve",gen_resolve:function(callback){return function(data){for(var i=0;i<data.data.length;i++){}if(data.success===false&&data.data.msg){console.error("Server Error",data.data.msg,data.data.type);console.error(data.data.traceback)}Ember.run(null,callback,data)}},gen_reject:function(callback){return function(xhr){xhr.then=null;Ember.run(null,callback,xhr)}}});application.register("utility:modelsolve",modelsolve)}});Ember.Application.initializer({name:"NotificationUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");targetcontroller={temp_buffer:[],createNotification:function(notificationType,notificationMessage){this.temp_buffer.push({notificationType:notificationType,notificationMessage:notificationMessage})}};var notification=Utility.create({name:"notification",setController:function(controller){},info:function(message){},warning:function(message){},error:function(message){},help:function(){console.log("usage is: utils.notification.notificate('info'|'warning'|'error', 'my message');")}});application.register("utility:notification",notification)}});Ember.Application.initializer({name:"RoutesUtils",after:["UtilityClass","DataUtils"],initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var dataUtils=container.lookupFactory("utility:data");var routesUtils=Utility.create({name:"routes",getCurrentRouteController:function(){var currentHandlers=dataUtils.getEmberApplicationSingleton().__container__.lookup("router:main").router.currentHandlerInfos;var currentRouteController=currentHandlers[currentHandlers.length-1].handler.controller;console.log("currentHandlers",currentHandlers);console.log("currentRouteController",currentRouteController);return currentRouteController},getCurrentViewId:function(){return dataUtils.getEmberApplicationSingleton().__container__.lookup("router:main").router.currentHandlerInfos[1].params.userview_id}});application.register("utility:routes",routesUtils)}});Ember.Application.initializer({name:"SlugUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var slugify=Utility.create({name:"slug",slug:function(value){var rExps=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}];for(var i=0,l=rExps.length;i<l;i++){value=value.replace(rExps[i].re,rExps[i].ch)}value=value.toLowerCase();value=value.replace(/\s+/g,"-");value=value.replace(/[^a-z0-9-]/g,"");value=value.replace(/\-{2,}/g,"-");return value}});application.register("utility:slug",slugify)}});Ember.Application.initializer({name:"ValuesUtils",after:["UtilityClass","DatesUtils"],initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var dateUtils=container.lookupFactory("utility:dates");var units=[" "," k"," M"," G"," T"];var values=Utility.create({name:"values",humanize:function(x,unit){if(unit.toLowerCase()==="s"){return dateUtils.second2Duration(x)}var step=1e3;var negative=x<0;if(negative){x=-x}if(unit==="o"||unit==="o/s"){step=1024}var nstep=0;var cur=parseInt(x/step);while(cur>0){x=cur;cur=parseInt(x/step);nstep++}if(negative){return"-"+x+units[nstep]+unit}else{return x+units[nstep]+unit}},castValue:function(value,type){type=type.toLowerCase();var types=["string","boolean","number","array"];if(types.indexOf(type)===-1){console.warn("type",type,"not recognized. Expected one of",types.join(","));return value}if(type==="string"){return value+""}if(type==="number"){try{value=parseFloat(value)}catch(err){console.warn("unable to case to number value",value)}if(isNaN(value)){return 0}return value}if(type==="boolean"){try{if(value==="true"){return true}if(value==="false"){return false}value=!!value}catch(err){console.warn("unable to case to boolean value",value)}return value}if(type==="array"){try{value=value.split(",")}catch(err){console.warn("unable to case to array value",value)}return value}}});application.register("utility:values",values)}});Ember.Application.initializer({name:"WidgetsUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var get=Ember.get;var widgetsUtils=Utility.create({name:"widgetsUtils",getParentViewForWidget:function(widget){var currentItem=widget;while(get(currentItem,"crecord_type")!=="view"){currentItem=get(currentItem,"target")}return currentItem}});application.register("utility:widgets",widgetsUtils)}});Ember.Application.initializer({name:"WidgetSelectorsUtils",after:"UtilityClass",initialize:function(container,application){var Utility=container.lookupFactory("class:utility");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var widgetSelectors=Utility.create({name:"widgetSelector",toTree:function(widget){if(isNone(widget)){console.warn("Widget is undefined in widget selector toTree");return{}}var tree={};console.log("enter tree for widget",widget.get("id"));var widgets=widgetSelectors.directChildren(widget);var sub_tree=[];var len=widgets.length;for(var i=0,l=len;i<l;i++){console.log("iterating over widget ",widgets[i].get("id"));sub_tree.push(widgetSelectors.toTree(widgets[i]))}tree[widget.get("id")]={children:sub_tree,widget:widget};console.log("will return sub tree",tree);return tree},directChildren:function(widget){if(Ember.isNone(widget)){console.warn("Widget is undefined in widget selector direct children");return[]}console.log("in direct children");var widgets=get(widget,"items.content");var result=[];if(!Ember.isNone(widgets)){var len=widgets.length;for(var i=0;i<len;i++){result.push(get(widgets[i],"widget"))}}return result},children:function(widget){if(Ember.isNone(widget)){console.warn("Widget is undefined in widget selector in children");return[]}var all=[];var widgets=widgetSelectors.directChildren(widget);var len=widgets.length;for(var i=0;i<len;i++){console.log("iterating over widget ",i);var children=widgetSelectors.children(widgets[i]);var len1=children.length;for(var j=0,lj=len1;j<lj;j++){console.log("iterating over sub children",j);all.push(children[j])}all.push(widgets[i])}return all},filter:function(widget,filter){if(Ember.isNone(widget)){console.warn("Widget is undefined in widget selector in filter");return[]}if(Ember.isNone(filter)){console.warn("Filter is undefined in widget selector in filter");return[]}var widgets=[];if(filter.directChilrenOnly){widgets=widgetSelectors.directChildren(widget);console.log("directChilrenOnly",widgets)}else{widgets=widgetSelectors.children(widget);console.log("not directChilrenOnly",widgets)}var selectedKeys={};var selection=[];if(filter.keyEquals){for(var key in filter.keyEquals){console.log("checking if key",key,"is in widget");for(var i=0,l=widgets.length;i<l;i++){if(widgets[i].get(key)===filter.keyEquals[key]){if(Ember.isNone(selectedKeys[get(widgets[i],"id")])){selection.push(widgets[i]);selectedKeys[get(widgets[i],"id")]=true}}}}}return selection}});application.register("utility:widget-selectors",widgetSelectors)}});(function(){delete console.init;if(!isIE){console.group("init");console.tags.add("init")}else{if(window.canopsisConfiguration.DEBUG){var baseconsole=console;console={log:function(){var fileinfo="";try{var arrayargs=[];for(var i=0;i<arguments.length;i++){arrayargs.push(arguments[i])}var args=JSON.stringify(arrayargs);baseconsole.log.apply(baseconsole,[fileinfo,args])}catch(e){Array.prototype.unshift.call(arguments,[" > unable to serialize next message"]);Array.prototype.unshift.call(arguments,fileinfo)}},tags:{add:function(){},remove:function(){}},group:function(){},groupEnd:function(){},warn:function(){},debug:function(){},info:function(){},error:function(){}}}}console.debug=console.log})();Ember.Application.initializer({name:"ConsolemanagerMixin",after:["MixinFactory","FormsUtils","DataUtils"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var formUtils=container.lookupFactory("utility:forms");var dataUtils=container.lookupFactory("utility:data");var get=Ember.get,set=Ember.set,__=Ember.String.loc;var mixin=Mixin("consolemanager",{init:function(){this.partials.statusbar.pushObject("consolemanagerstatusmenu");this._super()},actions:{showConsoleSettings:function(){var jsruntimeconfigrecord=dataUtils.getStore().createRecord("jsruntimeconfiguration",{id:0,selected_tags:window.console.tags._selectedTags,colors:window.console.style._colors});var editForm=formUtils.showNew("modelform",jsruntimeconfigrecord,{title:__("Edit JS runtime configuration"),inspectedItemType:"jsruntimeconfiguration"});console.log("editForm deferred",editForm.submit);editForm.submit.done(function(){console.log("jsruntimeconfigrecord saved",jsruntimeconfigrecord)});editForm.submit.always(function(){console.log("jsruntimeconfigrecord always",jsruntimeconfigrecord);window.console.tags._selectedTags=jsruntimeconfigrecord.get("selected_tags");window.console.style._colors=jsruntimeconfigrecord.get("colors");window.console.settings.save();jsruntimeconfigrecord.unloadRecord()})}},verbosity_mode:function(){return __("custom")}.property()});application.register("mixin:consolemanager",mixin)}});Ember.Application.initializer({name:"CriticitylevelsMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var mixin=Mixin("criticitylevels",{init:function(){var mixinsOptions=get(this,"content.mixins");if(mixinsOptions){var criticitylevelsOptions=get(this,"content.mixins").findBy("name","criticitylevels");this.mixinOptions.criticitylevels=criticitylevelsOptions}this._super();set(this,"warn_value",get(this,"mixinOptions.criticitylevels.warn_value"));set(this,"crit_value",get(this,"mixinOptions.criticitylevels.crit_value"));set(this,"unit_or_percent",get(this,"mixinOptions.criticitylevels.unit_or_percent"));set(this,"standard_color",get(this,"mixinOptions.criticitylevels.standard_color"));set(this,"warn_color",get(this,"mixinOptions.criticitylevels.warn_color"));set(this,"critic_color",get(this,"mixinOptions.criticitylevels.critic_color"));if(isNone(get(this,"background_color"))){set(this,"background_color","#3c8dbc")}if(isNone(get(this,"warn_color"))){set(this,"warn_color","#f39c12")}if(isNone(get(this,"critic_color"))){set(this,"critic_color","#f56954")}}});application.register("mixin:criticitylevels",mixin)}});Ember.Application.initializer({name:"DocumentationMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var mixin=Mixin("Documentation",{init:function(){this.partials.statusbar.pushObject("documentation");this._super()}});application.register("mixin:documentation",mixin)}});Ember.Application.initializer({name:"EmbeddedRecordSerializerMixin",after:["SchemasRegistry","MixinFactory","HashUtils"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var schemasregistry=container.lookupFactory("registry:schemas");var hashUtils=container.lookupFactory("utility:hash");var isNone=Ember.isNone,get=Ember.get;function keyForRelationship(key){key=key.decamelize();return key}var mixin=Mixin("embeddedRecordSerializer",{sideloadItem:function(payload,type,item,parentJSON){try{console.log("sideLoad",type,item.xtype);console.log("payload before sideLoad",payload);if(item.xtype===undefined){console.error("no xtype for widget",type,item,payload);return undefined}if(schemasregistry.getByName(item.xtype).EmberModel===undefined){console.error(payload,"bad xtype for widget :"+item.xtype);return undefined}var sideloadKey=item.xtype.pluralize();var primaryKey=Ember.get(this,"primaryKey");var id=item[primaryKey];var sideloadArr=payload[sideloadKey]||[];console.log("sideloadKey",sideloadKey);if(isNone(id)){console.log("generateId",item.xtype,item.id);id=hashUtils.generateId("item");item[primaryKey]=id}if(isNone(item.meta)){item.meta={}}console.log("filling item",item,"meta with parent",parentJSON.xtype);item.meta.embeddedRecord=true;item.meta.parentId=parentJSON.id;if(!isNone(parentJSON.xtype)){item.meta.parentType=parentJSON.xtype}else if(!isNone(parentJSON.crecord_type)){item.meta.parentType=parentJSON.crecord_type}if(!isNone(sideloadArr.findBy("id",id))){return payload}console.log("pushing item",sideloadArr,"into",sideloadKey);sideloadArr.push(item);payload[sideloadKey]=sideloadArr;return payload}catch(e){console.error(e.message,e.stack)}},extractRelationships:function(payload,recordJSON,primaryType,parentType){console.group("extractRelationships",recordJSON,primaryType);try{console.log("payload before extractRelationships",payload);if(isNone(primaryType.store)){primaryType.store=parentType.store}console.log("primaryType",primaryType,recordJSON.xtype);if(primaryType===schemasregistry.getByName("widget").EmberModel){var concreteWidgetType=schemasregistry.getByName(recordJSON.xtype).EmberModel;primaryType=concreteWidgetType}if(isNone(primaryType.store)){primaryType.store=parentType.store}primaryType.eachRelationship(function(key,relationship){console.log("eachRelationship",key,recordJSON,recordJSON[key]);console.log("relationship",relationship);var related=recordJSON[key],type=relationship.type;console.log("related",related);if(related){if(relationship.kind==="belongsTo"){console.group("belongsTo relationship");console.log("related",related);console.log("relationship",relationship);console.log("recordJSON",recordJSON);console.groupEnd();var sideloadItemResult=this.sideloadItem(payload,type,related,recordJSON);if(!isNone(sideloadItemResult)){recordJSON[key]=related.id;recordJSON[key+"Type"]=related.xtype;this.extractRelationships(payload,related,type,primaryType)}}else if(relationship.kind==="hasMany"){console.group("hasMany relationship");console.log("related",related);console.log("relationship",relationship);console.log("recordJSON",recordJSON);console.groupEnd();related.forEach(function(item,index){console.log("sideLoad items in",recordJSON);var sideloadItemResult=this.sideloadItem(payload,type,item,recordJSON);if(!isNone(sideloadItemResult)){related[index]=item.id;this.extractRelationships(payload,item,type,primaryType)}},this)}}},this);console.groupEnd();return payload}catch(e){console.groupEnd();console.error(e.message,e.stack)}},isRecordEmbedded:function(record){var res;if(!isNone(record._data.meta)&&record._data.meta.embeddedRecord===true){res=true}else{res=false}console.log("isRecordEmbedded",record,res);return res},getTopmostNotEmbeddedRecordFor:function(record,options){void options;console.log("getTopmostNotEmbeddedRecordFor",record,record.data,record._data);var recordCursor=record;while(this.isRecordEmbedded(recordCursor)){var parentType=recordCursor._data.meta.parentType;var parentId=recordCursor._data.meta.parentId;if(parentType==="view"){parentType="userview"}recordCursor=recordCursor.store.getById(parentType,parentId)}return recordCursor},serialize:function(record,options){console.log("serialize",record);var lookForDocumentRoot=true;if(!isNone(options)&&options.lookForDocumentRoot===false){lookForDocumentRoot=false}if(lookForDocumentRoot&&this.isRecordEmbedded(record)){this.getTopmostNotEmbeddedRecordFor(record).save(options);return}var res=this._super(record,options);res["id"]=record.get("id");console.log(" - serialized record",record,res);return res},serializeBelongsTo:function(record,json,relationship){console.log("serializeBelongsTo",arguments);var attr=relationship.key;console.log("serializeBelongsTo",relationship,record);var key=keyForRelationship(attr);console.log("key",key);var content=record.get(key);console.log("content",content);if(!isNone(content)){var serializedSubDocument=content.serialize({lookForDocumentRoot:false});console.log("serializedSubDocument",serializedSubDocument);json[key]=serializedSubDocument}else{console.error("Content is empty",content)}},serializeHasMany:function(record,json,relationship){var attr=relationship.key;console.log("serializeHasMany",relationship,record,json,attr);var key=keyForRelationship(attr);console.log("keyForRelationship",key);var subDocuments=record.get(key).get("content");console.log("subDocuments",subDocuments);json[key]=[];var sublen=subDocuments.length;if(isNone(relationship)||isNone(relationship.type)||isNone(relationship.type.typeKey)){console.error("Error while retrieving typeKey from model is it is none.")}for(var i=0,l=sublen;i<l;i++){if(!isNone(subDocuments[i])){var serializedSubDocument=subDocuments[i].serialize({lookForDocumentRoot:false});serializedSubDocument.xtype=relationship.type.typeKey;json[key].push(serializedSubDocument)}else{console.error("subdocument is none for index",i,subDocuments)}}console.log("serializedSubDocuments",json[key])}});application.register("mixin:embedded-record-serializer",mixin)}});Ember.Application.initializer({name:"HashSerializerMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var mixin=Mixin("hashSerializer",{serializeIntoHash:function(hash,type,record,method,options){void type;console.log("serializeIntoHash",arguments);hash=this.serialize(record,options);if(method==="PUT"){return hash}else if(method==="POST"){return[hash]}}});application.register("mixin:hash-serializer",mixin)}});Ember.Application.initializer({name:"InspectableArrayMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var mixin=Mixin("InspectableArray",{attributesKeys:function(){var attributes=[];var attributesDict=this.get("inspectedDataArray.type.attributes.values");console.log("attributesDict",attributesDict);for(var key in attributesDict){var attr=attributesDict[key];if(attr.options.hiddenInLists===false||attr.options.hiddenInLists===undefined){attributes.pushObject({field:attr.name,type:attr.type,options:attr.options});console.log("pushed attr",{field:attr.name,type:attr.type,options:attr.options})}}return attributes}.property("inspectedProperty","inspectedDataArray"),inspectedDataArray:function(){console.error("This must be defined on the base class")}.property()});application.register("mixin:inspectable-array",mixin)}});Ember.Application.initializer({name:"InspectableItemMixin",after:["MixinFactory","SchemasRegistry","NotificationUtils"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var Schemasregistry=container.lookupFactory("registry:schemas");var notificationUtils=container.lookupFactory("utility:notification");var get=Ember.get,set=Ember.set;var mixin=Mixin("inspectableItem",{attributesKey:"attributes",inspectedDataItem:function(){console.error("This must be defined on the base class. Assuming inspected data is content");return"content"}.property(),inspectedItemType:function(){console.error("This must be defined on the base class. Assuming inspected data is content.xtype");return"content.xtype"}.property(),inspectedItemInstance:function(){console.error("Not mandatory, but attr.value field will not be set");return"content"}.property(),getInspectedItemType:function(){var itemType=get(this,"inspectedItemType");if(itemType==="view"){itemType="userview"}return itemType},insertValueIntoAttribute:function(createdCategory,inspectedDataItem,key,attr,count){var value=!this.isOnCreate?get(inspectedDataItem,key):attr.options["defaultValue"];if(attr.type==="array"){var value_temp=Ember.copy(value,true);value=value_temp}createdCategory.keys[count].value=value;return createdCategory},generateEditorNameForAttribute:function(attr){var editorName;if(attr.options!==undefined&&attr.options.role!==undefined){editorName="editor-"+attr.options.role}else{editorName="editor-"+attr.type}if(Ember.TEMPLATES[editorName]===undefined){editorName="editor-defaultpropertyeditor"}return editorName},generateRoleAttribute:function(attr_role){return{type:"string",model:{options:{role:attr_role}},options:{}}},getAttributes:function(){var itemType=this.getInspectedItemType();var referenceModel=Schemasregistry.getByName(itemType).EmberModel;if(referenceModel===undefined||referenceModel.proto()===undefined){notificationUtils.error("There does not seems to be a registered schema for",itemType.capitalize())}if(referenceModel.proto().categories===undefined){notificationUtils.error("No categories in the schema of"+itemType)}return get(referenceModel,get(this,"attributesKey"))},categorized_attributes:function(){var inspectedDataItem=get(this,"inspectedDataItem");console.log("recompute categorized_attributes",inspectedDataItem);if(inspectedDataItem!==undefined){console.log("inspectedDataItem attributes",this.getAttributes());var itemType=this.getInspectedItemType();var referenceModel=Schemasregistry.getByName(itemType).EmberModel;if(itemType!==undefined){var options=get(this,"options"),filters=[];if(options&&options.filters){filters=options.filters}console.log(" + filters ",filters);var override_labels={};if(options&&options.override_labels){override_labels=options.override_labels}set(this,"categories",[]);var modelAttributes=this.getAttributes();var refModelCategories=referenceModel.proto().categories;for(var i=0,li=refModelCategories.length;refModelCategories&&i<li;i++){var category=refModelCategories[i],createdCategory={title:category.title,keys:[]};for(var j=0,lj=category.keys.length;j<lj;j++){var key=category.keys[j];var attr=modelAttributes.get(key);if(key==="separator"){createdCategory.keys[j]=this.generateRoleAttribute("separator")}else{if(key!==undefined&&attr===undefined){notificationUtils.error("An attribute that does not exists seems to be referenced in schema categories"+key);console.error(referenceModel,attr,modelAttributes);createdCategory.keys[j]=this.generateRoleAttribute("error");createdCategory.keys[j].field=key;createdCategory.keys[j].error="Attribute referenced in schema categories not found";continue}else{var editorName;if(attr.options===undefined){attr.options={}}if(filters.length===0||$.inArray(key,filters)!==-1){set(attr,"options.hiddenInForm",false)}else{set(attr,"options.hiddenInForm",true)}var label=key;if(override_labels[key]){label=override_labels[key]}createdCategory.keys[j]={field:label,model:attr,editor:this.generateEditorNameForAttribute(attr)};createdCategory=this.insertValueIntoAttribute(createdCategory,inspectedDataItem,key,attr,j)}}}this.categories.push(createdCategory)}console.log("categories",this.categories);return this.categories}else{return undefined}}}.property("inspectedDataItem","inspectedItemType")});application.register("mixin:inspectable-item",mixin)}});Ember.Application.initializer({name:"LoadingindicatorMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var get=Ember.get,set=Ember.set;isNone=Ember.isNone;var mixin=Mixin("loadingindicator",{init:function(){if(isNone(get(this,"partials.indicators"))){set(this,"partials.indicators",[])}this.partials.indicators.pushObject("loadingindicator");this._super()},isLoading:0,addConcurrentLoading:function(name){if(isNone(get(concurrentLoadingsPending,name))){set(concurrentLoadingsPending,name,{count:1})}else{concurrentLoadingsPending.incrementProperty(name+".count")}recomputeIsLoading(this)},removeConcurrentLoading:function(name){concurrentLoadingsPending.decrementProperty(name+".count");if(get(concurrentLoadingsPending,name+".count")<=0){delete concurrentLoadingsPending[name]}recomputeIsLoading(this)}});recomputeIsLoading=function(controller){var totalCount=0;var concurrentLoadingsKeys=Ember.keys(concurrentLoadingsPending);for(var i=0;i<concurrentLoadingsKeys.length;i++){var selectedConcurrentLoading=concurrentLoadingsPending[concurrentLoadingsKeys[i]];totalCount+=get(selectedConcurrentLoading,"count")||0}set(controller,"isLoading",totalCount>0)};concurrentLoadingsPending=Ember.Object.create({userview:{count:0},perfdata:{count:0}});application.register("mixin:loadingindicator",mixin)}});Ember.Application.initializer({name:"MetaSerializerMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var isNone=Ember.isNone;var mixin=Mixin("metaSerializer",{extractMeta:function(store,type,payload){console.log("extractMeta",store,type,payload);if(payload.meta===undefined){payload.meta={}}if(payload&&payload.total!==undefined){payload.meta.total=payload.total}if(payload&&payload.messages){payload.meta.totalmessages=payload.messages}delete payload.total;delete payload.messages;delete payload.success;console.log("normalizePayload",arguments);if(isNone(type)||isNone(type.typeKey)){console.error("Error while retrieving typeKey from model is it is none.")}var typeKey=type.typeKey,typeKeyPlural=typeKey.pluralize();payload[typeKeyPlural]=payload.data;delete payload.data;console.log("payload",typeKeyPlural,payload);if(payload&&payload[typeKeyPlural]&&typeof payload[typeKeyPlural]!=="undefined"){payload[typeKeyPlural].forEach(function(item){this.extractRelationships(payload,item,type)},this)}else if(typeof payload[typeKey]!=="undefined"){this.extractRelationships(payload,payload[typeKey],type)}return this._super(store,type,payload)},extractRelationships:function(payload,item,type){this._super.apply(this,arguments)}});application.register("mixin:meta-serializer",mixin)}});Ember.Application.initializer({name:"NotificationsMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var get=Ember.get,set=Ember.set;assert=Ember.assert;var mixin=Mixin("notifications",{init:function(){this.partials.statusbar.pushObject("notificationsstatusmenu");this._super()},notifications:function(){assert("The notification store should be an instance of DS.Store",DS.Store.detectInstance(this.store));return this.store.find("notification")}.property(),createNotification:function(level,message){assert("The notification store should be an instance of DS.Store",DS.Store.detectInstance(this.store));var falevel=level;if(message===undefined||level===undefined){message="missing information for notification";falevel="warning";level="warning"}if(level==="error"){falevel="warning";level="danger"}var notification=this.store.createRecord("notification",{level:level,message:message,timestamp:(new Date).getTime(),falevel:"fa-"+falevel});notification.save()},notificationCount:function(){return get(this,"notifications.length")}.property("notifications.length")});application.register("mixin:notifications",mixin)}});Ember.Application.initializer({name:"PromisemanagerMixin",after:["MixinFactory","PromisesRegistry"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var promisesmanager=container.lookupFactory("registry:promises");var get=Ember.get,set=Ember.set;var mixin=Mixin("promisemanager",{promises:promisesmanager,init:function(){this.partials.statusbar.pushObject("promisemanagerstatusmenu");this._super()}});application.register("mixin:promisemanager",mixin)}});Ember.Application.initializer({name:"RequirejsmocksmanagerMixin",after:["MixinFactory","MocksRegistry"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var requirejsmocksmanager=container.lookupFactory("registry:mocks");var mixin=Mixin("Requirejsmocksmanager",{requirejsmocksmanager:requirejsmocksmanager,init:function(){this.partials.statusbar.pushObject("requirejsmockingstatusmenu");this._super()},actions:{deleteMock:function(modulePath){requirejsmocksmanager.deleteMock(modulePath)},editMock:function(mock){requirejsmocksmanager.editMock(mock)},addMock:function(){requirejsmocksmanager.addMock()}}});application.register("mixin:requirejsmocksmanager",mixin)}});Ember.Application.initializer({name:"SchemamanagerMixin",after:["Schemas","MixinFactory","FormsUtils","DataUtils","SearchmethodsRegistry"],initialize:function(container,application){var schemasLoader=container.lookupFactory("loader:schemas");var Mixin=container.lookupFactory("factory:mixin");var formsUtils=container.lookupFactory("utility:forms");var dataUtils=container.lookupFactory("utility:data");var searchmethodsRegistry=container.lookupFactory("registry:searchmethods");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var mixin=Mixin("schemamanager",{configuration:window.canopsisConfiguration,available_types:schemasLoader.generatedModels,init:function(){this.partials.statusbar.pushObject("schemamanagerstatusmenu");this._super()},displayedTypes:function(){var searchCriterion=get(this,"schemaManagerSearchCriterion");console.log("recompute displayedTypes");if(isNone(searchCriterion)){return get(this,"available_types")}else{console.log("searchCriterion",searchCriterion);var res=searchmethodsRegistry.getByName("simple").filter(get(this,"available_types"),{propertyToCheck:"name",searchCriterion:get(this,"schemaManagerSearchCriterion")});return res}}.property("available_types","schemaManagerSearchCriterion"),actions:{addModelInstance:function(type){console.log("add",type);var record=dataUtils.getStore().createRecord(type,{crecord_type:type.underscore()});console.log("temp record",record);var recordWizard=formsUtils.showNew("modelform",record,{title:__("Add ")+type});recordWizard.submit.done(function(){record.save()})}}});application.register("mixin:schemamanager",mixin)}});Ember.Application.initializer({name:"ScreentoolstatusmenuMixin",after:"MixinFactory",initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var mixin=Mixin("Screentoolstatusmenu",{init:function(){this.partials.statusbar.pushObject("screentoolstatusmenu");this._super()},actions:{changeScreenSize:function(size){var cssSize={small:"480px",medium:"940px",large:"100%"}[size];$("body").animate({width:cssSize})}}});application.register("mixin:screentoolstatusmenu",mixin)}});Ember.Application.initializer({name:"UserprofilestatusmenuMixin",after:["MixinFactory","FormsUtils","DataUtils","NotificationUtils","MocksRegistry"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var formsUtils=container.lookupFactory("utility:forms");var dataUtils=container.lookupFactory("utility:data");var notificationUtils=container.lookupFactory("utility:notification");var requirejsmocksmanager=container.lookupFactory("registry:mocks");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var mixin=Mixin("Userprofilestatusmenu",{requirejsmocksmanager:requirejsmocksmanager,init:function(){if(!isNone(this.partials.statusbar)){this.partials.statusbar.pushObject("userstatusmenu")}this._super()},actions:{showUserProfile:function(){var applicationController=this;var ouser=get(this,"controllers.login.record");var recordWizard=formsUtils.showNew("modelform",ouser,{title:get(ouser,"_id")+" "+__("profile"),filterFieldByKey:{firstname:{readOnly:true},lastname:{readOnly:true},authkey:{readOnly:true},ui_language:true,mail:true,userpreferences:true}});recordWizard.submit.then(function(form){console.group("submit form:",form);var editedUser=form.get("formContext");console.log("save record:",editedUser);set(editedUser,"crecord_type","user");editedUser.id=editedUser._id;var editedUserRecord=dataUtils.getStore().createRecord("user",editedUser);editedUserRecord.save();notificationUtils.info(__("profile")+" "+__("updated"));uilang=get(editedUser,"ui_language");ouilang=get(ouser,"ui_language");console.log("Lang:",uilang,ouilang);if(uilang!==ouilang){console.log("Language changed, will prompt for application reload");applicationController.send("promptReloadApplication","Interface language has changed, reload canopsis to apply changes ?")}console.groupEnd();
})}}});application.register("mixin:userprofilestatusmenu",mixin)}});Ember.Application.initializer({name:"ValidationMixin",after:["MixinFactory","FormsUtils"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var formUtils=container.lookupFactory("utility:forms");var get=Ember.get,set=Ember.set;var mixin=Mixin("validation",{validationFields:function(){console.warn('Property "validationFields" must be defined on the concrete class.');return"<validationFields is null>"},changeTAB:function(name,active){var toFind="#"+name+"_tab";if(active)$(toFind).addClass("active");else $(toFind).removeClass("active");var id="#"+name;if(active)$(id).addClass("active");else $(id).removeClass("active")},set_tab:function(last_field_error){var categories=this.categories;for(var i=0;i<categories.length;i++){var current=categories[i];this.changeTAB(current.slug,false);Ember.set(current,"isDefault",false)}outer:for(var i=0;i<categories.length;i++){var current=categories[i];for(var j=0;j<current.keys.length;j++){var key=current.keys[j];var field=key.field;if(field===last_field_error){this.changeTAB(current.slug,true);Ember.set(current,"isDefault",true);break outer}}}},empty_validationFields:function(){set(this,"validationFields",Ember.A())},validation:function(){console.group("Form validation");var validationFields=get(this,"validationFields");var isValid=true;var error_array=[];var last_field_error="";var form=this;if(validationFields){for(var z=0,l=validationFields.length;z<l;z++){console.log("check if field is valid",get(validationFields[z],"attr.field"));var current=validationFields[z].validate();if(current.valid!==true){error_array.push(current);console.log("Attribute not valid",validationFields[z]);last_field_error=validationFields[z].attr.field||validationFields[z].attr.parent.attr.field;isValid=false;if(validationFields[z].removedFromDOM){form.validateOnInsert=true;formUtils.showInstance(form);break}}}}if(!isValid){console.log("form not valid");this.set_tab(last_field_error)}console.groupEnd();return isValid}});application.register("mixin:validation",mixin)}});Ember.Application.initializer({name:"ValidationFieldMixin",after:["FormsRegistry","MixinFactory"],initialize:function(container,application){var Mixin=container.lookupFactory("factory:mixin");var formsregistry=container.lookupFactory("registry:forms");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var mixin=Mixin("validationField",{attr:"",init:function(){var form=formsregistry.formwrapper.form;set(this,"form",form);var attributes=this.attr||this.content;set(this,"attr",attributes);if(isNone(attributes)||isNone(attributes.model)){console.warn("No attributes found on this component")}else{var model=attributes.model;if(isNone(get(this,"value"))&&!isNone(get(this,"attr.model.options.default"))){this.set("value",get(this,"attr.model.options.default"))}var type=get(model,"options.input_type")||get(model,"type");type=type==="string"?"text":type}this._super()},didInsertElement:function(){var formController=formsregistry.formwrapper.form;if(formController){var validationFields=get(formController,"validationFields");if(validationFields){validationFields.pushObject(this)}}if(formController.validateOnInsert){this.validate()}},focusOut:function(){this.validate()},validate:function(){var formController=formsregistry.formwrapper.form;var FCValidation=get(formController,"validation");if(FCValidation!==undefined){var attr=get(this,"attr");var valideStruct=Ember.validators.validate(attr);console.log("valideStruct",valideStruct);if(!this.removedFromDOM){var selector=this.$();selector.closest("div").next(".help-block").remove();if(!valideStruct.valid){selector.closest("div").addClass("has-error").after('<span class="help-block">'+valideStruct.error+"</span>")}else{selector.closest("div").removeClass("has-error")}}return valideStruct}}});application.register("mixin:validation-field",mixin)}});Ember.Application.initializer({name:"ApplicationRoute",after:["AuthenticatedRoute","FormsRegistry","RoutesUtils","ActionsUtils"],initialize:function(container,application){var AuthenticatedRoute=container.lookupFactory("route:authenticated");var formsregistry=container.lookupFactory("registry:forms");var routesUtils=container.lookupFactory("utility:routes");var actionsUtils=container.lookupFactory("utility:actions");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;function bindKey(keyCombination,actionName){Mousetrap.bind([keyCombination],function(e){console.log("binding",arguments);actionsUtils.doAction(actionName);return false})}var route=AuthenticatedRoute.extend({actions:{showView:function(id){console.log("ShowView action",arguments);var currentViewId=routesUtils.getCurrentViewId();this.transitionTo("userview",id)},showEditFormWithController:function(formController,formContext,options){if(formController.ArrayFields){while(formController.ArrayFields.length>0){formController.ArrayFields.pop()}}var formName=get(formController,"formName");console.log("showEditFormWithController",formController,formName,formContext,options);var formwrapperController=this.controllerFor("formwrapper");set(formsregistry,"formwrapper",formwrapperController);formController.setProperties({formwrapper:formwrapperController,formContext:formContext});formwrapperController.setProperties({form:formController,formName:formName});formwrapperController.send("show");return formController}},beforeModel:function(transition){var route=this;var store=DS.Store.create({container:get(this,"container")});var footerPromise=store.find("userview","view.app_footer");var headerPromise=store.find("userview","view.app_header");var devtoolsPromise=store.find("userview","view.app_devtools");var frontendConfigPromise=store.find("frontend","cservice.frontend");var ticketPromise=store.find("ticket","cservice.ticket");var appController=route.controllerFor("application");ticketPromise.then(function(queryResults){appController.ticketConfig=queryResults});frontendConfigPromise.then(function(queryResults){console.log("frontend config found");appController.frontendConfig=queryResults;var keybindings=get(queryResults,"keybindings");console.log("load keybindings",keybindings);for(var i=0,l=keybindings.length;i<l;i++){var currentKeybinding=keybindings[i];console.log("Mousetrap define",currentKeybinding);bindKey(currentKeybinding.label,currentKeybinding.value)}console.log("transition",transition);if(get(transition,"targetName")==="index"){console.info("on index route, redirecting to the appropriate route");var defaultview=get(appController,"frontendConfig.defaultview");if(!isNone(defaultview)){console.log("redirect to view",defaultview);route.transitionTo("/userview/"+defaultview)}}});headerPromise.then(function(queryResults){appController.headerUserview=queryResults});footerPromise.then(function(queryResults){appController.footerUserview=queryResults});devtoolsPromise.then(function(queryResults){appController.devtoolsUserview=queryResults});var superPromise=this._super(transition);set(this,"promiseArray",[superPromise,footerPromise,headerPromise,devtoolsPromise,frontendConfigPromise,ticketPromise]);set(this,"store",store);var authpromise=this.authConfig("authconfiguration",function(authconfigurationRecord){var serviceList=get(authconfigurationRecord,"services");console.log("authconfigurationRecord",authconfigurationRecord,serviceList);if(!isNone(serviceList)){for(var i=0,l=serviceList.length;i<l;i++){if(serviceList[i]){var promise=route.authConfig(serviceList[i]);get(route,"promiseArray").pushObject(promise)}}}});get(this,"promiseArray").pushObject(authpromise);return Ember.RSVP.Promise.all(get(this,"promiseArray"))},authConfig:function(authType,callback){var authId="cservice."+authType;var appController=this.controllerFor("application");var store=get(this,"store");var onReadyRecord=function(appController,authType,record,callback){appController[authType]=record;if(!appController.authTypes){appController.authTypes=[]}appController.authTypes.pushObject(authType);if(!isNone(callback)){callback(record)}};var promise=store.find(authType,authId);promise.then(function(queryResults){console.log(authType,"config found",queryResults);onReadyRecord(appController,authType,queryResults,callback)},function(){console.log("create base "+authType+" config");var record=store.createRecord(authType,{crecord_name:authType});record.id=authId;onReadyRecord(appController,authType,record,callback)});return promise},model:function(){return{title:"Canopsis"}},renderTemplate:function(){console.info("render application template");this.render();var formwrapperController=this.controllerFor("formwrapper");this.render("formwrapper",{outlet:"formwrapper",into:"application",controller:formwrapperController});var recordinfopopupController=this.controllerFor("recordinfopopup");this.render("recordinfopopup",{outlet:"recordinfopopup",into:"application",controller:recordinfopopupController})}});application.register("route:application",route)}});Ember.Application.initializer({name:"AuthenticatedRoute",after:["DataUtils","ActionsUtils"],initialize:function(container,application){var dataUtils=container.lookupFactory("utility:data");var actionsUtils=container.lookupFactory("utility:actions");var get=Ember.get,set=Ember.set;var route=Ember.Route.extend({setupController:function(controller){this.controllerFor("application").onIndexRoute=true;actionsUtils.setDefaultTarget(controller);return this._super.apply(this,arguments)},beforeModel:function(transition){var route=this;var store=DS.Store.create({container:get(this,"container")});loggedaccountAdapter=dataUtils.getEmberApplicationSingleton().__container__.lookup("adapter:loggedaccount");var loginPromise=store.findAll("loggedaccount");loginPromise.then(function(promiseResult){var record=promiseResult.content[0];var loginController=route.controllerFor("login");set(loginController,"record",record);dataUtils.setLoggedUserController(loginController);var appController=route.controllerFor("application");var enginesviews=get(appController,"enginesviews");for(var i=0,l=enginesviews.length;i<l;i++){var item=enginesviews[i];if(get(loginController,"record._id")==="root"){set(item,"displayable",true)}else{viewId=item.value;if(get(loginController,"record.rights.showview_"+viewId.replace(".","_"))){set(item,"displayable",true)}else{set(item,"displayable",false)}}}});var superPromise=this._super(transition);return Ember.RSVP.Promise.all([superPromise,loginPromise])},actions:{editAndSaveModel:function(model,record_raw,callback){console.log("editAndSaveModel",record_raw);model.setProperties(record_raw);var promise=model.save();if(callback!==undefined){promise.then(callback)}},addRecord:function(crecord_type,raw_record,options){raw_record[crecord_type]=crecord_type;if(options!==undefined&&options.customFormAction!==undefined){options.customFormAction(crecord_type,raw_record)}else{var record=this.store.createRecord(crecord_type,raw_record);var promise=record.save();if(options!==undefined&&options.callback!==undefined){promise.then(options.callback)}}},error:function(reason,transition){if(reason.status===403||reason.status===401){this.loginRequired(transition)}}}});application.register("route:authenticated",route)}});Ember.Application.initializer({name:"IndexRoute",after:"AuthenticatedRoute",initialize:function(container,application){var AuthenticatedRoute=container.lookupFactory("route:authenticated");var set=Ember.set,get=Ember.get;var route=AuthenticatedRoute.extend({});application.register("route:index",route)}});Ember.Application.initializer({name:"UserviewRoute",after:["AuthenticatedRoute","DataUtils","NotificationUtils","FormsUtils","WidgetSelectorsUtils"],initialize:function(container,application){var dataUtils=container.lookupFactory("utility:data");var formsUtils=container.lookupFactory("utility:forms");var notificationUtils=container.lookupFactory("utility:notification");var widgetSelectorsUtils=container.lookupFactory("utility:widget-selectors");var AuthenticatedRoute=container.lookupFactory("route:authenticated");var set=Ember.set,get=Ember.get,isNone=Ember.isNone;var initialLoadDone=false;var route=AuthenticatedRoute.extend({beforeModel:function(transition){var app=this.controllerFor("application");app.addConcurrentLoading("userview");return this._super(transition)},afterModel:function(view,transition){var app=this.controllerFor("application");app.removeConcurrentLoading("userview");return this._super(view,transition)},actions:{error:function(error,transition){if(error.status===0){console.debug("no error detected in access status")}else if(error.status===403){console.debug("go to some default route")}else if(error.status===401){console.debug("handle 401")}else if(error.status===404){this.transitionTo("/userview/view.404")}else{console.error(error);notificationUtils.error(__("Impossible to load view."))}},toggleEditMode:function(){var applicationController=this.controllerFor("application");if(get(applicationController,"editMode")===true){console.info("Leaving edit mode");set(applicationController,"editMode",false)}else{var viewWidgets=widgetSelectorsUtils.children(get(this.controllerFor("userview"),"containerwidget"));for(var i=0,l=viewWidgets.length;i<l;i++){var currentWidget=viewWidgets[i];if(get(currentWidget,"rollbackable")){currentWidget.send("rollback")}}console.info("Entering edit mode");set(applicationController,"editMode",true)}},exportCurrentView:function(){var viewModel=this.controllerFor("userview").get("model");var viewJSON=viewModel.serialize();dataUtils.download(JSON.stringify(viewJSON),get(viewModel,"crecord_name")+".json","application/json")},toggleDevTools:function(){$(".debugmenu").slideToggle(200)},toggleFullscreen:function(){var applicationController=this.controllerFor("application");var updatedFullscreenMode=!get(applicationController,"fullscreenMode");set(applicationController,"fullscreenMode",updatedFullscreenMode)},stopLiveReporting:function(){this.setReportingInterval(undefined)},displayLiveReporting:function(){var userview=this;var record=dataUtils.getStore().createRecord("livereporting",{crecord_type:"livereporting"});var recordWizard=formUtils.showNew("modelform",record,{title:__("Edit live reporting")});recordWizard.submit.then(function(form){record=get(form,"formContext");var interval=get(record,"dateinterval");set(userview.controllerFor("application"),"interval",interval);userview.setReportingInterval(interval);console.debug("setting interval to value",interval)})},refresh:function(){var userviewController=this.controllerFor("userview");console.log("refresh",this);this.refresh();userviewController.send("refreshView")}},setReportingInterval:function(interval){set(this.controllerFor("application"),"interval",interval);var controller=this.controllerFor("userview");var rootWidget=get(controller,"content.containerwidget");var children=widgetSelectorsUtils.children(rootWidget);if(Ember.isNone(interval)){interval={}}for(var i=0,l=children.length;i<l;i++){console.debug("Child widget",get(children[i],"id"),children[i]);var widgetController=get(children[i],"controllerInstance");if(!Ember.isNone(widgetController)){widgetController.updateInterval(interval)}else{console.error("Unable to find controller instance for widget",get(children[i],"id"))}}},setupController:function(controller,model){console.log("UserviewRoute setupController",arguments);this._super.apply(this,arguments);controller.setProperties({isMainView:true});if(initialLoadDone===false){initialLoadDone=true}set(this.controllerFor("application"),"currentViewId",get(model,"id"));var app=this.controllerFor("application");if(controller.trigger){controller.trigger("refreshView")}}});application.register("route:userview",route)}});Ember.Application.initializer({name:"ApplicationSerializer",after:["MetaSerializerMixin","HashSerializerMixin","NotificationUtils"],initialize:function(container,application){MetaSerializerMixin=container.lookupFactory("mixin:meta-serializer");HashSerializerMixin=container.lookupFactory("mixin:hash-serializer");notificationUtils=container.lookupFactory("utility:notification");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var serializer=DS.RESTSerializer.extend(MetaSerializerMixin,HashSerializerMixin,{normalizeId:function(hash){if(isNone(hash.id)){hash.id=hash._id}}});application.register("serializer:application",serializer)}});Ember.Application.initializer({name:"LoggedaccountSerializer",after:"ApplicationSerializer",initialize:function(container,application){ApplicationSerializer=container.lookupFactory("serializer:application");var serializer=ApplicationSerializer.extend();application.register("serializer:loggedaccount",serializer)}});Ember.Application.initializer({name:"UserviewSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(container,application){var ApplicationSerializer=container.lookupFactory("serializer:application");var EmbeddedRecordSerializerMixin=container.lookupFactory("mixin:embedded-record-serializer");var serializerClass=ApplicationSerializer.extend(EmbeddedRecordSerializerMixin,{});application.register("serializer:userview",serializerClass)}});Ember.Application.initializer({name:"WidgetSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(container,application){var ApplicationSerializer=container.lookupFactory("serializer:application");var EmbeddedRecordSerializerMixin=container.lookupFactory("mixin:embedded-record-serializer");var serializerClass=ApplicationSerializer.extend(EmbeddedRecordSerializerMixin,{});application.register("serializer:widget",serializerClass)}});Ember.Application.initializer({name:"WidgetwrapperSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(container,application){var ApplicationSerializer=container.lookupFactory("serializer:application");var EmbeddedRecordSerializerMixin=container.lookupFactory("mixin:embedded-record-serializer");var serializerClass=ApplicationSerializer.extend(EmbeddedRecordSerializerMixin,{});application.register("serializer:widgetwrapper",serializerClass)}});(function(){function mailValidator(attr,valideStruct){var regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(Ember.isBlank(attr.value)){if(attr.model.required){valideStruct.valid=false;valideStruct.error="Mail is required"}else{valideStruct.valid=true}}else if(regex.test(attr.value)){valideStruct.valid=true}else{valideStruct.valid=false;valideStruct.error="Mail's format should be: X@Y.Z"}return valideStruct}if(Ember.validators===undefined){Ember.validators={}}Ember.validators.mail=mailValidator})();(function(){function maxItemsValidator(attr,valideStruct){var maxItemsModelOption=attr.model.options.maxItems;if(attr.value.length<=maxItemsModelOption){valideStruct.valid=true}else{valideStruct.valid=false;valideStruct.error="There can be at most "+maxItemsModelOption+" item(s)."}return valideStruct}if(Ember.validators===undefined){Ember.validators={}}Ember.validators.maxItems=maxItemsValidator})();(function(){function minItemsValidator(attr,valideStruct){var minItemsModelOption=attr.model.options.minItems;if(attr.value.length>=minItemsModelOption){valideStruct.valid=true}else{valideStruct.valid=false;valideStruct.error="Must have at least "+minItemsModelOption+" item(s)."}return valideStruct}if(Ember.validators===undefined){Ember.validators={}}Ember.validators.minItems=minItemsValidator})();(function(){function numberValidator(attr,valideStruct){if(Ember.isEmpty(attr.value)||!isNaN(attr.value)){valideStruct.valid=true}else{valideStruct.valid=false;valideStruct.error="value should be a number"}return valideStruct}if(Ember.validators===undefined){Ember.validators={}}Ember.validators.number=numberValidator})();(function(){function requiredValidator(attr,valideStruct){console.log("requiredValidator :attr = ",attr);if(attr.model.options.required!==undefined&&attr.model.options.required===true&&(attr.value===undefined||attr.value===""||attr.value===null)){valideStruct.valid=false;valideStruct.error=" Field can't be empty"}else{valideStruct.valid=true;valideStruct.error=""}return valideStruct}if(Ember.validators===undefined){Ember.validators={}}Ember.validators.required=requiredValidator})();(function(){function rightsValidator(attr,valideStruct){void attr;valideStruct.valid=true;return valideStruct}if(Ember.validators===undefined){Ember.validators={}}Ember.validators.rights=rightsValidator})();(function(){var get=Ember.get;function GetValidators(attr){console.log("attr = ",attr);var options=get(attr,"model.options");var validators=[];var validatorName=get(attr,"model.type");var validator=Ember.validators[validatorName];if(validator!==undefined){console.log("pushed : ",validatorName);validators.push(Ember.validators[validatorName])}if(options!==undefined){for(var key in options){if(options.hasOwnProperty(key)){var keyValidatorName=key==="role"?options[key]:key;var keyValidator=Ember.validators[keyValidatorName];if(keyValidator!==undefined){console.log("pushed : ",keyValidatorName);validators.push(Ember.validators[keyValidatorName])}}}}return validators}function makeStruct(attributes){var names=attributes.split(" ");var count=names.length;function constructor(){for(var i=0;i<count;i++){this[names[i]]=arguments[i]}}return constructor}function Validator(attr){var errorMessage="";var valideStruct=makeStruct("valid error");var toReturn=new valideStruct(true,errorMessage);var validators=GetValidators(attr);for(var i=0;i<validators.length;i++){validator=validators[i];toReturn=validator(attr,toReturn);if(toReturn.valid===false){return toReturn}}return toReturn}if(Ember.validators===undefined){Ember.validators={}}Ember.validators.validate=Validator})();Ember.Application.initializer({name:"ApplicationView",initialize:function(container,application){var get=Ember.get,set=Ember.set;var view=Ember.View.extend({rightSideCssClasses:function(){if(get(this,"controller.fullscreenMode")){return"right-side strech fullscreen"}else{return"right-side strech"}}.property("controller.fullscreenMode")});application.register("view:application",view)}});Ember.Application.initializer({name:"EditorView",after:"HashUtils",initialize:function(container,application){var hashUtils=container.lookupFactory("utility:hash");var view=Ember.View.extend({attrBinding:"templateData.keywords.attr.value",init:function(){var id=utils.hash.generateId(this.templateName);this.elementId=id}});application.register("view:editor",view)}});Ember.Application.initializer({name:"FormwrapperView",after:"DragUtils",initialize:function(container,application){var drag=container.lookupFactory("utility:drag");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var view=Ember.View.extend({init:function(){this._super();console.log("formwrapper view init",this,get(this,"controller"));set(this,"controller.widgetwrapperView",this)},didInsertElement:function(){drag.setDraggable(this.$("#formwrapper .modal-title"),this.$("#formwrapper"))},willDestroyElement:function(){this.$("#formwrapper").modal("hide");this._super()},registerHooks:function(){this.hooksRegistered=true;console.log("registerHooks",this);this.get("controller").on("validate",this,this.hidePopup);this.get("controller").on("hide",this,this.hidePopup);this.get("controller").on("rerender",this,this.rerender);var formwrapperView=this;this.$("#formwrapper").on("hidden.bs.modal",function(){formwrapperView.onPopupHidden.apply(formwrapperView,arguments)})},unregisterHooks:function(){this.get("controller").off("validate",this,this.hidePopup);this.get("controller").off("hide",this,this.hidePopup);this.get("controller").off("rerender",this,this.rerender)},showPopup:function(){console.log("view showPopup");if(!this.hooksRegistered){this.registerHooks()}this.$("#formwrapper").modal("show").css("top",0).css("left",0);if(get(this,"controller.form")){get(this,"controller.form").send("show")}},hidePopup:function(){console.log("view hidePopup");this.$("#formwrapper").modal("hide")},onPopupHidden:function(){console.log("onPopupHidden",arguments);var submit=get(this,"controller.form.submit");if(!isNone(submit)&&submit.state()==="pending"){console.info("rejecting form submission");get(this,"controller.form").send("abort")}}});application.register("view:formwrapper",view);Ember.Handlebars.helper("formview",Ember.View)}});Ember.Application.initializer({name:"ListlineView",initialize:function(container,application){var set=Ember.set,get=Ember.get;var view=Ember.View.extend({tagName:"tr",templateName:"listline",classNames:["listline"],checkChanged:function(){var checkbox=this.$(".toggle");if(checkbox!==undefined){checkbox.iCheck("check")}}.observes("controller.isAllSelected")});application.register("view:listline",view)}});Ember.Application.initializer({name:"MixineditdropdownView",after:"SchemasRegistry",initialize:function(container,application){var schemasRegistry=container.lookupFactory("registry:schemas");var set=Ember.set,get=Ember.get,isNone=Ember.isNone;var view=Ember.View.extend({tagName:"span",templateName:"mixineditdropdown",hasEditableMixins:function(){return get(this,"editableEnabledMixins.length")||get(this,"wrapperMixins.length")}.property("editableEnabledMixins","wrapperMixins"),wrapperMixins:function(){var mixins=Ember.A();if(get(this,"isGridLayout")){mixins.pushObject({name:"gridlayout"})}return mixins}.property("isGridLayout"),editableEnabledMixins:function(){var mixins=get(this,"mixins");var editableMixins=Ember.A();if(mixins){for(var i=0;i<mixins.length;i++){if(schemasRegistry.getByName(mixins[i].name.camelize())){editableMixins.pushObject(mixins[i])}}}return editableMixins}.property("mixins")});application.register("view:mixineditdropdown",view)}});Ember.Application.initializer({name:"PartialslotView",initialize:function(container,application){var view=Ember.View.extend({canopsisConfiguration:window.canopsisConfiguration,showPartialslots:Ember.computed.alias("canopsisConfiguration.showPartialslots"),templateName:"partialslot",tagName:"span",slot:Ember.required()});application.register("view:partialslot",view);Ember.Handlebars.helper("partialslot",view)}});Ember.Application.initializer({name:"RecordinfopopupView",after:"DragUtils",initialize:function(container,application){var drag=container.lookupFactory("utility:drag");var get=Ember.get,set=Ember.set;var view=Ember.View.extend({didInsertElement:function(){console.log("Recordinfopopup dom element");$(window).on("resize",function(){var left=($(window).width()-$("#recordinfopopup").outerWidth())/2;$("#recordinfopopup").css("left",left)});drag.setDraggable($("#recordinfopopup .hand"),$("#recordinfopopup"))}});application.register("view:recordinfopopup",view)}});Ember.Application.initializer({name:"TabledraggablethView",initialize:function(container,application){var get=Ember.get,set=Ember.set;var view=Ember.View.extend({templateName:"tabledraggableth",tagName:"th",attributeBindings:["draggable","droppable"],draggable:"true",droppable:"true",click:function(){this.get("controller").send("sort",get(this,"attr"))},drag:function(event){var ths=this.$().parent().children("th"),mouseX=event.originalEvent.clientX;$(ths).css({"border-right":"0"});this.closestTh=undefined;var closestDistance=Infinity;for(var i=0,l=ths.length;i<l;i++){var absoluteDistance=Math.abs($(ths[i]).position().left+$(ths[i]).width()-mouseX);if(absoluteDistance<closestDistance){this.closestTh=ths[i];closestDistance=absoluteDistance}}$(this.closestTh).css({"border-right":"10px solid blue"})},dragEnd:function(event){var ths=this.$().parent().children("th");$(ths).css({"border-right":"0"});console.log("permute",this.getPosition(this.$()),this.getPosition($(this.closestTh)));this.permuteColumns(this.getPosition(this.$()),this.getPosition($(this.closestTh)))},swapColumnsInDom:function(from,to){console.log("swapColumnsInDom",arguments);table=this.$().parent();var rows=this.$().parent().parent().parent().find("tr");console.log("rows",rows);var cols;rows.each(function(){cols=$(this).children("th, td");console.log("cols",cols);cols.eq(from+1).detach().insertAfter(cols.eq(to+1))})},permuteColumns:function(startIndex,endIndex){var controller=get(this,"controller");var columns=this.getColumns();if(startIndex===0||endIndex===0){console.log("unable to perform drag and drop operation");controller.send("refreshView")}console.debug("columns before drag",columns);var permutation=columns.splice(startIndex-1,1)[0];var view=this;if(!Ember.isNone(permutation)){console.debug("permutation is",permutation);console.debug("permutation is replaced between",columns[endIndex-1],"and",columns[endIndex]);if(startIndex>endIndex){columns.splice(endIndex,0,permutation)}else{columns.splice(endIndex-1,0,permutation)}console.debug("columns after drag",columns);set(controller,"model.user_displayed_columns",columns);set(controller,"displayed_columns",columns);view.swapColumnsInDom(startIndex-1,endIndex-1);controller.saveUserConfiguration()}else{console.log("unable to perform drag and drop operation");controller.send("refreshView")}},getPosition:function(th){var ths=this.$().parent().children("th");var position;ths.each(function(i){var equals=th[0]===ths.eq(i)[0];if(equals){position=i;console.log("element position is",i);return false}});return position},getColumns:function(){var columns=get(this,"controller.displayed_columns");if(Ember.isNone(columns)){var shown_columns=get(this,"controller.shown_columns");console.debug("using shown_columns property",shown_columns);columns=Ember.A();for(var i=0,l=shown_columns.length;i<l;i++){columns.pushObject(get(shown_columns[i],"field"))}}else{console.debug("using displayed_columns property")}return columns}});application.register("view:tabledraggableth",view)}});Ember.Application.initializer({name:"UserviewView",initialize:function(container,application){var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var view=Ember.View.extend({actions:{refreshView:function(){this.rerender()}},hookRegistered:false,registerHooks:function(){if(!get(this,"hookRegistered")){get(this,"controller").on("refreshView",this,this.rerender);this.set("hookRegistered",true)}},unregisterHooks:function(){get(this,"controller").off("refreshView",this,this.rerender);this.set("hookRegistered",false)},rerender:function(){console.info("refreshing view",this);if(get(this,"state")==="destroying"){console.warn("view is being destroying, cancel refresh");return}this._super.apply(this,arguments);this.registerHooks()},didInsertElement:function(){console.log("inserted view",this);this.registerHooks();return this._super.apply(this,arguments)},willClearRender:function(){this.unregisterHooks();return this._super.apply(this,arguments)}});application.register("view:userview",view)}});Ember.Application.initializer({name:"ValidationtextareaComponent",after:"ValidationFieldMixin",initialize:function(container,application){var ValidationFieldMixin=container.lookupFactory("mixin:validation-field");var component=Ember.TextArea.extend(ValidationFieldMixin,{});application.register("component:component-validationtextarea",component);Ember.Handlebars.helper("component-validationtextarea",component)}});Ember.Application.initializer({name:"ValidationtextfieldComponent",after:"ValidationFieldMixin",initialize:function(container,application){var ValidationFieldMixin=container.lookupFactory("mixin:validation-field");var component=Ember.TextField.extend(ValidationFieldMixin,{});application.register("component:component-validationtextfield",component)}});Ember.Application.initializer({name:"WidgetView",after:["MixinsRegistry","SchemasRegistry","WidgetsRegistry","WidgetController"],initialize:function(container,application){var mixinsregistry=container.lookupFactory("registry:mixins");var schemasregistry=container.lookupFactory("registry:schemas");var widgetsregistry=container.lookupFactory("registry:widgets");var WidgetController=container.lookupFactory("controller:widget");var get=Ember.get,set=Ember.set;
function computeMixinsArray(view,widget){var mixinsNames=get(widget,"mixins");var mixinArray=[];console.log("computeMixinsArray",mixinsNames,widget);var mixinOptions={};if(mixinsNames){for(var i=0,l=mixinsNames.length;i<l;i++){var currentName=mixinsNames[i];if(typeof currentName==="string"){Ember.deprecate("Defining mixins as strings is deprecated. The new format is : '{ name: \"mixinName\" }'. This is required by the mixin options system.")}else{currentName=currentName.name.camelize()}mixinOptions[currentName]=mixinsNames[i];var currentClass=mixinsregistry.getByName(currentName).EmberClass;console.log("find mixin",currentName,currentClass);var mixinModel=schemasregistry.getByName(currentName);if(mixinModel!==undefined){mixinModel=mixinModel.EmberModel;var mixinUserPreferenceModel=mixinModel.proto().userPreferencesModel;console.log("mixinModel",mixinUserPreferenceModel);var mixinUserPreferenceModelAttributes=get(mixinUserPreferenceModel,"attributes");console.log("mixinModelAttributes",mixinUserPreferenceModelAttributes);mixinUserPreferenceModelAttributes.forEach(function(item){widget.userPreferencesModel[item.name]=mixinUserPreferenceModel[item.name];widget.userPreferencesModel.attributes.add(item)})}if(currentClass){mixinArray.pushObject(currentClass)}else{get(view,"displayedErrors").pushObject("mixin not found : "+currentName);console.error("mixin not found",currentName)}}var controller=view.get("controller");if(controller.onMixinsApplied){controller.onMixinsApplied()}}mixinArray.pushObject(Ember.Evented);return{array:mixinArray,mixinOptions:mixinOptions}}var view=Ember.View.extend({templateName:"widget",classNames:["widget"],errorMessages:Ember.A(),widgetController:undefined,init:function(){console.group("widget initialisation :",get(this.widget,"xtype"),this.widget,get(this,"widget.tagName"));set(this,"target",get(this,"controller"));this._super();set(this,"displayedErrors",Ember.A());if(!!get(this,"widget")){this.intializeController(this.widget);this.applyAllViewMixins()}else{console.error("No correct widget found for view",this);this.errorMessages.pushObject("No correct widget found")}if(get(this,"widget.tagName")){console.log("custom tagName",get(this,"widget.tagName"));set(this,"tagName",get(this,"widget.tagName"))}var cssClasses=get(this,"widget.cssClass");if(cssClasses){console.log("custom tagName",get(this,"widget.tagName"));set(this,"classNames",cssClasses.split(","))}console.groupEnd()},applyAllViewMixins:function(){var controller=get(this,"controller");console.group("apply widget view mixins",controller.viewMixins);if(controller.viewMixins!==undefined){for(var i=0,mixinsLength=controller.viewMixins.length;i<mixinsLength;i++){var mixinToApply=controller.viewMixins[i];console.log("mixinToApply",mixinToApply);if(mixinToApply.mixins[0].properties.init!==undefined){console.warn("The mixin",mixinToApply,"have a init method. This practice is not encouraged for view mixin as they are applied at runtime and the init method will not be triggerred")}mixinToApply.apply(this)}}console.groupEnd()},intializeController:function(widget){console.group("set controller for widget",widget);var controller=this.instantiateCorrectController(widget);this.setProperties({controller:controller,templateName:get(widget,"xtype")});widget.set("controller",controller);this.registerHooks();console.groupEnd()},instantiateCorrectController:function(widget){console.log("instantiateCorrectController",arguments);var xtype=get(widget,"xtype");if(xtype===undefined||xtype===null){console.error("no xtype for widget",widget,this)}var mixins=computeMixinsArray(this,widget);mixins.array.pushObject({model:widget,target:get(this,"target")});var widgetControllerInstance;var widgetClass=widgetsregistry.getByName(get(widget,"xtype"));if(widgetClass!==undefined){widgetClass=widgetClass.EmberClass}else{widgetClass=WidgetController}widgetControllerInstance=widgetClass.createWithMixins.apply(widgetClass,mixins.array);widgetControllerInstance.refreshPartialsList();Ember.setProperties(widgetControllerInstance,{"model.displayedErrors":get(this,"displayedErrors"),mixinOptions:mixins.mixinOptions});widgetControllerInstance.mixinsOptionsReady();var mixinsName=widget._data.mixins;if(mixinsName){for(var i=0,l=mixinsName.length;i<l;i++){var currentName=mixinsName[i];var currentMixin=mixinsregistry.all[currentName];if(currentMixin){currentMixin.apply(widgetControllerInstance)}}}return widgetControllerInstance},didInsertElement:function(){console.log("inserted widget, view:",this);this.registerHooks();return this._super.apply(this,arguments)},willDestroyElement:function(){clearInterval(get(this,"widgetRefreshInterval"));this.unregisterHooks();return this._super.apply(this,arguments)},registerHooks:function(){console.log("registerHooks",get(this,"controller"),get(this,"controller").on);get(this,"controller").on("refresh",this,this.rerender);return this._super()},unregisterHooks:function(){get(this,"controller").off("refresh",this,this.rerender);return this._super()}});Ember.Handlebars.helper("widgethelper",view);application.register("view:widget",view)}});Ember.Application.initializer({name:"WidgetslotView",initialize:function(container,application){var get=Ember.get,set=Ember.set;var view=Ember.View.extend({init:function(){console.log("widgetslot init",get(this,"controller.content.widgetslotTemplate"));var widgetslotTemplate=get(this,"controller.content.widgetslotTemplate");if(widgetslotTemplate!==undefined&&widgetslotTemplate!==null&&Ember.TEMPLATES[widgetslotTemplate]!==undefined){set(this,"templateName",widgetslotTemplate)}this._super.apply(this,arguments)},templateName:"widgetslot-default",classNames:["widgetslot"]});Ember.Handlebars.helper("widgetslot",view);application.register("view:widgetslot",view)}});Ember.Application.initializer({name:"component-editor",after:"DebugUtils",initialize:function(container,application){debugUtils=container.lookupFactory("utility:debug");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var component=Ember.Component.extend({tagName:"span",canopsisConfiguration:window.canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),init:function(){console.log("init editor compo");if(get(this,"mode")==="standalone"){set(this,"attr",{value:undefined});Ember.addObserver(this,"attr.value",this,this.onValueChange)}this._super()},onValueChange:function(){alert("value change");set(this,"value",get(this,"attr.value"))},actions:{inspect:function(){debugUtils.inspectObject(get(this,"content"))}},description:function(){return get(this,"content.model.options.description")}.property(),editorType:function(){console.group("editorType");var overrides=get(this,"editorOverrides");var type=get(this,"content.model.type");var role=get(this,"content.model.options.role");var field=get(this,"content.field");console.log("content:",get(this,"content"));console.log("type:",get(this,"content.field"));console.log("type:",type);console.log("role:",role);var editorName;if(!isNone(overrides)&&!isNone(field)&&get(overrides,field)){editorName="editor-"+get(overrides,field)}else{if(role){if(!isNone(overrides)&&get(overrides,role)){editorName="editor-"+get(overrides,role)}else{editorName="editor-"+role}}else{if(!isNone(overrides)&&get(overrides,type)){editorName="editor-"+get(overrides,type)}else{editorName="editor-"+type}}}if(Ember.TEMPLATES[editorName]===undefined){editorName="editor-defaultpropertyeditor"}console.groupEnd();return editorName}.property("content.type","content.role"),attr:Ember.computed.alias("content")});application.register("component:component-editor",component)}});Ember.Application.initializer({name:"component-renderer",after:["DebugUtils"],initialize:function(container,application){var canopsisConfiguration=window.canopsisConfiguration;var debugUtils=container.lookupFactory("utility:debug");var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var component=Ember.Component.extend({init:function(){var record=get(this,"record"),attrName=get(this,"attrName");if(!isNone(attrName)){console.group("Fetch attribute from record");console.log("record:",record);console.log("attrName:",attrName);if(!isNone(record)){var attr=get(record,"constructor.attributes").get(attrName),value=get(record,attrName);console.log("attr:",attr);console.log("value:",value);var role=get(attr,"options.role");if(!isNone(role)){var renderer="renderer-"+role;if(!isNone(Ember.TEMPLATES[renderer])){console.log("rendererType:",renderer);set(this,"rendererType",renderer)}}set(this,"attr",attr);set(this,"value",value)}console.groupEnd()}this._super.apply(this,arguments)},canopsisConfiguration:canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),actions:{inspect:function(){debugUtils.inspectObject(this)},"do":function(action){var params=[];for(var i=1,l=arguments.length;i<l;i++){params.push(arguments[i])}get(this,"parentView.controller").send(action,params)}},tagName:"span",attr:function(){var shown_columns=get(this,"shown_columns");for(var i=0,l=shown_columns.length;i<l;i++){if(shown_columns[i].field===get(this,"field")){return shown_columns[i]}}}.property("shown_columns")});application.register("component:component-renderer",component)}});Ember.Application.initializer({name:"component-wrapper",initialize:function(container,application){var get=Ember.get,set=Ember.set,isNone=Ember.isNone;var component=Ember.Component.extend({tagName:"span",init:function(){this._super();console.log("init wrapper component");console.log("wrapper component type",get(this,"editor-type"));set(this,"attr",{model:{options:{}}})},onContentUpdate:function(){var callback=get(this,"callback");var referer=get(this,"referer");if(isNone(referer)){console.warn("Referer not defined in component template. callbacks cannot work")}if(!isNone(callback)){callback(get(this,"attr.value"),referer)}else{console.log("Callback is not valid : ",callback,this)}}.observes("attr.value"),editorType:function(){var type=get(this,"editor-type");console.log("editor-type:",type);var editorName="editor-"+type;if(Ember.TEMPLATES[editorName]===undefined){editorName="editor-defaultpropertyeditor"}return editorName}.property("editor-type")});application.register("component:component-wrapper",component)}});Ember.Application.initializer({name:"ModelForm",after:["FormController","SchemasRegistry","InspectableItemMixin","ValidationMixin","SlugUtils"],initialize:function(container,application){var FormController=container.lookupFactory("controller:form");var schemasRegistry=container.lookupFactory("registry:schema");var InspectableitemMixin=container.lookupFactory("mixin:inspectable-item");var ValidationMixin=container.lookupFactory("mixin:validation");var slugUtils=container.lookupFactory("utility:slug");var set=Ember.set,get=Ember.get,isNone=Ember.isNone;var form=FormController.extend(InspectableitemMixin,ValidationMixin,{needs:["application"],partials:{buttons:["formbutton-submit"],debugButtons:["formbutton-inspectform"]},validationFields:Ember.computed(function(){return Ember.A()}),ArrayFields:Ember.A(),filterUserPreferenceCategory:function(category,keyFilters){var keys=get(category,"keys");set(category,"keys",[]);for(var i=0,l=keys.length;i<l;i++){console.log("key",keys[i]);if(this.get("userPreferencesOnly")){if(keys[i].model&&keys[i].model.options&&keys[i].model.options.isUserPreference){get(category,"keys").push(keys[i])}}else{if(keyFilters[keys[i].field]){console.log("magic keys",keys[i]);if(keyFilters[keys[i].field].readOnly){keys[i].model.options.readOnly=true}get(category,"keys").push(keys[i])}}}return category},categories:function(){var res=get(this,"categorized_attributes");var category_selection=[];if(res instanceof Array){for(var i=0,l=res.length;i<l;i++){var category=res[i];category.slug=slugUtils.slug(category.title);console.log("current category",category);if(get(this,"filterFieldByKey")||get(this,"userPreferencesOnly")){this.filterUserPreferenceCategory(category,get(this,"filterFieldByKey"));if(category.keys.length){category_selection.push(res[i])}console.log("category");console.log(category)}else{category_selection.push(res[i])}}if(category_selection.length){set(category_selection[0],"isDefault",true)}return category_selection}else{return[]}}.property("categorized_attributes"),onePageDisplay:function(){return false}.property(),inspectedDataItem:function(){return get(this,"formContext")}.property("formContext"),inspectedItemType:function(){console.log("recompute inspectedItemType",get(this,"formContext"));if(get(this,"formContext.xtype")){return get(this,"formContext.xtype")}else{if(get(this,"formContext.crecord_type")==="user"){return"account"}return get(this,"formContext.crecord_type")||get(this,"formContext.connector_type")}}.property("formContext"),actions:{submit:function(){if(this.validation!==undefined&&!this.validation()){return}console.log("submit action");var override_inverse={};if(this.isOnCreate&&this.modelname){var stringtype=this.modelname.charAt(0).toUpperCase()+this.modelname.slice(1);var model=schemasRegistry.getByName(stringtype);if(model){for(var fieldName in model){if(model.hasOwnProperty(fieldName)){var field=model[fieldName];if(field&&field._meta&&field._meta.options){var metaoptions=field._meta.options;if("setOnCreate"in metaoptions){var value=metaoptions.setOnCreate;set(this,"formContext."+fieldName,value)}}}}}}var options=get(this,"options");if(options&&options.override_labels){for(var key in options.override_labels){if(options.override_labels.hasOwnProperty(key)){override_inverse[options.override_labels[key]]=key}}}var categories=get(this,"categorized_attributes");console.log("setting fields");for(var i=0,li=categories.length;i<li;i++){var category=categories[i];for(var j=0,lj=category.keys.length;j<lj;j++){var attr=category.keys[j];var categoryKeyField=attr.field;if(override_inverse[attr.field]){categoryKeyField=override_inverse[attr.field]}set(this,"formContext."+categoryKeyField,attr.value)}}console.log("this is a widget",get(this,"formContext"));this._super(get(this,"formContext"))}}});application.register("form:model",form)}});Ember.Application.initializer({name:"WidgetForm",after:["FormController","HashUtils","FormsUtils","WidgetsRegistry"],initialize:function(container,application){var FormController=container.lookupFactory("controller:form");var hashUtils=container.lookupFactory("utility:hash");var formsUtils=container.lookupFactory("utility:forms");var widgets=container.lookupFactory("registry:widgets");var get=Ember.get,set=Ember.set;var form=FormController.extend({needs:["application"],title:"Select a widget",widgets:widgets,availableWidgets:function(){console.log("availableWidgets");var widgets=[];for(var i=0,l=widgets.all.length;i<l;i++){var currentWidget=widgets.all[i];widgets.pushObject(currentWidget)}return widgets}.property("widgets.all","title"),actions:{submit:function(newWidgets){var newWidget=newWidgets[0];this._super(this.newWidgetWrapper)},selectItem:function(widgetName){console.log("selectItem",arguments);var containerwidget=get(this,"formContext.containerwidget");console.group("selectWidget",this,containerwidget,widgetName);var store=get(this,"formContext.containerwidget").store;console.log("store to use",get(this,"formContext.containerwidget").store);var widgetId=hashUtils.generateId("widget_"+widgetName);var newWidget=store.createRecord(widgetName,{xtype:widgetName,listed_crecord_type:"account",meta:{embeddedRecord:true,parentType:"widgetwrapper"},id:widgetId});this.newWidgetWrapper=store.push("widgetwrapper",{id:hashUtils.generateId("widgetwrapper"),xtype:"widgetwrapper",title:"wrapper",widget:newWidget,meta:{embeddedRecord:true,parentType:get(containerwidget,"xtype"),parentId:get(containerwidget,"id")}});console.log("newWidgetWrapper",this.newWidgetWrapper);console.log("newWidget",newWidget);console.log("formwrapper",get(this,"formwrapper"));console.info("show embedded widget wizard");formsUtils.showNew("modelform",newWidget,{formParent:this,title:"Add new "+widgetName});console.groupEnd()}},partials:{buttons:[]},parentContainerWidget:Ember.required(),parentUserview:Ember.required()});application.register("form:widget",form)}});Ember.Application.initializer({name:"ConfirmForm",after:"FormController",initialize:function(container,application){var FormController=container.lookupFactory("controller:form");var form=FormController.extend({partials:{buttons:["formbutton-cancel","formbutton-submit"]},confirmation:false,actions:{submit:function(){console.log("confirmed !");this._super()}}});application.register("form:confirm",form)}});Ember.Application.initializer({name:"ViewtreeForm",after:"FormController",initialize:function(container,application){var FormController=container.lookupFactory("controller:form");var form=FormController.extend({partials:{buttons:["formbutton-submit"],debugButtons:["formbutton-inspectform"]}});application.register("form:viewtree",form)}});Ember.Application.initializer({name:"GetFieldHelper",initialize:function(container,application){Ember.Handlebars.helper("getfield",function(ctx,fieldname){var field=get(ctx,fieldname)||"";return new Ember.Handlebars.SafeString(field)})}});Ember.Application.initializer({name:"I18nHelper",initialize:function(container,application){Ember.Handlebars.helper("tr",function(value){var translation;if(!!value){translation=Ember.String.loc(value);console.log("translating",value,"into",translation);return translation}})}});Ember.Application.initializer({name:"LogHelper",initialize:function(container,application){var get=Ember.get,isNone=Ember.isNone;Ember.Handlebars.registerBoundHelper("clog",function(message,options){void options;console.tags.add("helper");var typeKey=get(this,"model.type.typeKey");if(!isNone(typeKey)){console.tags.add(typeKey)}console.log(message);console.tags.remove("helper");if(!isNone(typeKey)){console.tags.remove(typeKey)}return""})}});