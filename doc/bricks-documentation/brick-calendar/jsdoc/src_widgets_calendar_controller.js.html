<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/widgets/calendar/controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <script src="../../doc-config.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>
<div id="main">

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Widgets</h3><ul><li><a href="widget_calendar.html"><img src="icons/application_view_gallery.png" alt="widget"/> calendar</a></li></ul><h3>Schemas</h3><ul><li><a href="schema_calendar.html"><img src="icons/table.png" alt="schema"/> calendar</a></li><li><a href="schema_calendarday.html"><img src="icons/table.png" alt="schema"/> calendarday</a></li><li><a href="schema_calendarevent.html"><img src="icons/table.png" alt="schema"/> calendarevent</a></li><li><a href="schema_calendarsourcepbehavior.html"><img src="icons/table.png" alt="schema"/> calendarsourcepbehavior</a></li><li><a href="schema_calendarsourceuserevents.html"><img src="icons/table.png" alt="schema"/> calendarsourceuserevents</a></li><li><a href="schema_eventcategories.html"><img src="icons/table.png" alt="schema"/> eventcategories</a></li></ul><h3>Adapters</h3><ul><li><a href="adapter_calendardata.html"><img src="icons/disconnect.png" alt="adapter"/> calendardata</a></li><li><a href="adapter_calendarday.html"><img src="icons/disconnect.png" alt="adapter"/> calendarday</a></li></ul><h3>Classes</h3><ul><li><a href="canopsis.frontend.brick-calendar.module_eventcategories%2520component.html">eventcategories component</a></li><li><a href="canopsis.frontend.brick-calendar.module_viewMixin.html">viewMixin</a></li></ul><h3>Mixins</h3><ul><li><a href="module-calendarsourceeventlog.html"><img src="icons/brick.png" alt="mixin"/> calendarsourceeventlog</a></li><li><a href="module-calendarsourcepbehavior.html"><img src="icons/brick.png" alt="mixin"/> calendarsourcepbehavior</a></li><li><a href="module-calendarsourceuserevents.html"><img src="icons/brick.png" alt="mixin"/> calendarsourceuserevents</a></li></ul>
</nav>


    <h1 class="page-title">Source: src/widgets/calendar/controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * Copyright (c) 2015 "Capensis" [http://www.capensis.com]
 *
 * This file is part of Canopsis.
 *
 * Canopsis is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Canopsis is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with Canopsis. If not, see &lt;http://www.gnu.org/licenses/>.
 */

Ember.Application.initializer({
    name: 'CalendarWidget',
    after: ['WidgetFactory', 'CalendarView', 'UserconfigurationMixin', 'CalendarModel', 'SchemasLoader'],
    initialize: function(container, application) {
        var WidgetFactory = container.lookupFactory('factory:widget');
        var viewMixin = container.lookupFactory('view:calendar');
        var UserConfigurationMixin = container.lookupFactory('mixin:userconfiguration');

        var get = Ember.get,
            set = Ember.set,
            isNone = Ember.isNone,
            moment = window.moment;

        var listOptions = {
            mixins: [
                UserConfigurationMixin
            ]
        };

        /**
         * This widget allows to display events, with or without reccurence rules, on a calendar.
         *
         * @memberOf canopsis.frontend.brick-calendar
         * @mixes UserConfigurationMixin
         * @widget calendar
         */
        var widget = WidgetFactory('calendar',{

            viewMixins: [
                viewMixin
            ],

            needs: ['recordinfopopup'],

            init: function() {
                this._super.apply(this, arguments);
                set(this, 'store', DS.Store.extend({
                    container: get(this, 'container')
                }));
            },

            /**
             * Set the reload to true in order to redraw events
             * extend the native refreshContent method
             * @method refreshContent
             */
            refreshContent: function () {
                set(this, 'reload', true);
                this.isReadyWidget('refreshContent');
            },

            /**
             * If refreshContent and DidInsertElement are done, gotoDate is called
             * @method isReadyWidget
             * @param {string} action done method: This method will be set to ready
             */
            isReadyWidget: function(action) {
                var controller = this;
                set(controller, 'ready-' + action, true);

                if(get(controller, 'ready-refreshContent') &amp;&amp; get(controller, 'ready-didInsertElement')) {
                    if (!isNone(get(controller, 'model.started_date'))) {
                        var date = get(controller, 'model.started_date')*1000;
                        console.log('date', date);
                        controller.trigger('goToDate', date);
                    }
                    set(controller, 'ready-refreshContent', false);
                    set(controller, 'ready-didInsertElement', false);
                }
            },

            /**
             * set date view with the actual month if undefined
             * @method getDateCalendarView
             */
            getDateCalendarView: function () {
                var start = get(this, 'model.started_date');
                if (isNone(start)) {
                    set(this, 'calendarStart', parseInt(moment().startOf('month').format('X')));
                    set(this, 'calendarEnd', parseInt(moment().endOf('month').format('X')));
                }
                else {
                    set(this, 'calendarStart', start);
                    var momentStart = moment(start*1000);
                    set(this, 'calendarEnd', parseInt(momentStart.endOf('month').format('X')));
                }
            },

            /**
             * call all methods in parameters when promises given are done (query to the backend are finished)
             * @method onSourceLoad
             * @param {promise} promises Array of promises
             * @param {array} methods Array of methods
             * @param {string} category could be et userEvent category or a behavior (optional)
             */
            onSourceLoad: function (promises, methods, category) {
                var controller = this;
                Ember.RSVP.all(promises).then(function (pargs) {
                    void(pargs);
                    for (var i = 0, methodsLength = methods.length; i &lt; methodsLength; i++) {
                        if (!isNone(category) &amp;&amp; methods[i] === 'reDrawUserEvents' || methods[i] === 'reDrawPbehavior') {
                            get(controller, methods[i])(controller, category);
                        }
                        else {
                            get(controller, methods[i])(controller);
                        }
                    }
                });
            },

            /**
             * inform the user about the last action made
             * @method showUserMessage
             * @param {string} message information about the action to inform
             * @param {string} level indicate the information level (for Bootstrap color element)
             */
            showUserMessage: function (message, level) {
                var controller = this;
                set(controller, 'errorMessage', message);
                set(controller, 'errorLevel', 'alert-' + level);
                setTimeout(function () {
                    set(controller, 'errorMessage', '');
                    set(controller, 'errorLevel', '');
                },3000);
            }
        }, listOptions);

        application.register('widget:calendar', widget);
    }
});
</code></pre>
        </article>
    </section>




</div>


<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Apr 15 2016 12:54:07 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
