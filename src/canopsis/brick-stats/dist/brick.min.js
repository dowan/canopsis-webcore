Ember.Application.initializer({name:"StatsTableWidget",after:["WidgetFactory","TimeWindowUtils","MetricConsumer","MetricFilterable","HumanReadableHelper","TimestampHelper","c3jsComponent"],initialize:function(e,t){var r=e.lookupFactory("factory:widget"),s=e.lookupFactory("mixin:metricconsumer"),i=e.lookupFactory("mixin:metricfilterable"),n=e.lookupFactory("utility:timewindow"),a=Ember.get,o=Ember.set,c=Ember.isNone,u={mixins:[s,i]},l=r("statstable",{init:function(){this._super.apply(this,arguments),o(this,"excludeKeys",["__name__"])},updateInterval:function(e){var t=a(e,"timestamp.$gte"),r=a(e,"timestamp.$lte");c(t)?o(this,"from",void 0):o(this,"from",1e3*t),c(r)?o(this,"to",void 0):o(this,"to",1e3*r),this.refreshContent()},findItems:function(){var e=n.getFromTo(a(this,"time_window"),a(this,"time_window_offset")),t=e[0],r=e[1],s=a(this,"from"),i=a(this,"to");c(s)||(t=s),c(i)||(r=i),o(this,"timewindow",{from:t/1e3,to:r/1e3}),o(this,"users",{}),o(this,"events",{}),o(this,"series",[]);var u=a(this,"widgetDataStore"),l=this;u.findQuery("ctxmetric",{filter:this.getMetricFilter()}).then(function(e){var s=[];a(e,"content").forEach(function(e){s.push(a(e,"id"))}),s.length>0&&l.aggregateMetrics(s,t,r,"last",r-t)})},onMetrics:function(e){var t=a(this,"users"),r=a(this,"events"),s=a(this,"series");$.each(e,function(e,i){var n=a(i,"meta.data_id").split("/"),u=a(i,"points"),l=u.length,h=__("No data available");l&&(h=u[l-1][1]);var p=void 0,_=void 0,m=void 0;6===n.length?(p=n[4],m=n[5]):(p=n[4],_=n[5],m=n[6]);var d=p,v=void 0;v="__canopsis__"===p?r:t,c(a(v,d))&&o(v,d,{__name__:p}),c(_)||(d+="."+_,c(a(v,d))&&o(v,d,{__name__:_})),o(v,d+"."+m,{value:h,__name__:m});var f=[p];c(_)||f.push(_),f.push(m),f=f.join("."),s.push({component:p,resource:_,metric:m,data:u})}),o(this,"users",t),o(this,"events",r),o(this,"series",s),this.notifyPropertyChange("users"),this.notifyPropertyChange("events"),this.notifyPropertyChange("series")},getDelaySeries:function(e,t){var r=a(this,"series"),s=["min","max","average"],i={},n=["x"],u=[],l=function(e){return t?"__canopsis__"!==e:"__canopsis__"===e};$.each(r,function(t,r){var h=a(r,"component"),p=a(r,"resource"),_=a(r,"metric");if(l(h)&&s.indexOf(_)>=0&&(c(e)||e.indexOf(p)>=0)){var m=_;-1===n.indexOf(h)&&n.push(h),-1===u.indexOf(m)&&(u.push(m),o(i,m,[]));var d=a(r,"data"),v=null;d.length>0&&(v=d[d.length-1][1]),a(i,m).push(v)}});var h=[n];return $.each(i,function(e,t){h.push([e].concat(t))}),{data:{x:"x",columns:h,type:"bar"},axis:{x:{type:"category"}}}},userAlarmSolvedSeries:function(){return this.getDelaySeries(["alarm_solved"],!0)}.property("series"),userAlarmAckSeries:function(){return this.getDelaySeries(["alarm_ack_delay"],!0)}.property("series"),userAlarmAckSolvedSeries:function(){return this.getDelaySeries(["alarm_ack_solved"],!0)}.property("series"),userSessionSeries:function(){return this.getDelaySeries(["session_duration"],!0)}.property("series"),alarmSolvedSeries:function(){return this.getDelaySeries(["alarm_solved_delay"],!1)}.property("series"),alarmAckSeries:function(){return this.getDelaySeries(["alarm_ack_delay"],!1)}.property("series"),alarmAckSolvedSeries:function(){return this.getDelaySeries(["alarm_ack_solved_delay"],!1)}.property("series"),alarmCounters:function(){var e=a(this,"series"),t=["alarm","alarm_ack","alarm_solved","alarm_ack_solved"],r=["Alarms","Acknowledged alarms","Solved alarms","Solved/Acknowledged alarms"],s={};$.each(e,function(e,r){var i=a(r,"component"),n=a(r,"resource"),u=a(r,"metric");if("__canopsis__"===i&&t.indexOf(n)>=0){c(a(s,u))&&o(s,u,[]);var l=a(r,"data"),h=null;l.length>0&&(h=l[l.length-1][1]),a(s,u).push(h)}});var i=[["x"].concat(r)];return $.each(s,function(e,t){i.push([e].concat(t))}),{data:{x:"x",columns:i,type:"bar"},axis:{x:{type:"category"}}}}.property("series"),userTable:function(){var e=a(this,"users"),t=[],r=this;return c(e)||$.each(e,function(s,i){if(e.hasOwnProperty(s)&&-1===r.excludeKeys.indexOf(s)){var n=[],o=a(i,"alarm_ack");c(o)||$.each(o,function(e,t){o.hasOwnProperty(e)&&-1===r.excludeKeys.indexOf(e)&&n.push(t)}),t.push({user:i,counters:n})}}),t}.property("users"),userCounters:function(){var e=a(this,"userTable"),t=[];if(!c(e)&&e.length>0){var r=a(e[0],"counters");$.each(r,function(e,r){t.push(r.__name__)})}return t}.property("userTable"),eventCounterTotal:function(){var e=a(this,"events.__canopsis__.alarm"),t=[],r=this;return c(e)||$.each(e,function(s,i){e.hasOwnProperty(s)&&-1===r.excludeKeys.indexOf(s)&&t.push(i)}),t}.property("events"),eventCounterAck:function(){var e=a(this,"events.__canopsis__.alarm_ack"),t=[],r=this;return c(e)||$.each(e,function(s,i){e.hasOwnProperty(s)&&-1===r.excludeKeys.indexOf(s)&&t.push(i)}),t}.property("events"),eventCounterSolved:function(){var e=a(this,"events.__canopsis__.alarm_solved"),t=[],r=this;return c(e)||$.each(e,function(s,i){e.hasOwnProperty(s)&&-1===r.excludeKeys.indexOf(s)&&t.push(i)}),t}.property("events"),eventCounterAckSolved:function(){var e=a(this,"events.__canopsis__.alarm_ack_solved"),t=[],r=this;return c(e)||$.each(e,function(s,i){e.hasOwnProperty(s)&&-1===r.excludeKeys.indexOf(s)&&t.push(i)}),t}.property("events")},u);t.register("widget:statstable",l)}});
//# sourceMappingURL=dist/brick.map.js