Ember.Application.initializer({name:"component-editor",after:"DebugUtils",initialize:function(e,t){var i=e.lookupFactory("utility:debug"),r=Ember.get,o=Ember.set,n=Ember.isNone,a=Ember.Component.extend({tagName:"span",canopsisConfiguration:canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),content:void 0,init:function(){console.log("init editor compo"),"standalone"===r(this,"mode")&&(o(this,"attr",{value:void 0}),Ember.addObserver(this,"attr.value",this,this.onValueChange)),this._super()},onValueChange:function(){o(this,"value",r(this,"attr.value"))},actions:{inspect:function(){i.inspectObject(r(this,"content"))}},description:function(){return r(this,"content.model.options.description")}.property(),editorType:function(){console.group("editorType");var e=r(this,"editorOverrides"),t=r(this,"content.model.type"),i=r(this,"content.model.options.role"),o=r(this,"content.field");console.log("content:",r(this,"content")),console.log("type:",r(this,"content.field")),console.log("type:",t),console.log("role:",i);var a;return a=n(e)||n(o)||!r(e,o)?i?!n(e)&&r(e,i)?"editor-"+r(e,i):"editor-"+i:!n(e)&&r(e,t)?"editor-"+r(e,t):"editor-"+t:"editor-"+r(e,o),void 0===Ember.TEMPLATES[a]&&(a="editor-defaultpropertyeditor"),console.groupEnd(),a}.property("content.type","content.role"),attr:Ember.computed.alias("content")});t.register("component:component-editor",a)}}),Ember.Application.initializer({name:"component-renderer",after:"DebugUtils",initialize:function(e,t){var i=e.lookupFactory("utility:debug"),r=Ember.get,o=Ember.set,n=Ember.isNone,a=Ember.Component.extend({init:function(){var e=r(this,"record"),t=r(this,"attrName");if(!n(t)){if(console.group("Fetch attribute from record"),console.log("record:",e),console.log("attrName:",t),!n(e)){var i=r(e,"constructor.attributes."+t),a=r(e,t);console.log("attr:",i),console.log("value:",a);var s;if(n(i)||(s=r(i,"options.role")),!n(s)){var l="renderer-"+s;n(Ember.TEMPLATES[l])||(console.log("rendererType:",l),o(this,"rendererType",l))}o(this,"attr",i),o(this,"value",a)}console.groupEnd()}this._super.apply(this,arguments)},canopsisConfiguration:canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),actions:{inspect:function(){i.inspectObject(this)},"do":function(e){for(var t=[],i=1,o=arguments.length;o>i;i++)t.push(arguments[i]);r(this,"parentView.controller").send(e,t)}},tagName:"span",attr:function(){for(var e=r(this,"shown_columns"),t=0,i=e.length;i>t;t++)if(e[t].field===r(this,"field"))return e[t]}.property("shown_columns")});t.register("component:component-renderer",a)}}),Ember.Application.initializer({name:"component-wrapper",initialize:function(e,t){var i=Ember.get,r=Ember.set,o=Ember.isNone,n=Ember.Component.extend({tagName:"span",init:function(){this._super(),console.log("init wrapper component"),console.log("wrapper component type",i(this,"editor-type")),r(this,"attr",{model:{options:{}}})},onContentUpdate:function(){var e=i(this,"callback"),t=i(this,"referer");o(t)&&console.warn("Referer not defined in component template. callbacks cannot work"),o(e)?console.log("Callback is not valid : ",e,this):e(i(this,"attr.value"),t)}.observes("attr.value"),editorType:function(){var e=i(this,"editor-type");console.log("editor-type:",e);var t="editor-"+e;return void 0===Ember.TEMPLATES[t]&&(t="editor-defaultpropertyeditor"),t}.property("editor-type")});t.register("component:component-wrapper",n)}}),Ember.Application.initializer({name:"ApplicationController",after:["PartialslotAbleController","UserprofilestatusmenuMixin","RequirejsmocksmanagerMixin","ScreentoolstatusmenuMixin","DocumentationMixin","SchemamanagerMixin","ConsolemanagerMixin","LoadingindicatorMixin","PromisemanagerMixin","NotificationsMixin","FormsUtils","DataUtils","DebugUtils","HashUtils","NotificationUtils","LoginController","RecordinfopopupController"],initialize:function(e,t){var i,r=e.lookupFactory("controller:partialslot-able"),o=e.lookupFactory("mixin:userprofilestatusmenu"),n=e.lookupFactory("mixin:requirejsmocksmanager"),a=e.lookupFactory("mixin:screentoolstatusmenu"),s=e.lookupFactory("mixin:documentation"),l=e.lookupFactory("mixin:schemamanager"),c=e.lookupFactory("mixin:consolemanager"),u=e.lookupFactory("mixin:loadingindicator"),d=e.lookupFactory("mixin:promisemanager"),m=e.lookupFactory("mixin:notifications"),p=e.lookupFactory("utility:forms"),g=e.lookupFactory("utility:data"),f=e.lookupFactory("utility:debug"),h=e.lookupFactory("utility:hash"),v=e.lookupFactory("utility:notification"),b=Ember.get,y=Ember.set,w=Ember.isNone,E=Ember.String.loc,x=Ember.isEmpty,k=Ember.Controller.extend(Ember.Evented,{}),F={needs:["login","recordinfopopup"],partials:{statusbar:[]},editMode:!1,runtimeConfiguration:canopsisConfiguration,debug:Ember.computed.alias("runtimeConfiguration.DEBUG"),defaultView:function(){var e=b(this,"controllers.login.record.defaultview"),t=b(this,"controllers.login.role.defaultview"),i=b(this,"frontendConfig.defaultview");return x(e)?x(t)?i:t:e}.property("frontendConfig.defaultview","controllers.login.defaultview"),enginesviews:[{label:E("Context"),value:"view.context"},{label:E("Selectors"),value:"view.selectors"},{label:E("Event Filter"),value:"view.filters"},{label:E("Performance Data"),value:"view.series"},{label:E("Scheduled Jobs"),value:"view.jobs"},{label:E("Notifications"),value:"view.notifications"},{label:E("Link list"),value:"view.linklist"}],init:function(){console.group("app init"),v.setController(this);var e=b(canopsisConfiguration,"TITLE");w(e)||$("title").html(e),console.groupEnd(),this.refreshPartialsList(),this._super.apply(this,arguments),g.setLoggedUserController(b(this,"controllers.login")),console.groupEnd(),console.tags.remove("init")},editAuthConfig:function(e){console.log("edit "+e);var t=b(this,e);if(w(t))this.send("prompt","Unable to load "+e+" configuration. No edition possible.");else{y(t,"crecord_type",e);var i=p.showNew("modelform",t,{title:E("Edit "+e+" configuration")});i.submit.done(function(){t.save()})}},didSaveView:function(e){this.transitionToRoute("/userview/"+b(e,"id"))},actions:{inspect:function(e){f.inspectObject(e)},editConfig:function(){var e=b(this,"frontendConfig");console.log("editConfig",p,e);var t=p.showNew("modelform",e,{title:E("Edit settings"),inspectedItemType:"frontend"});t.submit.done(function(){e.save()})},editAuthConfiguration:function(e){console.log("edit "+e),this.editAuthConfig(e)},prompt:function(e){p.showNew("confirmform",{},{title:E(e)})},promptReloadApplication:function(e,t){setTimeout(function(){var i=p.showNew("confirmform",{},{title:E(e)});i.submit.then(function(e){w(t)?window.location="/index.html":window.location=t})},1500)},editEventSettings:function(){p.editSchemaRecord("statusmanagement",b(this,"container"))},editDataclean:function(){p.editSchemaRecord("datacleaner",b(this,"container"))},editEnabledPlugins:function(){p.editSchemaRecord("enabledmodules",b(this,"container"))},editTicketJob:function(){console.group("editTicketJob");var e=b(this,"ticketConfig");y(e,"crecord_type","ticket"),console.log("ticketConfig:",e);var t=b(e,"job"),i=b(t,"params");console.log("job:",t,i),i&&console.log("param subject",b(i,"subject"));var r=p.showNew("jobform",t,{scheduled:!1});r.submit.done(function(t){var i=b(t,"formContext"),r=b(i,"params");y(e,"job",i),y(e,"job.params",r),e.save()}),console.groupEnd()},addNewView:function(){var e="userview",t=this;console.log("add",e);var i=h.generateId("container"),r=h.generateId("userview");g.getStore().createRecord("widgetcontainer",{xtype:"widgetcontainer",mixins:[{name:"verticallayout"}],id:i});var o=b(this,"controllers.login.record._id"),n=g.getStore().push(e,{id:r,crecord_type:"view",author:o,containerwidget:i,containerwidgetType:"widgetcontainer"});r.replace(".","_");console.log("temp record",n);var a=p.showNew("modelform",n,{title:E("Add ")+e});a.submit.done(function(){n.save().then(function(){t.didSaveView(n)})})},importView:function(){var e=this;g.uploadTextFilePopup(function(t,i,r,o){o=JSON.parse(o);var n=e.get("store").pushPayload("userview",{userview:o});console.error("done",n,e.get("store").getById("userview",o.id)),e.get("store").getById("userview",o.id).save()})},openTab:function(e){this.transitionToRoute(e)},logout:function(){b(this,"controllers.login").setProperties({authkey:null,errors:[]}),window.location="/logout"}}};i=canopsisConfiguration.DEBUG?r.extend(o,l,d,c,m,u,n,a,s,F):r.extend(o,m,u,s,F),t.register("controller:application",i),t.register("controller:index",k)}}),Ember.Application.initializer({name:"FormController",after:["FormsUtils","DebugUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:forms"),r=e.lookupFactory("utility:debug"),o=Ember.get,n=Ember.set,a=Ember.Controller.extend(Ember.Evented,{mergedProperties:["partials"],_partials:{},refreshPartialsList:function(){console.log("refreshPartialsList",o(this,"partials"));var e=o(this,"partials"),t=o(this,"content.mixins");if(n(this,"_partials",e),Ember.isArray(t))for(var i=0,r=t.length;r>i;i++)e=this.mergeMixinPartials(t[i],e);console.log("set partials for ",this," --> ",e),n(this,"_partials",e)},mergeMixinPartials:function(e,t){if(console.log("mergeMixinPartials mixin:",e),mixinsRegistry.getByName(e.decamelize())){var i=mixinsRegistry.getByName(e.decamelize()).EmberClass.mixins[0].properties.partials;for(var r in i)if(i.hasOwnProperty(r)){var a=i[r],s="_partials."+r;n(this,s,union_arrays(o(this,s),a))}return t}}}),s=a.extend({needs:["application"],init:function(){var e=o(this,"formParent");n(this,"previousForm",e),this._super.apply(this,arguments)},confirmation:!1,submit:$.Deferred(),actions:{previousForm:function(){var e=o(this,"previousForm");console.log("previousForm",e,this),i.showInstance(e)},show:function(){this.submit=$.Deferred()},submit:function(){if(console.log("onsubmit",this.formParent),void 0!==this.formParent)this.formParent.send("submit",arguments);else if(console.log("resolve modelform submit"),this.confirmation){var e=this.formContext;i.showNew("confirmform",e,{title:" confirmation ",newRecord:arguments[0]})}else this.submit.resolve(this,arguments),o(this,"formwrapper").trigger("hide")},abort:function(){void 0!==this.formParent?this.formParent.send("abort",arguments):(console.log("rejecting submit promise"),this.submit.reject())},inspectForm:function(){console.group("inspectForm"),console.log("form:",this),r.inspectObject(o(this,"categorized_attributes")),console.log("categorized_attributes available in $E"),console.groupEnd()}},partials:{buttons:["formbutton-cancel"],debugButtons:["formbutton-inspectform"]},title:function(){return console.warn('Property "title" must be defined on the concrete class.'),"<Untitled form>"}.property()});t.register("controller:form",s)}}),Ember.Application.initializer({name:"FormwrapperController",initialize:function(e,t){var i=Ember.get,r=Ember.Controller.extend(Ember.Evented),o=r.extend({config:canopsisConfiguration,debug:Ember.computed.alias("config.DEBUG"),actions:{show:function(){console.log("FormwrapperController show",this,i(this,"widgetwrapperView")),i(this,"widgetwrapperView").showPopup()}}});t.register("controller:formwrapper",o)}}),Ember.Application.initializer({name:"LoginController",after:"DataUtils",initialize:function(e,t){var i=e.lookupFactory("utility:data"),r=Ember.set,o=Ember.get,n=(Ember.isNone,Ember.ObjectController.extend({content:{},needs:["application"],init:function(){this._super.apply(this,arguments);var e=DS.Store.create({container:o(this,"container")});r(this,"store",e)},authkey:function(){var e=localStorage.cps_authkey;return"undefined"===e&&(e=void 0),e}.property("authkey"),authkeyChanged:function(){localStorage.cps_authkey=o(this,"authkey")}.observes("authkey"),sessionStart:function(){loggedaccountAdapter=i.getEmberApplicationSingleton().__container__.lookup("adapter:loggedaccount"),username=o(this,"record._id"),loggedaccountAdapter.sessionStart(username),setInterval(function(){loggedaccountAdapter.keepAlive(username)},27e4)}}));t.register("controller:login",n)}}),Ember.Application.initializer({name:"PartialslotAbleController",after:"MixinsRegistry",initialize:function(e,t){function i(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]);for(var i={},r=e.length-1;r>=0;--r)i[e[r]]=e[r];for(var o=t.length-1;o>=0;--o)i[t[o]]=t[o];var n=[];for(var a in i)i.hasOwnProperty(a)&&n.push(i[a]);return n}var r=e.lookupFactory("registry:mixins"),o=Ember.get,n=Ember.set,a=Ember.ObjectController.extend({mergedProperties:["partials"],_partials:{},mixinOptions:{},refreshPartialsList:function(){console.log("refreshPartialsList",o(this,"partials"));var e=o(this,"partials");n(this,"_partials",e);var t=o(this,"content.mixins");if(Ember.isArray(t))for(var i=0,r=t.length;r>i;i++){var a=t[i];"string"==typeof a?Ember.deprecate("Defining mixins as strings is deprecated. The new format is : '{ name: \"mixinName\" }'. This is required by the mixin options system."):a=a.name.camelize(),e=this.mergeMixinPartials(a,e)}console.log("set partials for ",this," --> ",e),n(this,"_partials",e)},mergeMixinPartials:function(e,t){var a=e.decamelize(),s=r.getByName(a);if(console.log("mergeMixinPartials mixin:",e),s){var l=s.EmberClass.mixins[0].properties.partials;for(var c in l)if(l.hasOwnProperty(c)){var u=l[c],d="_partials."+c;n(this,d,i(o(this,d),u))}return t}}});t.register("controller:partialslot-able",a)}}),Ember.Application.initializer({name:"PerfdataController",after:["ApplicationController","PojoAdapter","DataUtils"],initialize:function(e,t){var i=(e.lookupFactory("utility:data"),e.lookup("adapter:pojo")),r=e.lookup("controller:application"),o=(Ember.get,Ember.ObjectController.extend({fetch:function(e,t,o){r.addConcurrentLoading("perfdata");var n={metric_id:e,timewindow:JSON.stringify({start:t/1e3,stop:o/1e3,timezone:(new Date).getTimezoneOffset()}),timeserie:JSON.stringify({aggregation:"NONE"})},a=i.createRecord("perfdata",void 0,n);return a.then(function(){r.removeConcurrentLoading("perfdata")},function(){r.removeConcurrentLoading("perfdata")}),a},fetchMany:function(e,t,i){return this.fetch(JSON.stringify(e),t,i)},aggregate:function(e,t,o,n,a){r.addConcurrentLoading("perfdata");var s={metric_id:e,timewindow:JSON.stringify({start:t/1e3,stop:o/1e3,timezone:(new Date).getTimezoneOffset()}),timeserie:JSON.stringify({aggregation:n,period:{second:a/1e3}})},l=i.createRecord("perfdata",void 0,s);return l.then(function(){r.removeConcurrentLoading("perfdata")},function(){r.removeConcurrentLoading("perfdata")}),l},aggregateMany:function(e,t,i,r,o){return this.aggregate(JSON.stringify(e),t,i,r,o)}}));t.register("controller:perfdata",o)}}),Ember.Application.initializer({name:"RecordinfopopupController",initialize:function(e,t){var i=(Ember.get,Ember.set),r=Ember.String.loc,o=Ember.Controller.extend(Ember.Evented),n=o.extend({init:function(){i(this,"title",r("Information")),console.log("initializing recordinfopopup controller")},actions:{show:function(e,t){console.log("Show recordinfopopup",e,t);var r;try{r=Handlebars.compile(t)(e[0].toJson())}catch(o){r="<i>An error occured while compiling the template with the record. please if check the template is correct</i>"}i(this,"content",new Ember.Handlebars.SafeString(r));var n=($(window).width()-$("#recordinfopopup").outerWidth())/2;$("#recordinfopopup").css("left",n),$("#recordinfopopup").fadeIn(500)},hide:function(){console.log("hiding recordinfopopup"),$("#recordinfopopup").fadeOut(500)}}});t.register("controller:recordinfopopup",n)}}),Ember.Application.initializer({name:"SerieController",after:"HashUtils",initialize:function(e,t){var i=e.lookupFactory("utility:hash"),r=window.math,o=Ember.get,n=Ember.set,a=Ember.ObjectController.extend({needs:["perfdata"],perfdata:Ember.computed.alias("controllers.perfdata"),fetch:function(e,t,a){if(o(e,"metrics.length")>1&&"none"===o(e,"aggregate_method")&&(console.group("More than one metric in serie, performing an aggregation"),console.log("serie:",e),console.log("aggregation: average - 60s"),n(e,"aggregate_method","average"),n(e,"aggregate_interval",60),console.groupEnd()),"none"===o(e,"aggregate_method"))var s=o(this,"perfdata").fetchMany(o(e,"metrics"),t,a);else var s=o(this,"perfdata").aggregateMany(o(e,"metrics"),t,a,o(e,"aggregate_method"),o(e,"aggregate_interval"));var l=o(e,"formula");return s.then(function(e){console.group("Computing serie:",l);var t,o=e.total,n=e.data,a={},s=!1;for(t=0;o>t;t++){var c=n[t],u=c.meta.data_id,d="metric_"+i.md5(u),m="/"+u.split("/").slice(4).join("/");l=l.replaceAll(m,d),console.log("metric:",m,d),a[d]=c.points,(!s||c.points.length<s)&&(s=c.points.length)}console.log("formula:",l),console.log("points:",a);var p=Object.keys(a),g=[];for(t=0;s>t;t++){var f,h,v={},b=0;for(f=0,h=p.length;h>f;f++){var d=p[f];v[d]=a[d][t][1],b=a[d][t][0]}r["import"](v);var y=r.eval(l);for(f=0,h=p.length;h>f;f++){var d=p[f];delete r[d]}g.push([1e3*b,y])}return console.log("finalserie:",g),console.groupEnd(),g})}});t.register("controller:serie",a)}}),Ember.Application.initializer({name:"UserviewController",after:["FormsUtils","HashUtils","InspectableItemMixin"],initialize:function(e,t){function i(e){for(var t in e){var r=e[t];("id"===t||"_id"===t||"widgetId"===t||"preference_id"===t)&&delete e[t],"object"==typeof r&&i(r)}return null!==e&&void 0!==e&&(e.id=o.generateId(e.xtype||e.crecord_type||"item"),e._id=e.id),e}var r=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:hash"),n=(window.schemasRegistry,e.lookupFactory("mixin:inspectable-item")),a=Ember.get,s=(Ember.set,Ember.isNone),l=(Ember.String.loc,Ember.ObjectController.extend(n,Ember.Evented,{needs:["application"],actions:{insertWidget:function(e){console.log("insertWidget",e);var t=r.showNew("widgetform",this),i=this;t.submit.done(function(t,r){var o=r[0];console.log("onsubmit, adding widgetwrapper to containerwidget",o,e),console.log("containerwidget items",a(e,"model.items.content")),a(e,"model.items.content").pushObject(o),console.log("saving view"),a(i,"model").save()}),t.submit.fail(function(){console.info("Widget insertion canceled")})},duplicateWidgetAndContent:function(e,t){copyWidget(this,e,t),this.get("model").save()},refreshView:function(){console.log("refresh view"),this.trigger("refreshView")}}}));copyWidget=function(e,t,r){var o=i(t.toJSON());o.widget=null;var n=e.store.createRecord("widgetwrapper",o),a=i(t.get("widget").toJSON()),l=e.store.createRecord(a.xtype,a);if(!s(t.get("widget.items")))for(var c=t.get("widget.items.content"),u=0;u<c.length;u++){var d=c[u];copyWidget(e,d,l)}n.set("widget",l),r.get("items.content").pushObject(n)},t.register("controller:userview",l)}}),Ember.Application.initializer({name:"WidgetController",after:["PartialslotAbleController","WidgetsUtils","RoutesUtils","FormsUtils","DebugUtils","DataUtils","WidgetsRegistry"],initialize:function(e,t){var i=e.lookupFactory("controller:partialslot-able"),r=e.lookupFactory("utility:widgets"),o=e.lookupFactory("utility:routes"),n=e.lookupFactory("utility:forms"),a=e.lookupFactory("utility:debug"),s=e.lookupFactory("utility:data"),l=window.schemasRegistry,c=e.lookupFactory("registry:widgets"),u=Ember.get,d=Ember.set,m=Ember.isNone,p=i.extend({needs:["application","login"],partials:{titlebarsbuttons:["titlebarbutton-duplicate","titlebarbutton-moveup","titlebarbutton-movedown","titlebarbutton-widgeterrors"]},abstractType:"widget",canopsisConfiguration:canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),editMode:Ember.computed.alias("controllers.application.editMode"),config:Ember.computed.alias("content"),init:function(){d(this,"userParams",{}),console.log("widget init");var e=u(r.getParentViewForWidget(this),"content.id"),t=o.getCurrentRouteController().container,i=DS.Store.create({container:t});console.debug("View id for current widget is ",e),this.setProperties({"model.controllerInstance":this,viewId:e,viewController:r.getParentViewForWidget(this),isOnMainView:u(r.getParentViewForWidget(this),"isMainView"),container:t,widgetDataStore:i}),m(this.loadUserConfiguration)||this.loadUserConfiguration(),this._super(),console.debug("user configuration loaded for widget "+u(this,"title")),this.refreshContent()},mixinsOptionsReady:function(){},addMixinView:function(e){var t=u(this,"viewMixins");m(t)&&(t=[],d(this,"viewMixins",t)),t.push(e)},updateInterval:function(e){console.warn("This method should be overriden for current widget",u(this,"id"),e)},stopRefresh:function(){d(this,"isRefreshable",!1)},startRefresh:function(){this.setProperties({isRefreshable:!0,lastRefresh:null})},isRollbackable:function(){return u(this,"isDirty")&&"updated"===u(this,"dirtyType")&&u(this,"rollbackable")===!0?!0:!1}.property("isDirty","dirtyType","rollbackable"),actions:{inspect:function(e){a.inspectObject(e)},"do":function(e){for(var t=[],i=1,r=arguments.length;r>i;i++)t.push(arguments[i]);this.send(e,t)},creationForm:function(e){n.addRecord(e)},rollback:function(e){console.log("rollback changes",arguments),d(e,"volatile",{}),e.rollback(),d(e,"rollbackable",!1)},editWidget:function(e){console.info("edit widget",e);var t=u(e,"title")||"",i=u(e,"xtype")||"",r=n.showNew("modelform",e,{title:__("Edit widget")+" "+i+" "+t});console.log("widgetWizard",r);var o=this;r.submit.done(function(){console.log("record going to be saved",e),u(e,"widgetId")||d(e,"widgetId",u(e,"id"));var t=u(o,"viewController").get("content");t.save().then(function(){u(o,"viewController").send("refresh"),console.log("triggering refresh",t)})})},editMixin:function(e,t){console.info("edit mixin",e,t);var i=u(e,"mixins").findBy("name",t),r=s.getStore().createRecord(t,i),o=n.showNew("modelform",r,{title:__("Edit mixin"),inspectedItemType:t}),a=u(e,"mixins").findBy("name",t);m(a)&&(a=u(e,"mixins").pushObject({name:t})),console.log("mixinObject",a);var c=this;o.submit.done(function(){var e=l.getByName(t).EmberModel,i=u(e,"attributes");console.log("attributes",i),i.forEach(function(e){console.log("each",arguments);var t=u(r,e.name);console.log("mixinObject",a),d(a,e.name,t);var i=u(c,"viewController").get("content");i.save().then(function(){u(c,"viewController").send("refresh"),console.log("triggering refresh",i)})})})},removeWidget:function(e){var t=this,i=n.showNew("confirmform",{},{title:__("Delete this widget ?")});i.submit.then(function(i){console.group("remove widget",e),console.log("parent container",t);for(var r=u(t,"content.items.content"),o=0,n=r.length;n>o;o++)if(console.log(u(t,"content.items.content")[o]),u(r[o],"widget")===e){r.removeAt(o),console.log("deleteRecord ok");break}var a=u(t,"viewController.content");a.save(),console.groupEnd()})},movedown:function(e){console.group("movedown",e);try{console.log("context",this);for(var t,i,r=u(this,"content.items.content"),o=0,n=r.length;n>o;o++)void 0!==t&&void 0===i&&(i=o,console.log("next element found")),r[o]===e&&(t=o,console.log("searched element found"));if(void 0!==t&&void 0!==i){var a=r;console.log("swap objects",a);var s=a.objectAt(t);a.insertAt(t,a.objectAt(i)),a.insertAt(i,s),a.replace(t+2,2),console.log("new array",a),d(this,"content.items.content",a);var l=u(this,"viewController.content");l.save()}}catch(c){console.error(c.stack,c.message)}console.groupEnd()},moveup:function(e){console.group("moveup",e);try{console.log("context",this);for(var t,i,o=u(this,"content.items.content"),n=o.length;n>=0;n--)void 0!==t&&void 0===i&&(i=n,console.log("next element found")),o[n]===e&&(t=n,console.log("searched element found"));if(console.log("indexes to swap",t,i),void 0!==t&&void 0!==i){var a=u(this,"content.items.content");console.log("swap objects",a);var s=a.objectAt(t);a.insertAt(t,a.objectAt(i)),a.insertAt(i,s),a.replace(i+2,2),console.log("new array",a),d(this,"content.items.content",a);var l=u(r.getParentViewForWidget(this),"content");l.save()}}catch(c){console.error(c.stack,c.message)}console.groupEnd()}},itemController:function(){return u(this,"itemType")?u(this,"itemType").capitalize():void 0}.property("itemType"),refreshContent:function(){console.log("refreshContent",u(this,"xtype")),this._super(),this.findItems(),this.setProperties({lastRefresh:(new Date).getTime(),lastRefreshControlDelay:!0})},findItems:function(){console.warn("findItems not implemented",this)},extractItems:function(e){console.log("extractItems",e),this._super(e),d(this,"widgetData",e)},availableTitlebarButtons:function(){var e=u(this,"_partials.titlebarsbuttons");if(void 0===e)return Ember.A();for(var t=Ember.A(),i=0,r=e.length;r>i;i++){var o=e[i];void 0!==Ember.TEMPLATES[o]?t.pushObject(o):console.warn("template not found",o)}return t}.property()});t.reopen({register:function(e,t){if("widget"===e.split(":")[0]){var i=e.split(":")[1],r=i.capitalize()+"Serializer",o=e.split(":")[1];void 0===l.getByName(o);var n=l.getByName(o).EmberModel;if(Ember.Application.initializer({name:r,after:"WidgetSerializer",initialize:function(e,t){var i=e.lookupFactory("serializer:widget");t.register("serializer:"+o,i.extend())}}),m(n))notificationUtils.error("No model found for the widget "+i+". There might be no schema concerning this widget on the database");else{var a=(i.camelize().capitalize(),n.proto().metadata),s=Ember.Object.create({name:i,EmberClass:t});if(!m(a)&&(a.icon&&s.set("icon",a.icon),a.classes))for(var p=a.classes,g=0,f=p.length;f>g;g++){var h=p[g];Ember.isArray(u(c.byClass,h))||d(c.byClass,h,Ember.A()),u(c.byClass,h).pushObject(s)}c.all.pushObject(s)}}return this._super.apply(this,arguments)}}),t.register("controller:widget",p)}}),Ember.Application.initializer({name:"ConfirmForm",after:["FormFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),r={},o=i("confirmform",{partials:{buttons:["formbutton-cancel","formbutton-submit"]},confirmation:!1,actions:{submit:function(){console.log("confirmed !"),this._super()}}},r);t.register("form:confirmform",o)}}),Ember.Application.initializer({name:"ModelForm",after:["FormFactory","InspectableItemMixin","ValidationMixin","SlugUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),r=window.schemasRegistry,o=e.lookupFactory("mixin:inspectable-item"),n=e.lookupFactory("mixin:validation"),a=e.lookupFactory("utility:slug"),s=Ember.set,l=Ember.get,c=Ember.isNone,u={mixins:[o,n]},d=i("modelform",{needs:["application"],partials:{debugButtons:["formbutton-inspectform"]},validationFields:Ember.computed(function(){return Ember.A()}),ArrayFields:Ember.A(),init:function(){this._super(),this.set("partials.buttons",["formbutton-submit"])},filterUserPreferenceCategory:function(e,t){var i=l(e,"keys");s(e,"keys",[]);for(var r=0,o=i.length;o>r;r++)console.log("key",i[r]),this.get("userPreferencesOnly")?i[r].model&&i[r].model.options&&i[r].model.options.isUserPreference&&l(e,"keys").push(i[r]):t[i[r].field]&&(console.log("magic keys",i[r]),t[i[r].field].readOnly&&(i[r].model.options.readOnly=!0),l(e,"keys").push(i[r]));return e},categories:function(){var e=l(this,"categorized_attributes"),t=[];if(e instanceof Array){for(var i=0,r=e.length;r>i;i++){var o=e[i];o.slug=a.slug(o.title),console.log("current category",o),l(this,"filterFieldByKey")||l(this,"userPreferencesOnly")?(this.filterUserPreferenceCategory(o,l(this,"filterFieldByKey")),o.keys.length&&t.push(e[i]),console.log("category"),console.log(o)):t.push(e[i])}return t.length&&s(t[0],"isDefault",!0),t}return[]}.property("categorized_attributes"),onePageDisplay:function(){return!1}.property(),inspectedDataItem:function(){return l(this,"formContext")}.property("formContext"),inspectedItemType:function(){return console.log("recompute inspectedItemType",l(this,"formContext")),l(this,"formContext.xtype")?l(this,"formContext.xtype"):"user"===l(this,"formContext.crecord_type")?"account":l(this,"formContext.crecord_type")||l(this,"formContext.connector_type")}.property("formContext"),actions:{submit:function(){if(void 0===this.validation||this.validation()){console.log("submit action",arguments);var e={};if(this.isOnCreate&&this.modelname){var t=this.modelname.charAt(0).toUpperCase()+this.modelname.slice(1),i=r.getByName(t);if(i)for(var o in i)if(i.hasOwnProperty(o)){var n=i[o];if(n&&n._meta&&n._meta.options){var a=n._meta.options;if("setOnCreate"in a){var u=a.setOnCreate;s(this,"formContext."+o,u)}}}}var d=l(this,"options");if(d&&d.override_labels)for(var m in d.override_labels)d.override_labels.hasOwnProperty(m)&&(e[d.override_labels[m]]=m);var p=l(this,"categorized_attributes");console.log("setting fields");for(var g=0,f=p.length;f>g;g++)for(var h=p[g],v=0,b=h.keys.length;b>v;v++){var y=h.keys[v],w=y.field;if(e[y.field]&&(w=e[y.field]),"mixins"===y.field){var E=[];if(!c(y.value))for(var x=0;x<y.value.length;x++){for(var k=Ember.keys(y.value[x]),F={},z=0;z<k.length;z++)F[k[z]]=y.value[x][k[z]];window.$M=F,E.push(F)}Ember.set(y,"value",E)}s(this,"formContext."+w,y.value)}console.log("this is a widget",l(this,"formContext"));var C=[l(this,"formContext")];C.addObjects(arguments),this._super.apply(this,C)}}}},u);t.register("form:modelform",d)}}),Ember.Application.initializer({name:"ViewTreeForm",after:["FormFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),r={},o=i("viewtreeform",{partials:{buttons:["formbutton-submit"],debugButtons:["formbutton-inspectform"]}},r);t.register("form:viewtree",o)}}),Ember.Application.initializer({name:"WidgetForm",after:["FormFactory","WidgetsRegistry","FormsUtils","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),r=e.lookupFactory("registry:widgets"),o=e.lookupFactory("utility:forms"),n=e.lookupFactory("utility:hash"),a=Ember.get,s=(Ember.set,i("widgetform",{needs:["application"],title:"Select a widget",widgets:r,availableWidgets:function(){console.log("availableWidgets");for(var e=[],t=0,i=e.all.length;i>t;t++){var r=e.all[t];e.pushObject(r)}return e}.property("widgets.all","title"),actions:{submit:function(e){var t=e[0];console.log("onWidgetChooserSubmit",arguments),console.group("attach new widget to widgetwrapper"),console.log("newWidget",t),console.log("widgetwrapper",this.newWidgetWrapper),console.groupEnd(),this._super(this.newWidgetWrapper)},selectItem:function(e){console.log("selectItem",arguments);var t=a(this,"formContext.containerwidget");console.group("selectWidget",this,t,e);var i=a(this,"formContext.containerwidget").store;console.log("store to use",a(this,"formContext.containerwidget").store);var r=n.generateId("widget_"+e),s=i.createRecord(e,{xtype:e,listed_crecord_type:"account",meta:{embeddedRecord:!0,parentType:"widgetwrapper"},id:r});this.newWidgetWrapper=i.push("widgetwrapper",{id:n.generateId("widgetwrapper"),xtype:"widgetwrapper",title:"wrapper",widget:s,meta:{embeddedRecord:!0,parentType:a(t,"xtype"),parentId:a(t,"id")}}),console.log("newWidgetWrapper",this.newWidgetWrapper),console.log("newWidget",s),console.log("formwrapper",a(this,"formwrapper")),console.info("show embedded widget wizard"),o.showNew("modelform",s,{formParent:this,title:"Add new "+e}),console.groupEnd()}},partials:{buttons:[]},parentContainerWidget:Ember.required(),parentUserview:Ember.required()}));t.register("form:widgetform",s)}}),Ember.Application.initializer({name:"AbstractClassRegistry",initialize:function(e,t){var i=Ember.get,r=Ember.set,o=Ember.isNone;isArray=Ember.isArray;var n=Ember.Object.extend({name:"unnamed registry",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}],add:function(e,t,n){if(o(t)?t=i(e,"name"):r(e,"name",t),o(n)?n=i(e,"classes"):r(e,"classes",n),console.log("registering item",i(e,"name"),"into registry",t,"with classes",n),this.all.pushObject(e),isArray(n))for(var a=0,s=n.length;s>a;a++)o(this.byClass[n[a]])&&(this.byClass[n[a]]=Ember.A()),this.byClass[n[a]].pushObject(e)},getByName:function(e){for(var t=0,r=this.all.length;r>t;t++)if(i(this.all[t],"name")===e)return this.all[t]},getByClassName:function(e){return i(this.byClass,e)}});t.register("registry:abstractclass",n)}}),Ember.Application.initializer({name:"ActionsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"actions",all:[{name:"gotoEventView",
actionData:["showView","view.event"]},{name:"toggleEditMode",actionData:["toggleEditMode"]},{name:"promptReloadApplication",actionData:["promptReloadApplication"]},{name:"showUserProfile",actionData:["showUserProfile"]},{name:"editConfig",actionData:["editConfig"]},{name:"addNewView",actionData:["addNewView"]},{name:"logout",actionData:["logout"]},{name:"refresh",actionData:["refresh"]},{name:"toggleFullscreen",actionData:["toggleFullscreen"]},{name:"toggleDevTools",actionData:["toggleDevTools"]}],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:actions",r)}}),Ember.Application.initializer({name:"ContextRegistry",after:"AbstractClassRegistry",initialize:function(e,t){for(var i=e.lookupFactory("registry:abstractclass"),r=[{name:"component",modelName:"ctxcomponent"},{name:"resource",modelName:"ctxresource"},{name:"selector",modelName:"ctxselector"},{name:"topology",modelName:"ctxtopology"}],o=i.create({name:"contexts",all:[],byClass:{},tableColumns:[{title:"name",name:"name"},{title:"modelName",name:"modelName"}]}),n=0,a=r.length;a>n;n++)o.all.pushObject({name:r[n].name,modelName:r[n].modelName});t.register("registry:context",o)}}),Ember.Application.initializer({name:"EditorsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"editors",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:editors",r)}}),Ember.Application.initializer({name:"FormFactory",after:"FormController",initialize:function(e,t){function i(e,t,i){console.tags.add("factory"),console.group("form factory call",arguments);var n=[];if(void 0===i&&(i={}),void 0===i.subclass&&(i.subclass=r),void 0!==i.mixins)for(var a=0,s=i.mixins.length;s>a;a++)n.push(i.mixins[a]);o(t,"formName",e),n.push(t),Ember.assert("formName must be a string","string"==typeof e);var l=e.dasherize();e.dasherize();console.log("extendArguments",n),console.log("subclass",i.subclass);var c=i.subclass.extend.apply(i.subclass,n),u=l.capitalize()+"Controller";return Ember.Application.initializer({name:u,after:"FormsRegistry",initialize:function(t,i){var r=t.lookupFactory("registry:forms");r.all[e]={EmberClass:c},i.register("controller:"+l,c)}}),console.groupEnd(),console.tags.remove("factory"),c}var r=e.lookupFactory("controller:form"),o=(Ember.get,Ember.set);t.register("factory:form",i)}}),Ember.Application.initializer({name:"MixinFactory",after:"MixinsRegistry",initialize:function(e,t){function i(e,t){console.tags.add("factory"),console.group("mixin factory call",arguments);var i=(e.camelize().capitalize()+"Mixin",Ember.Mixin.create(t)),o=Ember.Object.create({name:e,EmberClass:i});return r.all.push(o),console.groupEnd(),console.tags.remove("factory"),i}var r=(Ember.get,Ember.set,Ember.isNone,e.lookupFactory("registry:mixins"));t.register("factory:mixin",i)}}),Ember.Application.initializer({name:"WidgetFactory",after:["WidgetsRegistry","WidgetController","NotificationUtils","SchemasLoader"],initialize:function(e,t){function i(e,t,i){var o=[];if(void 0===i&&(i={}),void 0===i.subclass&&(i.subclass=r),void 0!==i.mixins)for(var n=0,a=i.mixins.length;a>n;n++)o.push(i.mixins[n]);o.push(t);var s=r.extend.apply(r,o);return s}var r=(e.lookupFactory("registry:widgets"),window.schemasRegistry,e.lookupFactory("controller:widget"));e.lookupFactory("utility:notification"),Ember.get,Ember.set,Ember.isNone;t.register("factory:widget",i)}}),Ember.Application.initializer({name:"FormsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"forms",formwrapper:void 0,tableColumns:[{title:"name",name:"name"}]});t.register("registry:forms",r)}}),function(){Ember.Handlebars.registerHelper("eachIndexed",function(e,t){function i(){var e=arguments[1].data.keywords,t=arguments[1].data.view,i=t.contentIndex,o=t._parentView.get("content")||[],n=o.length;return e.index=i,e.index_1=i+1,e.first=0===i,e.last=i+1===n,e.even=i%2===0,e.odd=!e.even,arguments[1].data.keywords=e,r.apply(this,arguments)}var r,o="item";return 4===arguments.length&&(Ember.assert("If you pass more than one argument to the eachIndexed helper, it must be in the form #eachIndexed foo in bar","in"===arguments[1]),Ember.assert(arguments[0]+" is a reserved word in #eachIndexed",$.inArray(arguments[0],["index","index+1","even","odd"])),o=arguments[0],t=arguments[3],e=arguments[2],t.hash.keyword=o,""===e&&(e="this")),1===arguments.length&&(t=e,e="this"),r=t.fn,t.fn=i,t.hash.dataSourceBinding=e,!t.data.insideGroup||t.hash.groupedRows||t.hash.itemViewClass?Ember.Handlebars.helpers.collection.call(this,"Ember.Handlebars.EachView",t):void new Ember.Handlebars.GroupedEach(this,e,t).render()})}(),Ember.Handlebars.helper("formview",Ember.View),function(){var e=Ember.get;Ember.Handlebars.helper("getfield",function(t,i){var r=e(t,i)||"";return new Ember.Handlebars.SafeString(r)})}(),function(){Ember.Handlebars.helper("tr",function(e){var t;return e?(t=Ember.String.loc(e),console.log("translating",e,"into",t),t):void 0})}(),function(){var e=Ember.get,t=Ember.isNone;Ember.Handlebars.registerBoundHelper("clog",function(i,r){console.tags.add("helper");var o=e(this,"model.type.typeKey");t(o)||console.tags.add(o);var n=e(r,"hash.level");return t(n)&&(n="log"),console[n](i),console.tags.remove("helper"),t(o)||console.tags.remove(o),""})}(),Ember.Handlebars.registerBoundHelper("renderWidget",function(e,t,i){return Ember.Handlebars.helpers.render.call(e,t.get("widget_type"),"widget",i)}),Ember.Application.initializer({name:"IndexesRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"indexes"});r.add(Ember.Object.create({name:"event",tree:{component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource","final":!0}}},connector:{_metas:{name:"connector"},component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource","final":!0}}}}}})),r.add(Ember.Object.create({name:"crecord",tree:{crecord_type:{_metas:{name:"Crecord type"},crecord_name:{_metas:{name:"Crecord name","final":!0}}}}})),t.register("registry:indexes",r)}}),Ember.Application.initializer({name:"InflexionsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=[["nagios","nagios"],["tcp2canopsis","tcp2canopsis"],["curve","curves"],["serie","serie"],["enabledmodules","enabledmodules"],["calendardata","calendardata"],["eventcategories","eventcategories"]],o=i.create({name:"InflectionsRegistry",all:[],byClass:{},tableColumns:[{title:"name",name:"name"},{title:"Singular",name:"singular"},{title:"Plural",name:"plural"}],loadInflections:function(){for(var e=0,t=r.length;t>e;e++)o.all.pushObject({name:r[e][0]+" -> "+r[e][1],singular:r[e][0],plural:r[e][1]}),Ember.Inflector.inflector.irregular(r[e][0],r[e][1])}});t.register("registry:inflexions",o)}}),Ember.Application.initializer({name:"MixinsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"mixins",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:mixins",r)}}),Ember.Application.initializer({name:"PromisesRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=Ember.get,o=Ember.set,n=i.create({name:"promises",all:[],pending:Ember.A(),errors:Ember.A(),pendingCount:0,errorsCount:0,byClass:{},handlePromise:function(e){var t=this;Ember.run.schedule("sync",this,function(){t.all.pushObject(e),t.pending.pushObject(e),o(t,"pendingCount",t.pendingCount+1)})},promiseSuccess:function(e){console.info("promise success",e)},promiseFail:function(e){if(void 0!==e._detail&&200===e._detail.status)console.warn("promise failed with error code 200, assuming it's a success"),this.promiseSuccess(e);else{console.error("promise failed",e,(new Error).stack);var t=this;Ember.run.schedule("sync",this,function(){console.error("promise failed",e),r(t,"errors").pushObject(e),o(t,"errorsCount",t.errorsCount+1)})}},promiseFinally:function(e){var t=this;Ember.run.schedule("sync",this,function(){console.log("finally"),r(t,"pending").removeObject(e),o(t,"pendingCount",t.pendingCount-1)})}});t.register("registry:promises",n)}}),Ember.Application.initializer({name:"RenderersRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"renderers",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:renderers",r)}}),Ember.Application.initializer({name:"MocksRegistry",after:"FormsUtils",initialize:function(e,t){var i=e.lookupFactory("utility:forms"),r=Ember.set,o=Ember.Object.extend({init:function(){this._super(),this.feedMocks()},feedMocks:function(){var e=localStorage.getItem("files_mocks"),t=Ember.A();try{if(e=JSON.parse(e))for(var i in e)e[i].modulePath=i,t.push(e[i])}catch(o){console.error("Impossible to parse mocks JSON.")}r(this,"mocks",t)},editMock:function(e){var t=this,r=i.showNew("modelform",e,{title:__("Edit mock")+" "+e.modulePath,inspectedItemType:"requirejsmock"});r.submit.then(function(i){var r=localStorage.getItem("files_mocks");try{r=JSON.parse(r);var o=e.modulePath;delete e.modulePath,e.module=e.module,r[o]=e,localStorage.setItem("files_mocks",JSON.stringify(r))}catch(n){console.error("Impossible to parse mocks JSON.")}t.feedMocks()})},addMock:function(){var e=this,t={modulePath:"",module:"",requirements:[]},r=i.showNew("modelform",t,{title:__("Add mock"),inspectedItemType:"requirejsmock"});r.submit.then(function(i){var r=localStorage.getItem("files_mocks");try{r=JSON.parse(r);var o=t.modulePath;delete t.modulePath,t.module=t.module,r[o]=t,localStorage.setItem("files_mocks",JSON.stringify(r))}catch(n){console.error("Impossible to parse mocks JSON.")}e.feedMocks()})},deleteMock:function(e){var t=localStorage.getItem("files_mocks");try{t=JSON.parse(t),delete t[e],localStorage.setItem("files_mocks",JSON.stringify(t))}catch(i){console.error("Impossible to parse mocks JSON.")}this.feedMocks()}}),n=o.create();t.register("registry:mocks",n)}}),Ember.Application.initializer({name:"SearchmethodsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){for(var i=e.lookupFactory("registry:abstractclass"),r=[{name:"simple",filter:function(e,t){var i=(t.propertyToCheck,t.searchCriterion),r=e.filter(function(e,t,r){var o=e.name.slice(0,i.length)==i;return o});return console.log("##",r),r}}],o=i.create({name:"searchMethods",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]}),n=0,a=r.length;a>n;n++)o.all.pushObject(r[n]);t.register("registry:searchmethods",o)}}),Ember.Application.initializer({name:"TemplatesRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"templates",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:templates",r)}}),Ember.Application.initializer({name:"UtilityClass",initialize:function(e,t){var i=(Ember.set,Ember.get),r=Ember.Object.extend({init:function(){this._super(),console.log("Registering utility object "+i(this,"name"))}});t.register("class:utility",r)}}),Ember.Application.initializer({name:"ActionsUtils",after:"UtilityClass",initialize:function(e,t){var i,r=e.lookupFactory("class:utility"),o=r.create({name:"actions",setDefaultTarget:function(e){i=e},doAction:function(e,t){console.info("doAction",i,e,t),Ember.assert("The actionsDefaultTarget variable is none",!Ember.isNone(i)),i.send.apply(i,[e,t])}});t.register("utility:actions",o)}}),Ember.Application.initializer({name:"DataUtils",after:["UtilityClass","HashUtils"],initialize:function(e,t){var i,r,o=e.lookupFactory("class:utility"),n=e.lookupFactory("utility:hash"),a=o.create({name:"data",getLoggedUserController:function(){return i},setLoggedUserController:function(e){i=e},getEmberApplicationSingleton:function(){return r},setEmberApplicationSingleton:function(e){r=e},getStore:function(){return console.warn("this should not be used as there is not only one store in Canopsis. This might lead to unexpected behaviour"),this.getEmberApplicationSingleton().__container__.lookup("store:main")},addRecordToRelationship:function(e,t,i,r){console.log("addRecordToRelationship",arguments),"hasMany"===r?(console.log("addRecordToRelationship hasMany",i,arguments,t),t.get(i).pushObject(e)):"belongsTo"===r&&(console.log("addRecordToRelationship belongsTo",i,arguments,t),t.set(i,e))},download:function(e,t,i){i||(i="application/octet-stream");var r=document.createElement("a"),o=new Blob([e],{type:i});r.href=window.URL.createObjectURL(o),r.download=t,r.click()},uploadFilePopup:function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t=$(document.createElement("input"));t.attr("type","file"),t.trigger("click"),t.change(function(){"function"==typeof e&&e(this)})}else alert("The File APIs are not fully supported by your browser.")},uploadTextFilePopup:function(e){this.uploadFilePopup(function(t){var i=t.files[0];if(i){var r=new FileReader;r.onload=function(t){var r=t.target.result;"function"==typeof e&&e(i.name,i.type,i.size,r)},r.readAsText(i)}else alert("Failed to load file")})},cleanJSONIds:function(e){for(var t in e){var i=e[t];("id"===t||"_id"===t||"widgetId"===t||"preference_id"===t||"EmberClass"===t)&&delete e[t],"object"==typeof i&&this.cleanJSONIds(i)}return null===e||void 0===e||void 0===e.crecord_type&&void 0===e.xtype||(e.id=n.generateId(e.xtype||e.crecord_type||"item"),e._id=e.id),e}});t.register("utility:data",a)}}),Ember.Application.initializer({name:"DatesUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=Ember.String.loc,o=Ember.isNone,n=i.create({name:"dates",getNow:function(){return parseInt((new Date).getTime()/1e3)},getStringNow:function(e,t){return n.timestamp2String(n.getNow(),e,t)},durationFromNow:function(e){var t=n.getNow()-e;return n.second2Duration(t)},second2Duration:function(e){var t=parseInt(e/86400),i=parseInt(e/3600)%24,r=parseInt(e/60)%60,o=parseInt(e%60),n="";i&&(n=(10>i?"0"+i:i)+"h ");var a="";r&&(a=(10>r?"0"+r:r)+"m ");var s=n+a+(10>o?"0"+o:o)+"s";return isNaN(t)||0===t||(s=t+"d "+s),s},timestamp2String:function(e,t,i){function o(e){return 10>e?"0"+e:e.toString()}var n=new Date(1e3*e),a=[r("January"),r("February"),r("March"),r("April"),r("May"),r("June"),r("July"),r("August"),r("September"),r("October"),r("November"),r("December")];i===!0&&(a=[r("Jan"),r("Feb"),r("Mar"),r("Apr"),r("May"),r("June"),r("July"),r("Aug"),r("Sep"),r("Oct"),r("Nov"),r("Dec")]);var s=n.getFullYear(),l=a[n.getMonth()],c=o(n.getDate()),u=o(n.getHours()),d=o(n.getMinutes()),m=o(n.getSeconds()),p="";switch(t){case"f":p=[c,l,s].join(" ")+" "+[u,d,m].join(":");break;case"r":p=[c,o(n.getMonth()),s].join("/")+" <br>"+[u,d,m].join(":");break;case"timeOnly":p=[u,d,m].join(":");break;default:p=[c,l,s].join(" ")+" "+[u,d,m].join(":")}return p},locale:"fr",months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Monday","Thuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],setLang:function(e){n.locale=e,"fr"===e&&(n.month=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Octobre","Novembre","Décembre"],n.days=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"])},startOfTheDay:function(e){o(e)&&(e=n.getNow(),console.log("got date from now as no param given",e)),e*=1e3;var t=new Date(e);return t.setHours(0,0,0,0),parseInt(t.getTime()/1e3)},isToday:function(e){var t=n.startOfTheDay(e);return n.getNow()<t+86400},dateFormat:"YYYY/MM/DD",diffDate:function(e,t,i){switch(div=1,i){case"s":div=1e3;break;case"m":div=6e4;break;case"h":div=36e5;break;case"d":div=864e5}var r=t-e;return Math.ceil(r/div)}});t.register("utility:dates",n)}}),Ember.Application.initializer({name:"DebugUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=Ember.set,o=i.create({name:"debug",inspectObject:function(e){window.$E=e,r(this,"inspectedObject",e),console.info("--- inspect object :",this.inspectedObject)},getViewFromJqueryElement:function(e,t){return t?Ember.View.views[e.closest(".ember-view ."+t).attr("id")]:Ember.View.views[e.closest(".ember-view").attr("id")]}});t.register("utility:debug",o)}}),Ember.Application.initializer({name:"DragUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=(Ember.String.loc,Ember.isNone,i.create({name:"drag",setDraggable:function(e,t){e.on("mousedown",function(){console.log("mousedown",$(this)),t.addClass("draggable").parents().on("mousemove",function(e){$(".draggable").offset({top:e.pageY-50,left:e.pageX-$(".draggable").outerWidth()/2}).on("mouseup",function(){t.removeClass("draggable")})})})}}));t.register("utility:drag",r)}}),Ember.Application.initializer({name:"EventUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=Ember.get,o=Ember.set,n=(Ember.String.loc,Ember.isNone,i.create({name:"event",getFields:function(){return["connector","connector_name","component","resource","perimeter","domain","state","status","timestamp","output"]},applyVolatileFilter:function(e,t,i){e.promise.then(function(e){var n=r(e,"controller.content.containerwidget");n=r(n,"_data.items")[0],n=r(n,"widget"),console.log(n),""!==i&&(r(n,"volatile")||o(n,"volatile",{}),o(n,"volatile.forced_filter",i),o(n,"rollbackable",!0),o(n,"title",t.title))})}}));t.register("utility:event",n)}}),Ember.Application.initializer({name:"FormsUtils",after:["UtilityClass","FormsRegistry","RoutesUtils","DataUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=e.lookupFactory("utility:routes"),o=e.lookupFactory("utility:data"),n=e.lookupFactory("registry:forms"),a=Ember.get,s=Ember.set,l=Ember.String.loc,c=i.create({name:"forms",instantiateForm:function(t,i,n){this.formController&&this.formController.destroy(),console.log("try to instantiate form",t,n.formParent);var a=n;n.formName=t,a.target=r.getCurrentRouteController(),a.container=o.getEmberApplicationSingleton().__container__,void 0===e.lookupFactory("form:"+t)&&console.error("the form",t,"was not found");var s=e.lookupFactory("form:"+t).create(a);return s.refreshPartialsList(),this.formController=s,s},showInstance:function(e){e.empty_validationFields(),s(n.formwrapper,"form.validateOnInsert",!1),s(n.formwrapper,"form",e),s(n.formwrapper,"formName",e.formName)},showNew:function(e,t,i){void 0===i&&(i={}),(Ember.isNone(t)||Ember.isNone(a(t,"crecord_type")))&&console.warn("There is no crecord_type in the given record. Form may not display properly."),console.log("Form generation",e);var o=this.instantiateForm(e,t,i);return console.log("formController",o),r.getCurrentRouteController().send("showEditFormWithController",o,t,i),o},editRecord:function(e,t){var i=this.showNew("modelform",e);return console.log("widgetWizard",i),i.submit.then(function(){console.log("record saved");var r=e.save();isNone(t)||r.then(t),i.trigger("hidePopup"),i.destroy()}),i},editSchemaRecord:function(e,t,i){var r=this,o=DS.Store.create({container:t});o.findQuery(e,{}).then(function(t){console.log("queryResults",t);var o=a(t,"content")[0],n=[e," ",l("information not registered in database.")," ",l("Please contact your administrator.")].join("");o?r.editRecord(o,i):r.error(n)})},addRecord:function(e){r.getCurrentRouteController().send("show_add_crecord_form",e)}});t.register("utility:forms",c)}}),Ember.Application.initializer({name:"HashUtils",after:["UtilityClass","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=window.Hashes,o=i.create({generate_GUID:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e();return t},generateId:function(e){var t=o.generate_GUID();return Ember.isNone(e)||(t=e+"_"+t),t},md5:function(e){var t=new r.MD5;return t.hex(e)},sha1:function(e){var t=new r.SHA1;return t.hex(e)}});t.register("utility:hash",o)}}),Ember.Application.initializer({name:"IndexesUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=(window.canopsisConfiguration,i.create({name:"indexes",cache:{},load:function(e){return $.ajax({url:"/rest/indexes/"+e,success:function(t){r.cache[e]=t.indexes},async:!1}),this.cache[e]},parse:function(e){},get:function(e){return console.log(this),Ember.isNone(this.cache[e])&&this.load(e),this.cache[e]},getAsList:function(e){var t=this.get(e);indexesList=[];for(var i in t)indexesList.push(t[i].key);return indexesList},getIndexWithField:function(e,t){for(var i=this.getAsList(e),r=[],o=0,n=i.length;n>o;o++)console.log("searching "+i[o][0][0]+" in",t),-1!==$.inArray(i[o][0][0],t)&&r.push(i[o]);return r}}));t.register("utility:indexes",r)}}),Ember.Application.initializer({name:"ModelsolveUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=i.create({name:"modelsolve",gen_resolve:function(e){return function(t){for(var i=0;i<t.data.length;i++);t.success===!1&&t.data.msg&&(console.error("Server Error",t.data.msg,t.data.type),console.error(t.data.traceback)),Ember.run(null,e,t)}},gen_reject:function(e){return function(t){t.then=null,Ember.run(null,e,t)}}});t.register("utility:modelsolve",r)}}),Ember.Application.initializer({name:"NotificationUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility");targetcontroller={temp_buffer:[],createNotification:function(e,t){this.temp_buffer.push({notificationType:e,notificationMessage:t})}};var r=i.create({name:"notification",setController:function(e){},info:function(e){},warning:function(e){},error:function(e){},help:function(){console.log("usage is: utils.notification.notificate('info'|'warning'|'error', 'my message');")}});t.register("utility:notification",r)}}),Ember.Application.initializer({name:"RoutesUtils",after:["UtilityClass","DataUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=e.lookupFactory("utility:data"),o=i.create({name:"routes",getCurrentRouteController:function(){var e=r.getEmberApplicationSingleton().__container__.lookup("router:main").router.currentHandlerInfos,t=e[e.length-1].handler.controller;return console.log("currentHandlers",e),console.log("currentRouteController",t),t},getCurrentViewId:function(){return r.getEmberApplicationSingleton().__container__.lookup("router:main").router.currentHandlerInfos[1].params.userview_id}});t.register("utility:routes",o)}}),Ember.Application.initializer({name:"SlugUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=i.create({name:"slug",slug:function(e){for(var t=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}],i=0,r=t.length;r>i;i++)e=e.replace(t[i].re,t[i].ch);return e=e.toLowerCase(),e=e.replace(/\s+/g,"-"),e=e.replace(/[^a-z0-9-]/g,""),e=e.replace(/\-{2,}/g,"-")}});t.register("utility:slug",r)}}),Ember.Application.initializer({name:"TimeWindowUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=Ember.get,o=Ember.isNone,n=i.create({default_timewindow:86400,default_timewindow_offset:0,getFromTo:function(e,t){var i=(new Date).getTime();o(e)&&(e=r(this,"default_timewindow")),o(t)&&(t=r(this,"default_timewindow_offset")),e*=1e3,t*=1e3;var n=i-t-e,a=i-t;return[n,a]}});t.register("utility:timewindow",n)}}),Ember.Application.initializer({name:"ValuesUtils",after:["UtilityClass","DatesUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=e.lookupFactory("utility:dates"),o=[" "," k"," M"," G"," T"],n=i.create({name:"values",humanize:function(e,t){if("s"===t.toLowerCase())return r.second2Duration(e);var i=1e3,n=0>e;n&&(e=-e),("o"===t||"o/s"===t)&&(i=1024);for(var a=0,s=parseInt(e/i);s>0;)e=s,s=parseInt(e/i),a++;return n?"-"+e+o[a]+t:e+o[a]+t},castValue:function(e,t){t=t.toLowerCase();var i=["string","boolean","number","array"];if(-1===i.indexOf(t))return console.warn("type",t,"not recognized. Expected one of",i.join(",")),e;if("string"===t)return e+"";if("number"===t){try{e=parseFloat(e)}catch(r){console.warn("unable to case to number value",e)}return isNaN(e)?0:e}if("boolean"===t){try{if("true"===e)return!0;if("false"===e)return!1;e=!!e}catch(r){console.warn("unable to case to boolean value",e)}return e}if("array"===t){try{e=e.split(",")}catch(r){console.warn("unable to case to array value",e)}return e}}});t.register("utility:values",n)}}),Ember.Application.initializer({name:"WidgetSelectorsUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=Ember.get,o=(Ember.set,Ember.isNone),n=i.create({name:"widgetSelector",toTree:function(e){if(o(e))return console.warn("Widget is undefined in widget selector toTree"),{};var t={};console.log("enter tree for widget",e.get("id"));for(var i=n.directChildren(e),r=[],a=i.length,s=0,l=a;l>s;s++)console.log("iterating over widget ",i[s].get("id")),r.push(n.toTree(i[s]));return t[e.get("id")]={children:r,widget:e},console.log("will return sub tree",t),t},directChildren:function(e){if(Ember.isNone(e))return console.warn("Widget is undefined in widget selector direct children"),[];console.log("in direct children");var t=r(e,"items.content"),i=[];if(!Ember.isNone(t))for(var o=t.length,n=0;o>n;n++)i.push(r(t[n],"widget"));return i},children:function(e){if(Ember.isNone(e))return console.warn("Widget is undefined in widget selector in children"),[];for(var t=[],i=n.directChildren(e),r=i.length,o=0;r>o;o++){console.log("iterating over widget ",o);for(var a=n.children(i[o]),s=a.length,l=0,c=s;c>l;l++)console.log("iterating over sub children",l),t.push(a[l]);t.push(i[o])}return t},filter:function(e,t){if(Ember.isNone(e))return console.warn("Widget is undefined in widget selector in filter"),[];if(Ember.isNone(t))return console.warn("Filter is undefined in widget selector in filter"),[];var i=[];t.directChilrenOnly?(i=n.directChildren(e),console.log("directChilrenOnly",i)):(i=n.children(e),console.log("not directChilrenOnly",i));var o={},a=[];if(t.keyEquals)for(var s in t.keyEquals){console.log("checking if key",s,"is in widget");for(var l=0,c=i.length;c>l;l++)i[l].get(s)===t.keyEquals[s]&&Ember.isNone(o[r(i[l],"id")])&&(a.push(i[l]),o[r(i[l],"id")]=!0)}return a}});t.register("utility:widget-selectors",n)}}),Ember.Application.initializer({name:"WidgetsUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),r=Ember.get,o=i.create({name:"widgetsUtils",getParentViewForWidget:function(e){for(var t=e;"view"!==r(t,"crecord_type");)t=r(t,"target");return t}});t.register("utility:widgets",o)}}),Ember.Application.initializer({name:"WidgetsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),r=i.create({name:"widgets",all:[],byClass:{},tableColumns:[{title:"icon",name:"icon"},{title:"name",name:"name"}]});t.register("registry:widgets",r)}});var deps=[];isIE||deps.push("canopsis/core/externals/console.js/console"),define(deps,function(){if(conf=canopsisConfiguration,delete console.init,isIE){if(conf.DEBUG){var e=console;console={log:function(){var t="";try{for(var i=[],r=0;r<arguments.length;r++)i.push(arguments[r]);var o=JSON.stringify(i);e.log.apply(e,[t,o])}catch(n){Array.prototype.unshift.call(arguments,[" > unable to serialize next message"]),Array.prototype.unshift.call(arguments,t)}},tags:{add:function(){},remove:function(){}},group:function(){},groupEnd:function(){},warn:function(){},debug:function(){},info:function(){},error:function(){}}}}else console.group("init"),console.tags.add("init");return console.debug=console.log,console}),Ember.Application.initializer({name:"ConsolemanagerMixin",after:["MixinFactory","FormsUtils","DataUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:data"),n=(Ember.get,Ember.set,Ember.String.loc),a=i("consolemanager",{init:function(){this.partials.statusbar.pushObject("consolemanagerstatusmenu"),this._super()},actions:{showConsoleSettings:function(){var e=o.getStore().createRecord("jsruntimeconfiguration",{id:0,selected_tags:window.console.tags._selectedTags,colors:window.console.style._colors}),t=r.showNew("modelform",e,{title:n("Edit JS runtime configuration"),inspectedItemType:"jsruntimeconfiguration"});console.log("editForm deferred",t.submit),t.submit.done(function(){console.log("jsruntimeconfigrecord saved",e)}),t.submit.always(function(){console.log("jsruntimeconfigrecord always",e),window.console.tags._selectedTags=e.get("selected_tags"),window.console.style._colors=e.get("colors"),window.console.settings.save(),e.unloadRecord()})}},verbosity_mode:function(){return n("custom")}.property()});t.register("mixin:consolemanager",a)}}),Ember.Application.initializer({name:"CriticitylevelsMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=Ember.get,o=Ember.set,n=Ember.isNone,a=i("criticitylevels",{init:function(){var e=r(this,"content.mixins");if(e){var t=r(this,"content.mixins").findBy("name","criticitylevels");this.mixinOptions.criticitylevels=t}this._super(),o(this,"warn_value",r(this,"mixinOptions.criticitylevels.warn_value")),o(this,"crit_value",r(this,"mixinOptions.criticitylevels.crit_value")),o(this,"unit_or_percent",r(this,"mixinOptions.criticitylevels.unit_or_percent")),o(this,"standard_color",r(this,"mixinOptions.criticitylevels.standard_color")),o(this,"warn_color",r(this,"mixinOptions.criticitylevels.warn_color")),o(this,"critic_color",r(this,"mixinOptions.criticitylevels.critic_color")),n(r(this,"background_color"))&&o(this,"background_color","#3c8dbc"),n(r(this,"warn_color"))&&o(this,"warn_color","#f39c12"),n(r(this,"critic_color"))&&o(this,"critic_color","#f56954")}});t.register("mixin:criticitylevels",a)}}),Ember.Application.initializer({name:"DocumentationMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=i("Documentation",{init:function(){this.partials.statusbar.pushObject("documentation"),this._super()}});t.register("mixin:documentation",r)}}),Ember.Application.initializer({name:"EmbeddedRecordSerializerMixin",after:["MixinFactory","DataUtils","HashUtils"],initialize:function(e,t){function i(e){return e=e.decamelize()}var r=e.lookupFactory("factory:mixin"),o=window.schemasRegistry,n=e.lookupFactory("utility:hash"),a=e.lookupFactory("utility:data"),s=Ember.isNone,l=(Ember.get,r("embeddedRecordSerializer",{sideloadItem:function(e,t,i,r){try{if(console.log("sideLoad",t,i.xtype),console.log("payload before sideLoad",e),void 0===o.getByName(i.xtype).EmberModel)return void console.error(e,"bad xtype for widget :"+i.xtype);var a=i.xtype.pluralize(),l=Ember.get(this,"primaryKey"),c=i[l],u=e[a]||[];return console.log("sideloadKey",a),s(c)&&(console.log("generateId",i.xtype,i.id),c=n.generateId("item"),i[l]=c),s(i.meta)&&(i.meta={}),console.log("filling item",i,"meta with parent",r.xtype),i.meta.embeddedRecord=!0,i.meta.parentId=r.id,s(r.xtype)?s(r.crecord_type)||(i.meta.parentType=r.crecord_type):i.meta.parentType=r.xtype,s(u.findBy("id",c))?(console.log("pushing item",u,"into",a),u.push(i),e[a]=u,e):e}catch(d){console.error(d.message,d.stack)}},extractRelationships:function(e,t,i,r){console.group("extractRelationships",t,i);try{if(console.log("payload before extractRelationships",e),console.log("primaryType",i,t.xtype),i===o.getByName("widget").EmberModel){var n=o.getByName(t.xtype).EmberModel;i=n}return s(i.store)&&(i.store=r.store),i.eachRelationship(function(r,o){
console.log("eachRelationship",r,t,t[r]),console.log("relationship",o);var n=t[r],a=o.type;if(console.log("related",n),n)if("belongsTo"===o.kind){console.group("belongsTo relationship"),console.log("related",n),console.log("relationship",o),console.log("recordJSON",t),console.groupEnd();var l=this.sideloadItem(e,a,n,t);s(l)||(t[r]=n.id,t[r+"Type"]=n.xtype,this.extractRelationships(e,n,a,i))}else"hasMany"===o.kind&&(console.group("hasMany relationship"),console.log("related",n),console.log("relationship",o),console.log("recordJSON",t),console.groupEnd(),n.forEach(function(r,o){console.log("sideLoad items in",t);var l=this.sideloadItem(e,a,r,t);s(l)||(n[o]=r.id,this.extractRelationships(e,r,a,i))},this))},this),console.groupEnd(),e}catch(a){console.groupEnd(),console.error(a.message,a.stack)}},isRecordEmbedded:function(e){var t;return t=s(e._data.meta)||e._data.meta.embeddedRecord!==!0?!1:!0,console.log("isRecordEmbedded",e,t),t},getTopmostNotEmbeddedRecordFor:function(e,t){console.log("getTopmostNotEmbeddedRecordFor",e,e.data,e._data);for(var i=e;this.isRecordEmbedded(i);){var r=i._data.meta.parentType,o=i._data.meta.parentId;"view"===r&&(r="userview"),i=i.store.getById(r,o)}return i},serialize:function(e,t){console.log("serialize",e);var i=!0;if(s(t)||t.lookForDocumentRoot!==!1||(i=!1),i&&this.isRecordEmbedded(e))return void this.getTopmostNotEmbeddedRecordFor(e).save(t);var r=this._super(e,t);return r.id=e.get("id"),console.log(" - serialized record",e,r),r},serializeBelongsTo:function(e,t,r){console.log("serializeBelongsTo",arguments);var o=r.key;console.log("serializeBelongsTo",r,e);var n=i(o);console.log("key",n);var a=e.get(n);if(console.log("content",a),s(a))console.error("Content is empty",a);else{var l=a.serialize({lookForDocumentRoot:!1});console.log("serializedSubDocument",l),t[n]=l}},serializeHasMany:function(e,t,r){var o=r.key;console.log("serializeHasMany",r,e,t,o);var n=i(o);console.log("keyForRelationship",n);var a=e.get(n).get("content");console.log("subDocuments",a),t[n]=[];var l=a.length;(s(r)||s(r.type)||s(r.type.typeKey))&&console.error("Error while retrieving typeKey from model is it is none.");for(var c=0,u=l;u>c;c++)if(s(a[c]))console.error("subdocument is none for index",c,a);else{var d=a[c].serialize({lookForDocumentRoot:!1});d.xtype=r.type.typeKey,t[n].push(d)}console.log("serializedSubDocuments",t[n])},normalize:function(e,t,i){return e.eachRelationship(function(e,i){t[e]&&(t[e].type=t[e].xtype)}),this._super.apply(this,arguments)},pushPayload:function(e,t){for(var t=a.cleanJSONIds(t),i=Ember.keys(t),r=0,s=i.length;s>r;r++){var l=i[r],c=o.getByName(l).EmberModel;this.extractRelationships(t,t[l],c)}return t[l].id=n.generateId(t[l].xtype||t[l].crecord_type||"item"),this._super(e,t)}}));t.register("mixin:embedded-record-serializer",l)}}),Ember.Application.initializer({name:"HashSerializerMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=i("hashSerializer",{serializeIntoHash:function(e,t,i,r,o){return console.log("serializeIntoHash",arguments),e=this.serialize(i,o),"PUT"===r?e:"POST"===r?[e]:void 0}});t.register("mixin:hash-serializer",r)}}),Ember.Application.initializer({name:"InspectableArrayMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=i("InspectableArray",{attributesKeys:function(){var e=[],t=this.get("inspectedDataArray.type.attributes.values");console.log("attributesDict",t);for(var i in t){var r=t[i];(r.options.hiddenInLists===!1||void 0===r.options.hiddenInLists)&&(e.pushObject({field:r.name,type:r.type,options:r.options}),console.log("pushed attr",{field:r.name,type:r.type,options:r.options}))}return e}.property("inspectedProperty","inspectedDataArray"),inspectedDataArray:function(){console.error("This must be defined on the base class")}.property()});t.register("mixin:inspectable-array",r)}}),Ember.Application.initializer({name:"InspectableItemMixin",after:["MixinFactory","NotificationUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=window.schemasRegistry,o=e.lookupFactory("utility:notification"),n=Ember.get,a=Ember.set,s=i("inspectableItem",{attributesKey:"attributes",inspectedDataItem:function(){return console.error("This must be defined on the base class. Assuming inspected data is content"),"content"}.property(),inspectedItemType:function(){return console.error("This must be defined on the base class. Assuming inspected data is content.xtype"),"content.xtype"}.property(),inspectedItemInstance:function(){return console.error("Not mandatory, but attr.value field will not be set"),"content"}.property(),getInspectedItemType:function(){var e=n(this,"inspectedItemType");return"view"===e&&(e="userview"),e},insertValueIntoAttribute:function(e,t,i,r,o){var a=this.isOnCreate?r.options.defaultValue:n(t,i);if("array"===r.type){var s=Ember.copy(a,!0);a=s}return e.keys[o].value=a,e},generateEditorNameForAttribute:function(e){var t;return t=void 0!==e.options&&void 0!==e.options.role?"editor-"+e.options.role:"editor-"+e.type,void 0===Ember.TEMPLATES[t]&&(t="editor-defaultpropertyeditor"),t},generateRoleAttribute:function(e){return{type:"string",model:{options:{role:e}},options:{}}},getAttributes:function(){var e=this.getInspectedItemType(),t=r.getByName(e).EmberModel;return(void 0===t||void 0===t.proto())&&o.error("There does not seems to be a registered schema for",e.capitalize()),void 0===t.proto().categories&&o.error("No categories in the schema of"+e),n(t,n(this,"attributesKey"))},categorized_attributes:function(){var e=n(this,"inspectedDataItem");if(console.log("recompute categorized_attributes",e),void 0===e);else{console.log("inspectedDataItem attributes",this.getAttributes());var t=this.getInspectedItemType(),i=r.getByName(t).EmberModel;if(void 0!==t){var s=n(this,"options"),l=[];s&&s.filters&&(l=s.filters),console.log(" + filters ",l);var c={};s&&s.override_labels&&(c=s.override_labels),a(this,"categories",[]);for(var u=this.getAttributes(),d=i.proto().categories,m=0,p=d.length;d&&p>m;m++){for(var g=d[m],f={title:g.title,keys:[]},h=0,v=g.keys.length;v>h;h++){var b=g.keys[h],y=u.get(b);if("separator"===b)f.keys[h]=this.generateRoleAttribute("separator");else{if(void 0!==b&&void 0===y){o.error("An attribute that does not exists seems to be referenced in schema categories"+b),console.error(i,y,u),f.keys[h]=this.generateRoleAttribute("error"),f.keys[h].field=b,f.keys[h].error="Attribute referenced in schema categories not found";continue}void 0===y.options&&(y.options={}),0===l.length||-1!==$.inArray(b,l)?a(y,"options.hiddenInForm",!1):a(y,"options.hiddenInForm",!0);var w=b;c[b]&&(w=c[b]),f.keys[h]={field:w,model:y,editor:this.generateEditorNameForAttribute(y)},f=this.insertValueIntoAttribute(f,e,b,y,h)}}this.categories.push(f)}return console.log("categories",this.categories),this.categories}}}.property("inspectedDataItem","inspectedItemType")});t.register("mixin:inspectable-item",s)}}),Ember.Application.initializer({name:"LoadingindicatorMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=Ember.get,o=Ember.set;isNone=Ember.isNone;var n=i("loadingindicator",{init:function(){isNone(r(this,"partials.indicators"))&&o(this,"partials.indicators",[]),this.partials.indicators.pushObject("loadingindicator"),this._super()},isLoading:0,addConcurrentLoading:function(e){isNone(r(concurrentLoadingsPending,e))?o(concurrentLoadingsPending,e,{count:1}):concurrentLoadingsPending.incrementProperty(e+".count"),recomputeIsLoading(this)},removeConcurrentLoading:function(e){concurrentLoadingsPending.decrementProperty(e+".count"),r(concurrentLoadingsPending,e+".count")<=0&&delete concurrentLoadingsPending[e],recomputeIsLoading(this)}});recomputeIsLoading=function(e){for(var t=0,i=Ember.keys(concurrentLoadingsPending),n=0;n<i.length;n++){var a=concurrentLoadingsPending[i[n]];t+=r(a,"count")||0}o(e,"isLoading",t>0)},concurrentLoadingsPending=Ember.Object.create({userview:{count:0},perfdata:{count:0}}),t.register("mixin:loadingindicator",n)}}),Ember.Application.initializer({name:"MetaSerializerMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=Ember.isNone,o=i("metaSerializer",{extractMeta:function(e,t,i){console.log("extractMeta",e,t,i),i&&void 0===i.meta&&(i.meta={}),i&&void 0!==i.total&&(i.meta.total=i.total),i&&i.messages&&(i.meta.totalmessages=i.messages),i&&void 0!==i.success&&(i.meta.success=i.success),delete i.total,delete i.messages,delete i.success,console.log("normalizePayload",arguments),(r(t)||r(t.typeKey))&&console.error("Error while retrieving typeKey from model is it is none.");var o=t.typeKey,n=o.pluralize();return i[n]=i.data,delete i.data,console.log("payload",n,i),i&&i[n]&&"undefined"!=typeof i[n]?i[n].forEach(function(e){this.extractRelationships(i,e,t)},this):"undefined"!=typeof i[o]&&this.extractRelationships(i,i[o],t),this._super(e,t,i)},extractRelationships:function(e,t,i){this._super.apply(this,arguments)}});t.register("mixin:meta-serializer",o)}}),Ember.Application.initializer({name:"NotificationsMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=Ember.get;Ember.set;assert=Ember.assert;var o=i("notifications",{init:function(){this.partials.statusbar.pushObject("notificationsstatusmenu"),this._super()},notifications:function(){return assert("The notification store should be an instance of DS.Store",DS.Store.detectInstance(this.store)),this.store.find("notification")}.property(),createNotification:function(e,t){assert("The notification store should be an instance of DS.Store",DS.Store.detectInstance(this.store));var i=e;(void 0===t||void 0===e)&&(t="missing information for notification",i="warning",e="warning"),"error"===e&&(i="warning",e="danger");var r=this.store.createRecord("notification",{level:e,message:t,timestamp:(new Date).getTime(),falevel:"fa-"+i});r.save()},notificationCount:function(){return r(this,"notifications.length")}.property("notifications.length")});t.register("mixin:notifications",o)}}),Ember.Application.initializer({name:"PromisemanagerMixin",after:["PromisesRegistry","MixinFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=e.lookupFactory("registry:promises"),o=i("promisemanager",{promises:r,init:function(){this.partials.statusbar.pushObject("promisemanagerstatusmenu"),this._super()}});t.register("mixin:promisemanager",o)}}),Ember.Application.initializer({name:"RequirejsmocksmanagerMixin",after:["MocksRegistry","MixinFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=e.lookupFactory("registry:mocks"),o=i("Requirejsmocksmanager",{requirejsmocksmanager:r,init:function(){this.partials.statusbar.pushObject("requirejsmockingstatusmenu"),this._super()},actions:{deleteMock:function(e){r.deleteMock(e)},editMock:function(e){r.editMock(e)},addMock:function(){r.addMock()}}});t.register("mixin:requirejsmocksmanager",o)}}),Ember.Application.initializer({name:"SchemamanagerMixin",after:["MixinFactory","FormsUtils","DataUtils","SearchmethodsRegistry","SchemasLoader"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:data"),n=e.lookupFactory("deprecated:schemasLoader"),a=window.canopsisConfiguration,s=e.lookupFactory("registry:searchmethods"),l=Ember.get,c=(Ember.set,Ember.isNone),u=i("schemamanager",{configuration:a,available_types:n.generatedModels,init:function(){this.partials.statusbar.pushObject("schemamanagerstatusmenu"),this._super()},displayedTypes:function(){var e=l(this,"schemaManagerSearchCriterion");if(console.log("recompute displayedTypes"),c(e))return l(this,"available_types");console.log("searchCriterion",e);var t=s.getByName("simple").filter(l(this,"available_types"),{propertyToCheck:"name",searchCriterion:l(this,"schemaManagerSearchCriterion")});return t}.property("available_types","schemaManagerSearchCriterion"),actions:{addModelInstance:function(e){console.log("add",e);var t=o.getStore().createRecord(e,{crecord_type:e.underscore()});console.log("temp record",t);var i=r.showNew("modelform",t,{title:__("Add ")+e});i.submit.done(function(){t.save()})}}});t.register("mixin:schemamanager",u)}}),Ember.Application.initializer({name:"ScreentoolstatusmenuMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=i("Screentoolstatusmenu",{init:function(){this.partials.statusbar.pushObject("screentoolstatusmenu"),this._super()},actions:{changeScreenSize:function(e){var t={small:"480px",medium:"940px",large:"100%"}[e];$("body").animate({width:t})}}});t.register("mixin:screentoolstatusmenu",r)}}),Ember.Application.initializer({name:"UserprofilestatusmenuMixin",after:["MixinFactory","FormsUtils","DataUtils","NotificationUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:data"),n=e.lookupFactory("utility:notification"),a=Ember.get,s=Ember.set,l=Ember.isNone,c=i("Userprofilestatusmenu",{init:function(){l(this.partials.statusbar)||this.partials.statusbar.pushObject("userstatusmenu"),this._super()},actions:{showUserProfile:function(){var e=this,t=a(this,"controllers.login.record"),i=r.showNew("modelform",t,{title:a(t,"_id")+" "+__("profile"),filterFieldByKey:{firstname:{readOnly:!0},lastname:{readOnly:!0},authkey:{readOnly:!0},ui_language:!0,mail:!0,userpreferences:!0}});i.submit.then(function(i){console.group("submit form:",i);var r=i.get("formContext");console.log("save record:",r),s(r,"crecord_type","user"),r.id=r._id;var l=o.getStore().createRecord("user",r);l.save(),n.info(__("profile")+" "+__("updated")),uilang=a(r,"ui_language"),ouilang=a(t,"ui_language"),console.log("Lang:",uilang,ouilang),uilang!==ouilang&&(console.log("Language changed, will prompt for application reload"),e.send("promptReloadApplication","Interface language has changed, reload canopsis to apply changes ?")),console.groupEnd()})}}});t.register("mixin:userprofilestatusmenu",c)}}),Ember.Application.initializer({name:"ValidationMixin",after:["MixinFactory","FormsUtils"],initialize:function(e,t){var i,r=e.lookupFactory("factory:mixin"),i=e.lookupFactory("utility:forms"),o=Ember.get,n=Ember.set,a=r("validation",{validationFields:function(){return console.warn('Property "validationFields" must be defined on the concrete class.'),"<validationFields is null>"},changeTAB:function(e,t){var i="#"+e+"_tab";t?$(i).addClass("active"):$(i).removeClass("active");var r="#"+e;t?$(r).addClass("active"):$(r).removeClass("active")},set_tab:function(e){var t,i,r=this.categories;for(t=0;t<r.length;t++)i=r[t],this.changeTAB(i.slug,!1),Ember.set(i,"isDefault",!1);e:for(t=0;t<r.length;t++){i=r[t];for(var o=0;o<i.keys.length;o++){var n=i.keys[o],a=n.field;if(a===e){this.changeTAB(i.slug,!0),Ember.set(i,"isDefault",!0);break e}}}},empty_validationFields:function(){n(this,"validationFields",Ember.A())},validation:function(){console.group("Form validation");var e=o(this,"validationFields"),t=!0,r=[],n="",a=this;if(e)for(var s=0,l=e.length;l>s;s++){console.log("check if field is valid",o(e[s],"attr.field"));var c=e[s].validate();if(c.valid!==!0&&(r.push(c),console.log("Attribute not valid",e[s]),n=e[s].attr.field||e[s].attr.parent.attr.field,t=!1,e[s].removedFromDOM)){a.validateOnInsert=!0,i.showInstance(a);break}}return t||(console.log("form not valid"),this.set_tab(n)),console.groupEnd(),t}});t.register("mixin:validation",a)}}),Ember.Application.initializer({name:"ValidationFieldMixin",after:["MixinFactory","FormsRegistry"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=e.lookupFactory("registry:forms"),o=Ember.get,n=Ember.set,a=Ember.isNone,s=i("validationField",{attr:"",init:function(){var e=r.formwrapper.form;n(this,"form",e);var t=this.attr||this.content;if(n(this,"attr",t),a(t)||a(t.model))console.warn("No attributes found on this component");else{var i=t.model;a(o(this,"value"))&&!a(o(this,"attr.model.options.default"))&&this.set("value",o(this,"attr.model.options.default"));var s=o(i,"options.input_type")||o(i,"type");s="string"===s?"text":s}this._super()},didInsertElement:function(){var e=r.formwrapper.form;if(e){var t=o(e,"validationFields");t&&t.pushObject(this)}e.validateOnInsert&&this.validate()},focusOut:function(){this.validate()},validate:function(){var t=r.formwrapper.form,i=o(t,"validation");if(void 0!==i){var n=o(this,"attr"),a=e.lookupFactory("validator:main"),s=a(n);if(console.log("valideStruct",s),!this.removedFromDOM){var l=this.$();l.closest("div").next(".help-block").remove(),s.valid?l.closest("div").removeClass("has-error"):l.closest("div").addClass("has-error").after('<span class="help-block">'+s.error+"</span>")}return s}}});t.register("mixin:validation-field",s)}}),Ember.Application.initializer({name:"ApplicationRoute",after:["AuthenticatedRoute","FormsRegistry","RoutesUtils","ActionsUtils"],initialize:function(e,t){function i(e,t){Mousetrap.bind([e],function(e){return console.log("binding",arguments),n.doAction(t),!1})}var r,o,n,a=e.lookupFactory("route:authenticated");r=e.lookupFactory("registry:forms"),o=e.lookupFactory("utility:routes"),n=e.lookupFactory("utility:actions");var s=Ember.get,l=Ember.set,c=Ember.isNone,u=a.extend({actions:{showView:function(e){console.log("ShowView action",arguments);o.getCurrentViewId();this.transitionTo("userview",e)},showEditFormWithController:function(e,t,i){if(e.ArrayFields)for(;e.ArrayFields.length>0;)e.ArrayFields.pop();var o=s(e,"formName");console.log("showEditFormWithController",e,o,t,i);var n=this.controllerFor("formwrapper");return l(r,"formwrapper",n),e.setProperties({formwrapper:n,formContext:t}),n.setProperties({form:e,formName:o}),n.send("show"),e}},beforeModel:function(e){var t=this,r=DS.Store.create({container:s(this,"container")}),o=r.find("userview","view.app_footer"),n=r.find("userview","view.app_header"),a=r.find("frontend","cservice.frontend"),u=r.find("ticket","cservice.ticket"),d=t.controllerFor("application");u.then(function(e){d.ticketConfig=e}),a.then(function(e){console.log("frontend config found"),d.frontendConfig=e;var t=s(e,"keybindings");console.log("load keybindings",t);for(var r=0,o=t.length;o>r;r++){var n=t[r];console.log("Mousetrap define",n),i(n.label,n.value)}}),n.then(function(e){d.headerUserview=e}),o.then(function(e){d.footerUserview=e});var m=this._super(e);l(this,"promiseArray",[m,o,n,a,u]),l(this,"store",r);var p=this.authConfig("authconfiguration",function(e){var i=s(e,"services");if(console.log("authconfigurationRecord",e,i),!c(i))for(var r=0,o=i.length;o>r;r++)if(i[r]){var n=t.authConfig(i[r]);s(t,"promiseArray").pushObject(n)}});return s(this,"promiseArray").pushObject(p),Ember.RSVP.Promise.all(s(this,"promiseArray"))},authConfig:function(e,t){var i="cservice."+e,r=this.controllerFor("application"),o=s(this,"store"),n=function(e,t,i,r){e[t]=i,e.authTypes||(e.authTypes=[]),e.authTypes.pushObject(t),c(r)||r(i)},a=o.find(e,i);return a.then(function(i){console.log(e,"config found",i),n(r,e,i,t)},function(){console.log("create base "+e+" config");var a=o.createRecord(e,{crecord_name:e});a.id=i,n(r,e,a,t)}),a},model:function(){return{title:"Canopsis"}},renderTemplate:function(){console.info("render application template"),this.render();var e=this.controllerFor("formwrapper");this.render("formwrapper",{outlet:"formwrapper",into:"application",controller:e});var t=this.controllerFor("recordinfopopup");this.render("recordinfopopup",{outlet:"recordinfopopup",into:"application",controller:t})}});t.register("route:application",u)}}),Ember.Application.initializer({name:"AuthenticatedRoute",after:["DataUtils","ActionsUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:data"),r=e.lookupFactory("utility:actions"),o=Ember.get,n=Ember.set,a=Ember.Route.extend({setupController:function(e){return this.controllerFor("application").onIndexRoute=!0,r.setDefaultTarget(e),this._super.apply(this,arguments)},beforeModel:function(e){var t=this,r=DS.Store.create({container:o(this,"container")});loggedaccountAdapter=i.getEmberApplicationSingleton().__container__.lookup("adapter:loggedaccount");var a=r.findAll("loggedaccount");a.then(function(a){var s=a.content[0],l=t.controllerFor("login");n(l,"record",s),i.setLoggedUserController(l),l.sessionStart();for(var c=t.controllerFor("application"),u=o(c,"enginesviews"),d=0,m=u.length;m>d;d++){var p=u[d];"root"===o(l,"record._id")?n(p,"displayable",!0):(viewId=p.value,o(l,"record.rights.showview_"+viewId.replace(".","_"))?n(p,"displayable",!0):n(p,"displayable",!1))}return Ember.RSVP.all([r.find("role",o(s,"role")).then(function(e){var i=t.controllerFor("login");n(i,"role",e)})]).then(function(){if("index"===o(e,"targetName")){console.info("on index route, redirecting to the appropriate route");var i=t.controllerFor("application"),r=o(i,"defaultView");isNone(r)||(console.log("redirect to view",r),t.transitionTo("/userview/"+r))}})});var s=this._super(e);return Ember.RSVP.Promise.all([s,a])},actions:{editAndSaveModel:function(e,t,i){console.log("editAndSaveModel",t),e.setProperties(t);var r=e.save();void 0!==i&&r.then(i)},addRecord:function(e,t,i){if(t[e]=e,void 0!==i&&void 0!==i.customFormAction)i.customFormAction(e,t);else{var r=this.store.createRecord(e,t),o=r.save();void 0!==i&&void 0!==i.callback&&o.then(i.callback)}},error:function(e,t){(403===e.status||401===e.status)&&this.loginRequired(t)}}});t.register("route:authenticated",a)}}),Ember.Application.initializer({name:"IndexRoute",after:"AuthenticatedRoute",initialize:function(e,t){var i=e.lookupFactory("route:authenticated"),r=(Ember.set,Ember.get,i.extend({}));t.register("route:index",r)}}),Ember.Application.initializer({name:"UserviewRoute",after:["AuthenticatedRoute","DataUtils","NotificationUtils","FormsUtils","WidgetSelectorsUtils"],initialize:function(e,t){var i=e.lookupFactory("route:authenticated"),r=e.lookupFactory("utility:data"),o=e.lookupFactory("utility:notification"),n=e.lookupFactory("utility:forms"),a=e.lookupFactory("utility:widget-selectors"),s=Ember.set,l=Ember.get,c=(Ember.isNone,!1),u=i.extend({beforeModel:function(e){var t=this.controllerFor("application");return t.addConcurrentLoading("userview"),this._super(e)},afterModel:function(e,t){var i=this.controllerFor("application");return i.removeConcurrentLoading("userview"),this._super(e,t)},actions:{error:function(e,t){0===e.status?console.debug("no error detected in access status"):403===e.status?console.debug("go to some default route"):401===e.status?console.debug("handle 401"):404===e.status?this.transitionTo("/userview/view.404"):(console.error(e),o.error(__("Impossible to load view.")))},toggleEditMode:function(){var e=this.controllerFor("application");if(l(e,"editMode")===!0)console.info("Leaving edit mode"),s(e,"editMode",!1);else{for(var t=a.children(l(this.controllerFor("userview"),"containerwidget")),i=0,r=t.length;r>i;i++){var o=t[i];l(o,"rollbackable")&&o.send("rollback")}console.info("Entering edit mode"),s(e,"editMode",!0)}},exportCurrentView:function(){var e=this.controllerFor("userview").get("model"),t=e.serialize();t=r.cleanJSONIds(t),r.download(JSON.stringify(t),l(e,"crecord_name")+".json","application/json")},toggleDevTools:function(){$(".debugmenu").slideToggle(200)},toggleFullscreen:function(){var e=this.controllerFor("application"),t=!l(e,"fullscreenMode");s(e,"fullscreenMode",t)},stopLiveReporting:function(){this.setReportingInterval(void 0)},displayLiveReporting:function(){var e=this,t=r.getStore().createRecord("livereporting",{crecord_type:"livereporting"}),i=n.showNew("modelform",t,{title:__("Edit live reporting")});i.submit.then(function(i){t=l(i,"formContext");var r=l(t,"dateinterval");s(e.controllerFor("application"),"interval",r),e.setReportingInterval(r),console.debug("setting interval to value",r)})},refresh:function(){var e=this.controllerFor("userview");console.log("refresh",this),this.refresh(),e.send("refreshView")}},setReportingInterval:function(e){s(this.controllerFor("application"),"interval",e);var t=this.controllerFor("userview"),i=l(t,"content.containerwidget"),r=a.children(i);Ember.isNone(e)&&(e={});for(var o=0,n=r.length;n>o;o++){console.debug("Child widget",l(r[o],"id"),r[o]);var c=l(r[o],"controllerInstance");Ember.isNone(c)?console.error("Unable to find controller instance for widget",l(r[o],"id")):c.updateInterval(e)}},setupController:function(e,t){console.log("UserviewRoute setupController",arguments),this._super.apply(this,arguments),e.setProperties({isMainView:!0}),c===!1&&(c=!0),s(this.controllerFor("application"),"currentViewId",l(t,"id"));this.controllerFor("application");e.trigger&&e.trigger("refreshView")}});t.register("route:userview",u)}}),Ember.Application.initializer({name:"ApplicationSerializer",after:["MetaSerializerMixin","HashSerializerMixin","EmbeddedRecordSerializerMixin","NotificationUtils","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("mixin:meta-serializer"),r=e.lookupFactory("mixin:hash-serializer"),o=e.lookupFactory("mixin:embedded-record-serializer"),n=(e.lookupFactory("utility:notification"),e.lookupFactory("utility:hash")),a=(Ember.get,Ember.set,Ember.isNone),s=DS.RESTSerializer.extend(i,r,o,{normalizeId:function(e){a(e.id)&&(e.id=e._id)},normalize:function(e,t){return console.log("normalize",arguments),a(t.id)&&(t.id=n.generateId("generatedId")),this._super(e,t)}});t.register("serializer:application",s)}}),Ember.Application.initializer({name:"EventlogSerializer",after:["ApplicationSerializer"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),r=i.extend({extractRelationships:function(e,t,i){console.log("extractRelationships",arguments),console.log("item.ack",t.ack),(1===t.ack||t.ack===!0)&&(t.ack=t.rk)}});t.register("serializer:eventlog",r)}}),Ember.Application.initializer({name:"LoggedaccountSerializer",after:["ApplicationSerializer"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),r=i.extend();t.register("serializer:loggedaccount",r)}}),Ember.Application.initializer({name:"UserviewSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),r=e.lookupFactory("mixin:embedded-record-serializer"),o=i.extend(r,{});t.register("serializer:userview",o)}}),Ember.Application.initializer({name:"WidgetSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),r=e.lookupFactory("mixin:embedded-record-serializer"),o=i.extend(r,{});t.register("serializer:widget",o)}}),Ember.Application.initializer({name:"WidgetwrapperSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),r=e.lookupFactory("mixin:embedded-record-serializer"),o=i.extend(r,{});t.register("serializer:widgetwrapper",o)}}),Ember.Application.initializer({name:"MailValidator",initialize:function(e,t){function i(e,t){var i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return Ember.isBlank(e.value)?e.model.options.required?(t.valid=!1,t.error="Mail is required"):t.valid=!0:i.test(e.value)?t.valid=!0:(t.valid=!1,t.error="Mail's format should be: X@Y.Z"),t}t.register("validator:mail",i)}}),Ember.Application.initializer({name:"MaxItemsValidator",initialize:function(e,t){function i(e,t){var i=e.model.options.maxItems;return e.value.length<=i?t.valid=!0:(t.valid=!1,t.error="There can be at most "+i+" item(s)."),t}t.register("validator:max-items",i)}}),Ember.Application.initializer({name:"MinItemsValidator",initialize:function(e,t){function i(e,t){var i=e.model.options.minItems;return e.value.length>=i?t.valid=!0:(t.valid=!1,t.error="Must have at least "+i+" item(s)."),t}t.register("validator:min-items",i)}}),Ember.Application.initializer({name:"NumberValidator",initialize:function(e,t){function i(e,t){return Ember.isEmpty(e.value)||!isNaN(e.value)?t.valid=!0:(t.valid=!1,t.error="value should be a number"),t}t.register("validator:number",i)}}),Ember.Application.initializer({name:"RequiredValidator",initialize:function(e,t){function i(e,t){return console.log("requiredValidator :attr = ",e),void 0===e.model.options.required||e.model.options.required!==!0||void 0!==e.value&&""!==e.value&&null!==e.value?(t.valid=!0,t.error=""):(t.valid=!1,t.error=" Field can't be empty"),t}t.register("validator:required",i)}}),Ember.Application.initializer({name:"RightsValidator",initialize:function(e,t){function i(e,t){return t.valid=!0,t}t.register("validator:rights",i)}}),Ember.Application.initializer({name:"Validator",initialize:function(e,t){function i(t){console.log("attr = ",t);var i=n(t,"model.options"),r=[],o=n(t,"model.type"),a=e.lookupFactory("validator:"+o);if(void 0!==a&&r.push(Ember.validators[o]),void 0!==i){for(var s in i)if(i.hasOwnProperty(s)&&("role"===s||"type"===s)){var l=e.lookupFactory("validator:"+i[s]);void 0!==l&&r.push(l)}n(i,"required")&&(a=e.lookupFactory("validator:required"),r.push(a))}return r}function r(e){function t(){for(var e=0;r>e;e++)this[i[e]]=arguments[e]}var i=e.split(" "),r=i.length;return t}function o(e){for(var t="",o=r("valid error"),n=new o(!0,t),a=i(e),s=0;s<a.length;s++)if(validator=a[s],n=validator(e,n),n.valid===!1)return n;return n}var n=Ember.get;t.register("validator:main",o)}}),Ember.Application.initializer({name:"ApplicationView",initialize:function(e,t){var i=Ember.get,r=(Ember.set,Ember.View.extend({rightSideCssClasses:function(){return i(this,"controller.fullscreenMode")?"right-side strech fullscreen":"right-side strech"}.property("controller.fullscreenMode")}));t.register("view:application",r)}}),Ember.Application.initializer({name:"EditorView",initialize:function(e,t){var i=Ember.View.extend({attrBinding:"templateData.keywords.attr.value",init:function(){var e=utils.hash.generateId(this.templateName);this.elementId=e}});t.register("view:editor",i)}}),Ember.Application.initializer({name:"FormwrapperView",after:"DragUtils",initialize:function(e,t){var i=e.lookupFactory("utility:drag"),r=Ember.get,o=Ember.set,n=Ember.isNone,a=Ember.View.extend({init:function(){this._super(),console.log("formwrapper view init",this,r(this,"controller")),o(this,"controller.widgetwrapperView",this)},didInsertElement:function(){i.setDraggable(this.$("#formwrapper .modal-title"),this.$("#formwrapper"))},willDestroyElement:function(){this.$("#formwrapper").modal("hide"),this._super()},registerHooks:function(){this.hooksRegistered=!0,console.log("registerHooks",this),this.get("controller").on("validate",this,this.hidePopup),this.get("controller").on("hide",this,this.hidePopup),this.get("controller").on("rerender",this,this.rerender);var e=this;this.$("#formwrapper").on("hidden.bs.modal",function(){e.onPopupHidden.apply(e,arguments)})},unregisterHooks:function(){this.get("controller").off("validate",this,this.hidePopup),this.get("controller").off("hide",this,this.hidePopup),this.get("controller").off("rerender",this,this.rerender)},showPopup:function(){console.log("view showPopup"),this.hooksRegistered||this.registerHooks(),this.$("#formwrapper").modal("show").css("top",0).css("left",0),r(this,"controller.form")&&r(this,"controller.form").send("show")},hidePopup:function(){console.log("view hidePopup"),this.$("#formwrapper").modal("hide")},onPopupHidden:function(){console.log("onPopupHidden",arguments);var e=r(this,"controller.form.submit");n(e)||"pending"!==e.state()||(console.info("rejecting form submission"),r(this,"controller.form").send("abort"))}});t.register("view:formwrapper",a)}}),Ember.Application.initializer({name:"ListlineView",initialize:function(e,t){var i=(Ember.set,Ember.get,Ember.View.extend({tagName:"tr",templateName:"listline",classNames:["listline"],checkChanged:function(){var e=this.$(".toggle");void 0!==e&&e.iCheck("check")}.observes("controller.isAllSelected")
}));t.register("view:listline",i)}}),Ember.Application.initializer({name:"MixineditdropdownView",initialize:function(e,t){var i=window.schemasRegistry,r=(Ember.set,Ember.get),o=(Ember.isNone,Ember.View.extend({tagName:"span",templateName:"mixineditdropdown",hasEditableMixins:function(){return r(this,"editableEnabledMixins.length")||r(this,"wrapperMixins.length")}.property("editableEnabledMixins","wrapperMixins"),wrapperMixins:function(){var e=Ember.A();return r(this,"isGridLayout")&&e.pushObject({name:"gridlayout"}),e}.property("isGridLayout"),editableEnabledMixins:function(){var e=r(this,"mixins"),t=Ember.A();if(e)for(var o=0;o<e.length;o++)i.getByName(e[o].name.camelize())&&t.pushObject(e[o]);return t}.property("mixins")}));t.register("view:mixineditdropdown",o)}}),Ember.Application.initializer({name:"PartialslotView",initialize:function(e,t){var i=Ember.View.extend({canopsisConfiguration:canopsisConfiguration,showPartialslots:Ember.computed.alias("canopsisConfiguration.showPartialslots"),templateName:"partialslot",tagName:"span",slot:Ember.required()});t.register("view:partialslot",i),Ember.Handlebars.helper("partialslot",i)}}),Ember.Application.initializer({name:"RecordinfopopupView",after:"DragUtils",initialize:function(e,t){var i=e.lookupFactory("utility:drag"),r=(Ember.get,Ember.set,Ember.View.extend({didInsertElement:function(){console.log("Recordinfopopup dom element"),$(window).on("resize",function(){var e=($(window).width()-$("#recordinfopopup").outerWidth())/2;$("#recordinfopopup").css("left",e)}),i.setDraggable($("#recordinfopopup .hand"),$("#recordinfopopup"))}}));t.register("view:recordinfopopup",r)}}),Ember.Application.initializer({name:"TabledraggablethView",initialize:function(e,t){var i=Ember.get,r=Ember.set,o=Ember.View.extend({templateName:"tabledraggableth",tagName:"th",attributeBindings:["draggable","droppable"],draggable:"true",droppable:"true",click:function(){this.get("controller").send("sort",i(this,"attr"))},drag:function(e){var t=this.$().parent().children("th"),i=e.originalEvent.clientX;$(t).css({"border-right":"0"}),this.closestTh=void 0;for(var r=1/0,o=0,n=t.length;n>o;o++){var a=Math.abs($(t[o]).position().left+$(t[o]).width()-i);r>a&&(this.closestTh=t[o],r=a)}$(this.closestTh).css({"border-right":"10px solid blue"})},dragEnd:function(e){var t=this.$().parent().children("th");$(t).css({"border-right":"0"}),console.log("permute",this.getPosition(this.$()),this.getPosition($(this.closestTh))),this.permuteColumns(this.getPosition(this.$()),this.getPosition($(this.closestTh)))},swapColumnsInDom:function(e,t){console.log("swapColumnsInDom",arguments),table=this.$().parent();var i=this.$().parent().parent().parent().find("tr");console.log("rows",i);var r;i.each(function(){r=$(this).children("th, td"),console.log("cols",r),r.eq(e+1).detach().insertAfter(r.eq(t+1))})},permuteColumns:function(e,t){var o=i(this,"controller"),n=this.getColumns();(0===e||0===t)&&(console.log("unable to perform drag and drop operation"),o.send("refreshView")),console.debug("columns before drag",n);var a=n.splice(e-1,1)[0],s=this;Ember.isNone(a)?(console.log("unable to perform drag and drop operation"),o.send("refreshView")):(console.debug("permutation is",a),console.debug("permutation is replaced between",n[t-1],"and",n[t]),e>t?n.splice(t,0,a):n.splice(t-1,0,a),console.debug("columns after drag",n),r(o,"model.user_displayed_columns",n),r(o,"displayed_columns",n),s.swapColumnsInDom(e-1,t-1),o.saveUserConfiguration())},getPosition:function(e){var t,i=this.$().parent().children("th");return i.each(function(r){var o=e[0]===i.eq(r)[0];return o?(t=r,console.log("element position is",r),!1):void 0}),t},getColumns:function(){var e=i(this,"controller.displayed_columns");if(Ember.isNone(e)){var t=i(this,"controller.shown_columns");console.debug("using shown_columns property",t),e=Ember.A();for(var r=0,o=t.length;o>r;r++)e.pushObject(i(t[r],"field"))}else console.debug("using displayed_columns property");return e}});t.register("view:tabledraggableth",o)}}),Ember.Application.initializer({name:"UserviewView",initialize:function(e,t){var i=Ember.get,r=(Ember.set,Ember.isNone,Ember.View.extend({actions:{refreshView:function(){this.rerender()}},hookRegistered:!1,registerHooks:function(){i(this,"hookRegistered")||(i(this,"controller").on("refreshView",this,this.rerender),this.set("hookRegistered",!0))},unregisterHooks:function(){i(this,"controller").off("refreshView",this,this.rerender),this.set("hookRegistered",!1)},rerender:function(){return console.info("refreshing view",this),"destroying"===i(this,"state")?void console.warn("view is being destroying, cancel refresh"):(this._super.apply(this,arguments),void this.registerHooks())},didInsertElement:function(){return console.log("inserted view",this),this.registerHooks(),this._super.apply(this,arguments)},willClearRender:function(){return this.unregisterHooks(),this._super.apply(this,arguments)}}));t.register("view:userview",r)}}),Ember.Application.initializer({name:"component-validationtextarea",after:"ValidationFieldMixin",initialize:function(e,t){var i=e.lookupFactory("mixin:validation-field"),r=Ember.TextArea.extend(i,{});t.register("component:component-validationtextarea",r),Ember.Handlebars.helper("component-validationtextarea",r)}}),Ember.Application.initializer({name:"component-validationtextfield",after:"ValidationFieldMixin",initialize:function(e,t){var i=e.lookupFactory("mixin:validation-field"),r=Ember.TextField.extend(i,{});t.register("component:component-validationtextfield",r)}}),Ember.Application.initializer({name:"WidgetView",after:["WidgetsRegistry","MixinFactory","WidgetController","MixinsRegistry"],initialize:function(e,t){function i(e,t){var i=s(t,"mixins"),r=[];console.log("computeMixinsArray",i,t);var o={};if(i){for(var l=0,c=i.length;c>l;l++){var u=i[l];"string"==typeof u?Ember.deprecate("Defining mixins as strings is deprecated. The new format is : '{ name: \"mixinName\" }'. This is required by the mixin options system."):u=u.name.camelize(),o[u]=i[l];var d=n.getByName(u);console.log("find mixin",u,d);var m=a.getByName(u);if(void 0!==m){m=m.EmberModel;var p=m.proto().userPreferencesModel;console.log("mixinModel",p);var g=s(p,"attributes");console.log("mixinModelAttributes",g),g.forEach(function(e){t.userPreferencesModel[e.name]=p[e.name],t.userPreferencesModel.attributes.add(e)})}d?r.pushObject(d.EmberClass):(s(e,"displayedErrors").pushObject("mixin not found : "+u),console.error("mixin not found",u))}var f=e.get("controller");f.onMixinsApplied&&f.onMixinsApplied()}return r.pushObject(Ember.Evented),{array:r,mixinOptions:o}}var r,r=e.lookupFactory("registry:widgets"),o=(e.lookupFactory("factory:mixin"),e.lookupFactory("controller:widget")),n=e.lookupFactory("registry:mixins"),a=window.schemasRegistry,s=Ember.get,l=Ember.set,c=(Ember.isNone,Ember.View.extend({templateName:"widget",classNames:["widget"],errorMessages:Ember.A(),widgetController:void 0,init:function(){console.group("widget initialisation :",s(this,"widget.xtype"),this.widget,s(this,"widget.tagName")),l(this,"target",s(this,"controller")),this._super(),l(this,"displayedErrors",Ember.A()),s(this,"widget")?(this.intializeController(this.widget),this.applyAllViewMixins()):(console.error("No correct widget found for view",this),this.errorMessages.pushObject("No correct widget found")),s(this,"widget.tagName")&&(console.log("custom tagName",s(this,"widget.tagName")),l(this,"tagName",s(this,"widget.tagName")));var e=s(this,"widget.cssClass");e&&(console.log("custom tagName",s(this,"widget.tagName")),l(this,"classNames",e.split(","))),console.groupEnd()},applyAllViewMixins:function(){var e=s(this,"controller");if(console.group("apply widget view mixins",e.viewMixins),void 0!==e.viewMixins)for(var t=0,i=e.viewMixins.length;i>t;t++){var r=e.viewMixins[t];console.log("mixinToApply",r),void 0!==r.mixins[0].properties.init&&console.warn("The mixin",r,"have a init method. This practice is not encouraged for view mixin as they are applied at runtime and the init method will not be triggerred"),r.apply(this)}console.groupEnd()},intializeController:function(e){console.group("set controller for widget",e);var t=this.instantiateCorrectController(e),i=s(e,"xtype");"text"===i&&(i="textwidget"),this.setProperties({controller:t,templateName:i}),e.set("controller",t),this.registerHooks(),console.groupEnd()},instantiateCorrectController:function(e){console.log("instantiateCorrectController",arguments);var t=s(e,"xtype");(void 0===t||null===t)&&console.error("no xtype for widget",e,this);var a=i(this,e);a.array.pushObject({model:e,target:s(this,"target")});var l,c=r.getByName(s(e,"xtype"));c=void 0!==c?c.EmberClass:o,l=c.createWithMixins.apply(c,a.array),l.refreshPartialsList(),Ember.setProperties(l,{"model.displayedErrors":s(this,"displayedErrors"),mixinOptions:a.mixinOptions}),l.mixinsOptionsReady();var u=e._data.mixins;if(u)for(var d=0,m=u.length;m>d;d++){var p=u[d],g=n.all[p];g&&g.apply(l)}return l},didInsertElement:function(){return console.log("inserted widget, view:",this),this.registerHooks(),this._super.apply(this,arguments)},willDestroyElement:function(){return clearInterval(s(this,"widgetRefreshInterval")),this.unregisterHooks(),this._super.apply(this,arguments)},onWidgetRefresh:function(){},registerHooks:function(){return console.log("registerHooks",s(this,"controller"),s(this,"controller").on),s(this,"controller").on("refresh",this,this.rerender),this._super()},unregisterHooks:function(){return s(this,"controller").off("refresh",this,this.rerender),this._super()}}));r=e.lookupFactory("registry:widgets"),Ember.Handlebars.helper("widgethelper",c),t.register("view:widget",c)}}),Ember.Application.initializer({name:"WidgetslotView",initialize:function(e,t){var i=Ember.get,r=Ember.set,o=Ember.View.extend({init:function(){console.log("widgetslot init",i(this,"controller.content.widgetslotTemplate"));var e=i(this,"controller.content.widgetslotTemplate");void 0!==e&&null!==e&&void 0!==Ember.TEMPLATES[e]&&r(this,"templateName",e),this._super.apply(this,arguments)},templateName:"widgetslot-default",classNames:["widgetslot"]});Ember.Handlebars.helper("widgetslot",o),t.register("view:widgetslot",o)}});
//# sourceMappingURL=dist/brick.map.js